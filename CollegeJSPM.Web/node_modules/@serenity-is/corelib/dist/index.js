var na=Object.defineProperty;var aa=Object.getOwnPropertyDescriptor;var h=(d,n,e,t)=>{for(var i=t>1?void 0:t?aa(n,e):n,r=d.length-1,a;r>=0;r--)(a=d[r])&&(i=(t?a(n,e,i):a(i))||i);return t&&i&&na(n,e,i),i};var Pe=(d,n,e)=>new Promise((t,i)=>{var r=l=>{try{o(e.next(l))}catch(u){i(u)}},a=l=>{try{o(e.throw(l))}catch(u){i(u)}},o=l=>l.done?t(l.value):Promise.resolve(l.value).then(r,a);o((e=e.apply(d,n)).next())});import{ColumnSelection as lx,RetrieveColumnSelection as dx,SummaryType as ux,Criteria as px}from"@serenity-is/corelib/q";import{addAttribute as J,addTypeMember as oa,MemberType as _s,ISlickFormatter as Ps,registerClass as Ei,registerEditor as Ds,registerInterface as Fs,registerEnum as la,startsWith as Es,EditorAttribute as da}from"@serenity-is/corelib/q";function P(d){return function(n){return Ei(n,"Serenity."+d+"Attribute")}}var z=class{constructor(n){this.value=n}};z=h([P("EnumKey")],z);var De=class{constructor(n){this.displayName=n}};De=h([P("DisplayName")],De);var yi=class{constructor(n){this.category=n}};yi=h([P("Category")],yi);var Ot=class{constructor(n){this.value=n}};Ot=h([P("ColumnsKey")],Ot);var vi=class{constructor(n){this.cssClass=n}};vi=h([P("CssClass")],vi);var bi=class{constructor(n){this.value=n}};bi=h([P("DefaultValue")],bi);var nt=class{constructor(n){this.value=n}};nt=h([P("DialogType")],nt);var Ci=class{constructor(n,e){this.key=n;this.value=e}};Ci=h([P("EditorOption")],Ci);var Ri=class{constructor(n){this.editorType=n}setParams(n){}};Ei(Ri,"Serenity.EditorTypeAttributeBase");var xi=class extends Ri{constructor(n){super(n)}};xi=h([P("EditorType")],xi);var at=class{constructor(n){this.value=n}};at=h([P("Element")],at);var qe=class{constructor(n){this.value=n}};qe=h([P("EntityType")],qe);var ot=class{constructor(n=!0){this.value=n}};ot=h([P("Filterable")],ot);var lt=class{constructor(n=!0){this.value=n}};lt=h([P("Flexify")],lt);var ve=class{constructor(n){this.value=n}};ve=h([P("FormKey")],ve);var Ii=class{constructor(n){this.origin=n}};Ii=h([P("GeneratedCode")],Ii);var Ti=class{constructor(){}};Ti=h([P("Hidden")],Ti);var Si=class{constructor(n){this.hint=n}};Si=h([P("Hint")],Si);var Me=class{constructor(n){this.value=n}};Me=h([P("IdProperty")],Me);var ki=class{constructor(n=!0){this.value=n}};ki=h([P("Insertable")],ki);var Je=class{constructor(n){this.value=n}};Je=h([P("IsActiveProperty")],Je);var Fe=class{constructor(n){this.value=n}};Fe=h([P("ItemName")],Fe);var $e=class{constructor(n){this.value=n}};$e=h([P("LocalTextPrefix")],$e);var dt=class{constructor(n=!0){this.value=n}};dt=h([P("Maximizable")],dt);var Oi=class{constructor(n){this.maxLength=n}};Oi=h([P("MaxLength")],Oi);var wt=class{constructor(n){this.value=n}};wt=h([P("NameProperty")],wt);var wi=class{};wi=h([P("OneWay")],wi);var ze=class{};ze=h([P("Option")],ze);var ut=class{constructor(n){this.value=n}};ut=h([P("OptionsType")],ut);var pt=class{constructor(n=!0){this.value=n}};pt=h([P("Panel")],pt);var _i=class{constructor(n){this.value=n}};_i=h([P("Placeholder")],_i);var Pi=class{constructor(n=!0){this.value=n}};Pi=h([P("ReadOnly")],Pi);var Di=class{constructor(n=!0){this.isRequired=n}};Di=h([P("Required")],Di);var ct=class{constructor(n=!0){this.value=n}};ct=h([P("Resizable")],ct);var ht=class{constructor(n=!0){this.value=n}};ht=h([P("Responsive")],ht);var Ee=class{constructor(n){this.value=n}};Ee=h([P("Service")],Ee);var Fi=class{constructor(n=!0){this.value=n}};Fi=h([P("Updatable")],Fi);var m;(_=>{function d(x,I){return function(E){typeof x=="string"?Ei(E,x,I):Ei(E,null,x)}}_.registerClass=d;function n(x,I){return function(E){typeof x=="string"?Fs(E,x,I):Fs(E,null,x)}}_.registerInterface=n;function e(x,I){return function(E){typeof x=="string"?Ds(E,x,I):Ds(E,null,x)}}_.registerEditor=e;function t(x,I,E){la(x,E,I),I&&J(x,new z(I))}_.registerEnum=t;function i(x,I,E){t(x,E!=null?E:I,I)}_.registerEnumType=i;function r(x=[Ps],I=[Ps]){return d(x,I)}_.registerFormatter=r;function a(x){return function(I){J(I,new z(x))}}_.enumKey=a;function o(){return function(x,I){var E=Es(I,"get_")||Es(I,"set_"),j=E?I.substr(4):I;oa(x.constructor,{name:j,attr:[new ze],type:E?_s.property:_s.field,getter:E?"get_"+j:null,setter:E?"set_"+j:null})}}_.option=o;function l(x){return function(I){J(I,new nt(x))}}_.dialogType=l;function u(){return function(x){var I=new da;J(x,I)}}_.editor=u;function c(x){return function(I){J(I,new at(x))}}_.element=c;function p(x=!0){return function(I){J(I,new ot(x))}}_.filterable=p;function g(x=!0){return function(I){J(I,new lt(x))}}_.flexify=g;function f(x){return function(I){J(I,new Fe(x))}}_.itemName=f;function y(x=!0){return function(I){J(I,new dt(x))}}_.maximizable=y;function v(x){return function(I){J(I,new ut(x))}}_.optionsType=v;function C(x=!0){return function(I){J(I,new pt(x))}}_.panel=C;function T(x=!0){return function(I){J(I,new ct(x))}}_.resizable=T;function w(x=!0){return function(I){J(I,new ht(x))}}_.responsive=w;function k(x){return function(I){J(I,new Ee(x))}}_.service=k})(m||(m={}));var Re=class{};Re=h([m.registerInterface("Serenity.IBooleanValue")],Re);var Y=class{};Y=h([m.registerInterface("Serenity.IDoubleValue")],Y);var be=class{};be=h([m.registerInterface("Serenity.IDialog")],be);var Ve=class{};Ve=h([m.registerInterface("Serenity.IEditDialog")],Ve);var X=class{};X=h([m.registerInterface("Serenity.IGetEditValue")],X);var R=class{};R=h([m.registerInterface("Serenity.IReadOnly")],R);var Z=class{};Z=h([m.registerInterface("Serenity.ISetEditValue")],Z);var D=class{};D=h([m.registerInterface("Serenity.IStringValue")],D);var Ne=class{};Ne=h([m.registerInterface("Serenity.IValidateRequired")],Ne);import{registerEnum as ua}from"@serenity-is/corelib/q";var Rs=(i=>(i[i.Before=0]="Before",i[i.Delete=1]="Delete",i[i.Insert=2]="Insert",i[i.Update=3]="Update",i))(Rs||{});ua(Rs,"Serenity.CaptureOperationType");import{isEmptyOrNull as pa}from"@serenity-is/corelib/q";var se;(t=>{function d(i,r){var a=i,o=a["get_"+r];if(typeof o!="undefined")return o.apply(i);var l=e(r);return o=a["get_"+l],typeof o!="undefined"?o.apply(i):a[l]}t.getPropertyValue=d;function n(i,r,a){var o=i,l=o["set_"+r];if(typeof l!="undefined"){l.apply(i,[a]);return}var u=e(r);if(l=o["set_"+u],typeof l!="undefined"){l.apply(i,[a]);return}o[u]=a}t.setPropertyValue=n;function e(i){if(pa(i))return i;if(i==="ID")return"id";for(var r=!1,a=0,o=0;o<i.length;o++)if(i.charCodeAt(o)>=65&&i.charCodeAt(o)<=90)a++;else{r=!0;break}return!r&&i.length!==1||a===0?i:a>1?i.substr(0,a-1).toLowerCase()+i.substr(a-1):i.length===1?i.toLowerCase():i.substr(0,1).toLowerCase()+i.substr(1)}t.makeCamelCase=e})(se||(se={}));import{ArgumentNullException as fa,Exception as ya,htmlEncode as va,isAssignableFrom as ba,isEmptyOrNull as Ca,notifyError as xa}from"@serenity-is/corelib/q";import{Config as ca,endsWith as ha,getType as Vs,getTypeNameProp as ma,getTypes as ga}from"@serenity-is/corelib/q";function He(d,n,e){let t;function i(){t=null}function r(l){var u=Vs(l);if(u!=null&&d(u))return u;for(var c of ca.rootNamespaces){var p=c+"."+l;if(u=t[p],u||(u=Vs(c+"."+l),u!=null&&d(u)))return u}}function a(){t={};for(var l of ga())if(d(l)){var u=ma(l);t[u]=l;var c=n&&n(l);c&&c!==u&&(t[c]=l)}if(e){for(var p of Object.keys(t))if(p.endsWith(e)){var g=p.substring(0,p.length-e.length);g&&!t[g]&&(t[g]=t[p])}}}function o(l){var g;if(!l)return null;var u;t==null&&a();var u=t[l];if(u)return u;if(u=r(l),u==null&&e&&!ha(l,e)&&(u=(g=t[l+e])!=null?g:r(l+e)),u){t[l]=u;var c=n&&n(u);if(c&&l!=c&&(t[c]=u),e&&l.endsWith(e)){var p=l.substring(0,l.length-e.length);p&&!t[p]&&(t[p]=t[l])}return u}return u}return{reset:i,tryGet:o}}var mt;(i=>{let d=He(r=>ba(be,r),null,"Dialog");function n(r){if(Ca(r))throw new fa("key");var a=d.tryGet(r);if(a)return a;var o=`"${va(r)}" dialog class not found! 
Make sure there is such a dialog type under the project root namespace, 
and its namespace parts start with capital letters like MyProject.MyModule.MyDialog.

If using ES modules, make sure the dialog type has a decorator like 
@Decorators.registerClass('MyProject.MyModule.MyDialog') with the full name
and "side-effect-import" this dialog class from the current 
"page.ts/grid.ts/dialog.ts file (import "./path/to/MyDialog.ts").

If you had this error from an editor with the InplaceAdd option, verify that the lookup key
and dialog type name match case-sensitively, excluding the Dialog suffix.
Specify the DialogType property in the LookupEditor attribute if it is not.

After applying fixes, build and run "node ./tsbuild.js" (or "tsc" if using namespaces) 
from the project folder.`;throw xa(o.replace(/\r?\n\r?\n/g,"<br/><br/>"),"",{escapeHtml:!1,timeOut:5e3}),new ya(o)}i.get=n;function e(){d.reset()}i.reset=e;function t(r){return d.tryGet(r)}i.tryGet=t})(mt||(mt={}));import{ArgumentNullException as Fa,EditorAttribute as Ea,Exception as Ra,getAttributes as Va,htmlEncode as Na,isAssignableFrom as Qa,isEmptyOrNull as Ba,notifyError as La}from"@serenity-is/corelib/q";var Ns,Ia=typeof jQuery=="function"?jQuery:typeof globalThis.$=="function"?globalThis.$:typeof window!="undefined"?(Ns=window.jQuery)!=null?Ns:window.$:void 0,ee=Ia;function Qs(d){function n(){if(typeof d=="undefined"||!d.ui||!d.ui.dialog||!d.ui.dialog.prototype)return!1;d.ui.dialog.prototype._allowInteraction=function(e){return d(e.target).closest(".ui-dialog").length?!0:!!d(e.target).closest(".ui-datepicker, .select2-drop, .cke, .cke_dialog, .modal, #support-modal").length},function(e){d.ui.dialog.prototype._focusTabbable=function(){if(d(document.documentElement).hasClass("mobile-device")){this.uiDialog&&this.uiDialog.focus();return}e.call(this)}}(d.ui.dialog.prototype._focusTabbable),function(e){d.ui.dialog.prototype._createTitlebar=function(){e.call(this),this.uiDialogTitlebar.find(".ui-dialog-titlebar-close").html('<i class="fa fa-times" />')}}(d.ui.dialog.prototype._createTitlebar)}!n()&&typeof d!="undefined"&&d.fn&&d(n),typeof d!="undefined"&&d.fn&&(d.toJSON||(d.toJSON=JSON.stringify),d.parseJSON||(d.parseJSON=JSON.parse),d.cleanData=function(e){return function(t){var i,r,a,o,l=t;for(a=0;(r=l[a])!=null;a++)try{i=d._data(r,"events"),i&&i.remove&&(l===t&&(l=Array.prototype.slice.call(t)),d(r).triggerHandler("remove"),delete i.remove)}catch(u){}e(t)}}(d.cleanData))}import{addValidationRule as Ta,ArgumentNullException as Sa,Config as ka,Exception as jr,format as Kr,getAttributes as Oa,getInstanceType as Ni,getTypeFullName as Qi,getTypeShortName as wa,isAssignableFrom as Vi,notifyError as _a,replaceAll as Bs,startsWith as Pa}from"@serenity-is/corelib/q";function Da(){var n,e;let d=typeof global!="undefined"?global:typeof window!="undefined"?window:typeof self!="undefined"?self:null;typeof React=="undefined"&&typeof d!="undefined"&&(d.preact!=null?(d.React=d.ReactDOM=d.preact,React.Fragment=(n=React.Fragment)!=null?n:"x-fragment"):d.Nerv!=null?(d.React=d.ReactDOM=d.Nerv,React.Fragment=(e=React.Fragment)!=null?e:"x-fragment"):(d.React={Component:function(){},Fragment:"x-fragment",createElement:function(){return{_reactNotLoaded:!0}}},d.ReactDOM={render:function(){throw Error("To use React, it should be included before Serenity.CoreLib.js")}}))}Da();var b=class{constructor(n,e){if(this.element=n,this.options=e||{},this.widgetName=b.getWidgetName(Ni(this)),this.uniqueName=this.widgetName+(b.nextWidgetNumber++).toString(),n.data(this.widgetName))throw new jr(Kr("The element already has widget '{0}'!",this.widgetName));n.on("remove."+this.widgetName,t=>{t.bubbles||t.cancelable||this.destroy()}).data(this.widgetName,this),this.addCssClass(),this.idPrefix=this.uniqueName+"_",this.renderContents()}destroy(){this.element&&(this.element.removeClass(this.getCssClass()),this.element.off("."+this.widgetName).off("."+this.uniqueName).removeData(this.widgetName),this.element=null)}addCssClass(){this.element.addClass(this.getCssClass())}getCssClass(){var n=Ni(this),e=[],t=Bs(Qi(n),".","-");e.push(t);for(let i of ka.rootNamespaces)if(Pa(t,i+"-")){e.push(t.substr(i.length+1));break}return e.push(wa(n)),e.filter((i,r,a)=>a.indexOf(i)===r).map(i=>"s-"+i).join(" ")}static getWidgetName(n){return Bs(Qi(n),".","_")}static elementFor(n){var e=Oa(n,at,!0),t=e.length>0?e[0].value:"<input/>";return ee(t)}addValidationRule(n,e){return Ta(this.element,n,e)}getGridField(){return this.element.closest(".field")}change(n){this.element.on("change."+this.uniqueName,n)}changeSelect2(n){this.element.on("change."+this.uniqueName,function(e,t){t!==!0&&n(e)})}static create(n){let e;if(Vi(be,n.type))e=new n.type(n.options),n.container&&e.element.appendTo(n.container),n.element&&n.element(e.element);else{var t=b.elementFor(n.type);n.container&&t.appendTo(n.container),n.element&&n.element(t),e=new n.type(t,n.options)}return e.init(null),n.init&&n.init(e),e}initialize(){}init(n){return n&&n(this),this}renderContents(){}};b.nextWidgetNumber=0,b.__isWidgetType=!0,b=h([m.registerClass("Serenity.Widget")],b);typeof ee!="undefined"&&ee.fn&&(ee.fn.tryGetWidget=function(d){var n=this,e;if(Vi(b,d)){var t=b.getWidgetName(d);if(e=n.data(t),e!=null&&!Vi(d,Ni(e))&&(e=null),e!=null)return e}var i=n.data();if(i==null)return null;for(var r of Object.keys(i))if(e=i[r],e!=null&&Vi(d,Ni(e)))return e;return null},ee.fn.getWidget=function(d){if(this==null)throw new Sa("element");if(this.length===0)throw new jr(Kr("Searching for widget of type '{0}' on a non-existent element! ({1})",Qi(d),this.selector));var n=this.tryGetWidget(d);if(n==null){var e=Kr("Element has no widget of type '{0}'! If you have recently changed editor type of a property in a form class, or changed data type in row (which also changes editor type) your script side Form definition might be out of date. Make sure your project builds successfully and transform T4 templates",Qi(d));throw _a(e,"",null),new jr(e)}return n});typeof ee=="function"&&Qs(jQuery);var gt;(i=>{let d=He(r=>!!Va(r,Ea).length||Qa(b,r),null,"Editor");function n(r){if(Ba(r))throw new Fa("key");var a=d.tryGet(r);if(a)return a;var o=`"${Na(r)}" editor class not found! 
Make sure there is such a editor type under the project root namespace,
and its namespace parts start with capital letters like MyProject.MyModule.MyEditor.

If using ES modules, make sure the editor type has a decorator like 
@Decorators.registerEditor('MyProject.MyModule.MyFormatter') with the full name 
and "side-effect-import" this editor class from the current 
"page.ts/grid.ts/dialog.ts file (import "./path/to/MyEditor.ts").

After applying fixes, build and run "node ./tsbuild.js" (or "tsc" if using namespaces) 
from the project folder.`;throw La(o.replace(/\r?\n\r?\n/g,"<br/><br/>"),"",{escapeHtml:!1,timeOut:5e3}),new Ra(o)}i.get=n;function e(){d.reset()}i.reset=e;function t(r){return d.tryGet(r)}i.tryGet=t})(gt||(gt={}));import{Exception as Aa,getAttributes as Ga,htmlEncode as Wa,isEnum as qa,notifyError as Ma}from"@serenity-is/corelib/q";var Ue;(i=>{let d=He(qa,r=>{var a;return(a=Ga(r,z)[0])==null?void 0:a.value},null);function n(r){var a=d.tryGet(r);if(a)return a;var o=`Can't find "${Wa(r)}" enum type! 
If you have recently defined this enum type in server side code, make sure 
your project builds successfully and run "dotnet sergen t". 

Also verify there is such an enum type under the project root namespace, 
and its namespace parts start with capital letters like MyProject.MyModule.MyEnum.

If using ES modules, make sure the enum type is registered with 
Q.registerEnum('MyProject.MyModule.MyDialog') with the full name of 
your enum type and "side-effect-import" this enum from the current 
"page.ts/grid.ts/dialog.ts file (import "./path/to/MyEnum.ts").

After applying fixes, build and run "node ./tsbuild.js" (or "tsc" if using namespaces) 
from the project folder.`;throw Ma(o.replace(/\r?\n\r?\n/g,"<br/><br/>"),"",{escapeHtml:!1,timeOut:5e3}),new Aa(o)}i.get=n;function e(){d.reset()}i.reset=e;function t(r){return d.tryGet(r)}i.tryGet=t})(Ue||(Ue={}));import{ISlickFormatter as Yp}from"@serenity-is/corelib/q";import{executeOnceWhenVisible as Ja,executeEverytimeWhenVisible as $a}from"@serenity-is/corelib/q";var Ce;(e=>(e.executeOnceWhenShown=Ja,e.executeEverytimeWhenShown=$a))(Ce||(Ce={}));var Ls=class{constructor(n){this.idPrefix=n}byId(n){return $("#"+this.idPrefix+n)}w(n,e){return $("#"+this.idPrefix+n).getWidget(e)}};import{htmlEncode as As,isEmptyOrNull as Yr,startsWith as Xr}from"@serenity-is/corelib/q";var ft=class extends b{constructor(n,e){var t,i;super(n,e),n.addClass("s-PopupMenuButton"),n.click(r=>{var l,u,c,p;r.preventDefault(),r.stopPropagation(),this.options.onPopup!=null&&this.options.onPopup();var a=this.options.menu;(p=(c=a.show()).position)==null||p.call(c,{my:(l=this.options.positionMy)!=null?l:"left top",at:(u=this.options.positionAt)!=null?u:"left bottom",of:this.element});var o=this.uniqueName;$(document).one("click."+o,function(g){a.hide()})}),(i=(t=this.options.menu.hide().appendTo(document.body).addClass("s-PopupMenu")).menu)==null||i.call(t)}destroy(){this.options.menu!=null&&(this.options.menu.remove(),this.options.menu=null),super.destroy()}};ft=h([m.registerEditor("Serenity.PopupMenuButton")],ft);var Bi=class extends ft{constructor(n,e){super(n,e),n.addClass("s-PopupToolButton"),$("<b/>").appendTo(n.children(".button-outer").children("span"))}};Bi=h([m.registerEditor("Serenity.PopupToolButton")],Bi);var G=class extends b{constructor(e,t){super(e,t);this.element.addClass("s-Toolbar clearfix").html('<div class="tool-buttons"><div class="buttons-outer"><div class="buttons-inner"></div></div></div>'),this.createButtons()}destroy(){this.element.find("div.tool-button").unbind("click"),this.mouseTrap&&(this.mouseTrap.destroy?this.mouseTrap.destroy():this.mouseTrap.reset(),this.mouseTrap=null),super.destroy()}createButtons(){for(var e=$("div.buttons-inner",this.element).last(),t=this.options.buttons,i=0,r=0;r<t.length;r++){var a=t[r];a.separator&&i>0&&(e=$('<div class="buttons-inner"></div>').appendTo(e.parent()),i=0),this.createButton(e,a),i++}}createButton(e,t){var l;var i=(l=t.cssClass)!=null?l:"",r=$('<div class="tool-button"><div class="button-outer"><span class="button-inner"></span></div></div>').appendTo(e);t.action!=null&&r.attr("data-action",t.action),(t.separator==="right"||t.separator==="both")&&$('<div class="separator"></div>').appendTo(e),i.length>0&&r.addClass(i),Yr(t.hint)||r.attr("title",t.hint),r.click(function(u){r.hasClass("disabled")||t.onClick(u)});var a=t.title;if(t.htmlEncode!==!1&&(a=As(t.title)),!Yr(t.icon)){r.addClass("icon-tool-button");var o=t.icon;Xr(o,"fa-")?o="fa "+o:Xr(o,"glyphicon-")&&(o="glyphicon "+o),a="<i class='"+As(o)+"'></i> "+a}a==null||a.length===0?r.addClass("no-text"):r.find("span").html(a),t.visible===!1&&r.hide(),t.disabled!=null&&typeof t.disabled!="function"&&r.toggleClass("disabled",!!t.disabled),(typeof t.visible=="function"||typeof t.disabled=="function")&&r.on("updateInterface",()=>{typeof t.visible=="function"&&r.toggle(!!t.visible()),typeof t.disabled=="function"&&r.toggleClass("disabled",!!t.disabled())}),!Yr(t.hotkey)&&window.Mousetrap!=null&&(this.mouseTrap=this.mouseTrap||window.Mousetrap(t.hotkeyContext||this.options.hotkeyContext||window.document.documentElement),this.mouseTrap.bind(t.hotkey,function(u,c){return r.is(":visible")&&r.triggerHandler("click"),t.hotkeyAllowDefault}))}findButton(e){return e!=null&&Xr(e,".")&&(e=e.substr(1)),$("div.tool-button."+e,this.element)}updateInterface(){this.element.find(".tool-button").each(function(e,t){$(t).triggerHandler("updateInterface")})}};G=h([m.registerClass("Serenity.Toolbar")],G);import{canLoadScriptData as Li,Config as za,format as Ha,getBaseType as Ua,getInstanceType as Zr,getTemplate as ja,getTypeFullName as es,getTypeShortName as Gs,replaceAll as Ka,startsWith as Ya,localText as Xa}from"@serenity-is/corelib/q";var B=class extends b{byId(n){return $("#"+this.idPrefix+n,this.element)}byID(n,e){return this.byId(n).getWidget(e)}static noGeneric(n){var e=n.indexOf("$");return e>=0?n.substr(0,e):n}getDefaultTemplateName(){return B.noGeneric(Gs(Zr(this)))}getTemplateName(){var n=Zr(this),e=es(n),t=B.templateNames,i=B.templateNames[e];if(i!=null)return i;for(;n&&n!==b;){var r=B.noGeneric(es(n));for(let a of za.rootNamespaces)if(Ya(r,a+".")){r=r.substr(a.length+1);break}if(Li("Template."+r)||(r=Ka(r,".","_"),Li("Template."+r)||$("script#Template_"+r).length>0))return t[e]=r,r;if(r=B.noGeneric(Gs(n)),Li("Template."+r)||$("script#Template_"+r).length>0)return B.templateNames[e]=r,r;n=Ua(n)}return t[e]=i=this.getDefaultTemplateName(),i}getFallbackTemplate(){return null}getTemplate(){var n=this.getTemplateName(),e=$("script#Template_"+n);if(e.length>0)return e.html();let t;if(!Li("Template."+n)&&this.getDefaultTemplateName()==n&&(t=this.getFallbackTemplate(),t!=null))return t;if(t=ja(n),t==null)throw new Error(Ha("Can't locate template for widget '{0}' with name '{1}'!",es(Zr(this)),n));return t}renderContents(){for(var n=this.getTemplate().replace(new RegExp("~_","g"),this.idPrefix),e=0;;){var t=n.indexOf('{{text:"',e);if(t<0)break;var e=n.indexOf('"}}',t);if(e<0)break;var i=n.substr(t+8,e-t-8),r=Xa(i);n=n.substr(0,t)+r+n.substr(e+3),e=t+r.length}this.element.html(n)}useIdPrefix(){return Za(this.idPrefix)}};B.templateNames={},B=h([m.registerClass("Serenity.TemplatedWidget")],B);function Za(d){return new Proxy({_:d!=null?d:""},eo)}var eo={get(d,n){return n.startsWith("#")?"#"+d._+n.substring(1):d._+n}};import{bsModalMarkup as to,closePanel as io,Config as ro,dialogButtonToBS as so,dialogButtonToUI as no,endsWith as ao,getAttributes as ti,getInstanceType as Gi,isEmptyOrNull as oo,layoutFillHeight as lo,newBodyDiv as uo,openPanel as po,parseInteger as co,positionToastContainer as ho,validateOptions as mo}from"@serenity-is/corelib/q";typeof $!="undefined"&&$.fn&&($.fn.flexHeightOnly=function(d=1){return this.flexWidthHeight(0,d)},$.fn.flexWidthOnly=function(d=1){return this.flexWidthHeight(d,0)},$.fn.flexWidthHeight=function(d=1,n=1){return this.addClass("flexify").data("flex-x",d).data("flex-y",n)},$.fn.flexX=function(d){return this.data("flex-x",d)},$.fn.flexY=function(d){return this.data("flex-y",d)});var Ai=class extends b{constructor(e,t){super(e,t);this.xDifference=0;this.yDifference=0;Ce.executeOnceWhenShown(e,()=>{this.storeInitialSize()})}storeInitialSize(){if(!this.element.data("flexify-init")){var e=this.options.designWidth;e==null&&(e=this.element.width()),this.element.data("flexify-width",e);var t=this.options.designHeight;t==null&&(t=this.element.height()),this.element.data("flexify-height",t),this.element.data("flexify-init",!0),this.element.on("resize."+this.uniqueName,()=>this.resizeElements()),this.element.on("resizestop."+this.uniqueName,()=>this.resizeElements());var i=this.element.find(".ui-tabs");i.length>0&&i.on("tabsactivate."+this.uniqueName,()=>this.resizeElements()),(this.options.designWidth!=null||this.options.designHeight!=null)&&this.resizeElements()}}getXFactor(e){var t=null;return this.options.getXFactor!=null&&(t=this.options.getXFactor(e)),t==null&&(t=e.data("flex-x")),t!=null?t:1}getYFactor(e){var t=null;return this.options.getYFactor!=null&&(t=this.options.getYFactor(e)),t==null&&(t=e.data("flex-y")),t!=null?t:0}resizeElements(){var e=this.element.width(),t=this.element.data("flexify-width");t==null&&(this.element.data("flexify-width",e),t=e);var i=this.element.height(),r=this.element.data("flexify-height");r==null&&(this.element.data("flexify-height",i),r=i),this.xDifference=e-t,this.yDifference=i-r;var a=this.element,o=this.element.find(".ui-tabs-panel");o.length>0&&(a=o.filter(":visible")),a.find(".flexify").add(o.filter(".flexify:visible")).each((l,u)=>{this.resizeElement($(u))})}resizeElement(e){var t=this.getXFactor(e);if(t!==0){var i=e.data("flexify-width");if(i==null){var r=e.width();e.data("flexify-width",r),i=r}e.width(i+t*this.xDifference|0)}var a=this.getYFactor(e);if(a!==0){var o=e.data("flexify-height");if(o==null){var l=e.height();e.data("flexify-height",l),o=l}e.height(o+a*this.yDifference|0)}e.hasClass("require-layout")&&e.triggerHandler("layout")}};var je;(t=>{function d(i,r,a,o,l){var c;var u=(c=i==null?void 0:i.dialog)==null?void 0:c.call(i);return u.dialog("option","resizable",!0),o!=null&&u.dialog("option","minWidth",o),r!=null&&u.dialog("option","width",r),l!=null&&u.dialog("option","minHeight",l),a!=null&&u.dialog("option","height",a),i}t.dialogResizable=d;function n(i){return i.dialogExtend({closable:!0,maximizable:!0,dblclick:"maximize",icons:{maximize:"ui-icon-maximize-window"}}),i}t.dialogMaximizable=n;function e(i){return new Ai(i.closest(".ui-dialog"),{}),i}t.dialogFlexify=e})(je||(je={}));var Ws,qs=(Ws=ee)==null?void 0:Ws.validator;var N=class extends B{constructor(e){super(uo().addClass("s-TemplatedDialog hidden"),e);this.element.attr("id",this.uniqueName),this.initValidator(),this.initTabs(),this.initToolbar()}get isMarkedAsPanel(){var e=ti(Gi(this),pt,!0);return e.length>0&&e[e.length-1].value!==!1}get isResponsive(){return ro.responsiveDialogs||ti(Gi(this),ht,!0).length>0}static getCssSize(e,t){var i=e.css(t);if(i==null||!ao(i,"px"))return null;i=i.substr(0,i.length-2);let r=co(i);return r==null||isNaN(r)||r==0?null:r}static applyCssSizes(e,t){let i,r=$("<div/>").hide().addClass(t).appendTo(document.body);try{var a=$("<div/>").addClass("size").appendTo(r);i=N.getCssSize(a,"minWidth"),i!=null&&(e.minWidth=i),i=N.getCssSize(a,"width"),i!=null&&(e.width=i),i=N.getCssSize(a,"height"),i!=null&&(e.height=i),i=N.getCssSize(a,"minHeight"),i!=null&&(e.minHeight=i)}finally{r.remove()}}destroy(){var t,i,r,a,o,l,u;if((i=(t=this.tabs)==null?void 0:t.tabs)==null||i.call(t,"destroy"),this.tabs=null,(o=(a=(r=this.toolbar)==null?void 0:r.toolbar)==null?void 0:a.destroy)==null||o.call(a),this.toolbar=null,this.validator&&this.byId("Form").remove(),this.validator=null,this.element!=null&&this.element.hasClass("ui-dialog-content"))(u=(l=this.element)==null?void 0:l.dialog)==null||u.call(l,"destroy"),this.element.removeClass("ui-dialog-content");else if(this.element!=null&&this.element.hasClass("modal-body")){var e=this.element.closest(".modal").data("bs.modal",null);this.element&&this.element.removeClass("modal-body"),window.setTimeout(()=>e.remove(),0)}$(window).unbind("."+this.uniqueName),super.destroy()}initDialog(){var i,r;if(this.element.hasClass("ui-dialog-content"))return;this.element.removeClass("hidden"),(r=(i=this.element)==null?void 0:i.dialog)==null||r.call(i,this.getDialogOptions()),this.element.closest(".ui-dialog").on("resize",a=>this.arrange());let e=Gi(this);this.isResponsive?(je.dialogResizable(this.element),$(window).bind("resize."+this.uniqueName,a=>{this.element&&this.element.is(":visible")&&this.handleResponsive()}),this.element.closest(".ui-dialog").addClass("flex-layout")):je.dialogFlexify&&ti(e,lt,!0).length>0&&(je.dialogFlexify(this.element),je.dialogResizable(this.element)),ti(e,dt,!0).length>0&&je.dialogMaximizable(this.element);var t=this;this.element.bind("dialogopen."+this.uniqueName,()=>{$(document.body).addClass("modal-dialog-open"),this.isResponsive&&this.handleResponsive(),t.onDialogOpen()}),this.element.bind("dialogclose."+this.uniqueName,()=>{$(document.body).toggleClass("modal-dialog-open",$(".ui-dialog:visible").length>0),t.onDialogClose()})}getModalOptions(){return{backdrop:!1,keyboard:!1,size:"lg",modalClass:this.getCssClass()}}initModal(){var c,p;if(!this.element.hasClass("modal-body")){var e=(p=(c=this.element.data("dialogtitle"))!=null?c:this.getDialogTitle())!=null?p:"",t=this.getModalOptions();t.show=!1;var i="s-Modal";t.modalClass&&(i+=" "+t.modalClass);var r=to(e,"",i),a=$(r).appendTo(document.body).addClass("flex-layout");a.one("shown.bs.modal."+this.uniqueName,()=>{this.element.triggerHandler("shown.bs.modal"),this.onDialogOpen()}),a.one("hidden.bs.modal."+this.uniqueName,()=>{$(document.body).toggleClass("modal-open",$(".modal.show").length+$(".modal.in").length>0),this.onDialogClose()}),t.size&&a.find(".modal-dialog").addClass("modal-"+t.size);var o=a.find(".modal-footer"),l=this.getDialogButtons();if(l!=null)for(var u of l)$(so(u)).appendTo(o).click(u.click);else o.hide();a.modal(t),a.find(".modal-body").replaceWith(this.element.removeClass("hidden").addClass("modal-body")),$(window).on("resize."+this.uniqueName,this.arrange.bind(this))}}initToolbar(){var e=this.byId("Toolbar");if(e.length!==0){var t=this.element.closest(".ui-dialog");t.length===0&&(t=this.element.closest(".modal"),t.length==0&&(t=this.element));var i={buttons:this.getToolbarButtons(),hotkeyContext:t[0]};this.toolbar=new G(e,i)}}getToolbarButtons(){return[]}getValidatorOptions(){return{}}initValidator(){var e=this.byId("Form");if(e.length>0){var t=this.getValidatorOptions();this.validator=(qs||e.validate)&&e.validate(mo(t))}}resetValidation(){this.validator&&this.validator.resetAll()}validateForm(){return this.validator==null||!!this.validator.form()}dialogOpen(e){var t,i;e=e!=null?e:this.isMarkedAsPanel,e?(this.element.hasClass("s-Panel")||(this.element.on("panelopen."+this.uniqueName,()=>{this.onDialogOpen()}),this.element.on("panelclose."+this.uniqueName,()=>{this.onDialogClose()})),N.openPanel(this.element,this.uniqueName),this.setupPanelTitle()):this.useBSModal()?(this.initModal(),this.element.closest(".modal").modal("show")):(this.initDialog(),(i=(t=this.element).dialog)==null||i.call(t,"open"))}useBSModal(){var e;return!!(!$.ui||!((e=$.ui)!=null&&e.dialog)||N.bootstrapModal)}static openPanel(e,t){return po(e,t)}static closePanel(e,t){return io(e,t)}onDialogOpen(){var e,t;$(document.documentElement).hasClass("mobile-device")||$(":input",this.element).not("button").eq(0).focus(),this.arrange(),this.tabs&&((t=(e=this.tabs).tabs)==null||t.call(e,"option","active",0))}arrange(){this.element.find(".require-layout").filter(":visible").each(function(e,t){$(t).triggerHandler("layout")})}onDialogClose(){$(document).trigger("click"),$.qtip&&$(document.body).children(".qtip").each(function(e,t){$(t).qtip("hide")}),window.setTimeout(()=>{var e=this.element;this.destroy(),e.remove(),ho(!1,null)},0)}addCssClass(){this.isMarkedAsPanel&&(super.addCssClass(),this.isResponsive&&this.element.addClass("flex-layout"))}getDialogButtons(){}getDialogOptions(){var a,o;var e={},t="s-Dialog "+this.getCssClass();e.dialogClass=t;var i=this.getDialogButtons();i!=null&&(e.buttons=i.map(no)),e.width=920,N.applyCssSizes(e,t),e.autoOpen=!1;let r=Gi(this);return e.resizable=ti(r,ct,!0).length>0,e.modal=!0,e.position={my:"center",at:"center",of:$(window.window)},e.title=(o=(a=this.element.data("dialogtitle"))!=null?a:this.getDialogTitle())!=null?o:"",e}getDialogTitle(){return""}dialogClose(){var e,t,i,r;this.element.hasClass("ui-dialog-content")?(r=(t=(e=this.element).dialog)==null?void 0:(i=t.call(e)).dialog)==null||r.call(i,"close"):this.element.hasClass("modal-body")?this.element.closest(".modal").modal("hide"):this.element.hasClass("s-Panel")&&!this.element.hasClass("hidden")&&N.closePanel(this.element)}get dialogTitle(){var e,t;return this.element.hasClass("ui-dialog-content")?(t=(e=this.element).dialog)==null?void 0:t.call(e,"option","title"):this.element.hasClass("modal-body")?this.element.closest(".modal").find(".modal-header").children("h5").text():this.element.data("dialogtitle")}setupPanelTitle(){var i;var e=(i=this.dialogTitle)!=null?i:this.getDialogTitle(),t=this.element.children(".panel-titlebar");oo(e)?t.remove():(this.element.children(".panel-titlebar").length||(t=$("<div class='panel-titlebar'><div class='panel-titlebar-text'></div></div>").prependTo(this.element)),t.children(".panel-titlebar-text").text(e),this.element.hasClass("s-Panel")&&(t.children(".panel-titlebar-close").length||$('<button class="panel-titlebar-close">&nbsp;</button>').prependTo(t).click(r=>{N.closePanel(this.element,r)})))}set dialogTitle(e){var i,r;var t=this.dialogTitle;this.element.data("dialogtitle",e),this.element.hasClass("ui-dialog-content")?(r=(i=this.element).dialog)==null||r.call(i,"option","title",e):this.element.hasClass("modal-body")?this.element.closest(".modal").find(".modal-header").children("h5").text(e!=null?e:""):this.element.hasClass("s-Panel")&&t!=this.dialogTitle&&(this.setupPanelTitle(),this.arrange())}set_dialogTitle(e){this.dialogTitle=e}initTabs(){var t;var e=this.byId("Tabs");e.length!==0&&(this.tabs=(t=e.tabs)==null?void 0:t.call(e,{}),this.tabs.bind("tabsactivate",()=>this.arrange()))}handleResponsive(){var o;var e=(o=this.element)==null?void 0:o.dialog(),t=this.element.closest(".ui-dialog");if($(document.documentElement).hasClass("mobile-device")){var i=this.element.data("responsiveData");if(!i){i={},i.draggable=e.dialog("option","draggable"),i.resizable=e.dialog("option","resizable"),i.position=e.css("position");var r=t.position();i.left=r.left,i.top=r.top,i.width=t.width(),i.height=t.height(),i.contentHeight=this.element.height(),this.element.data("responsiveData",i),e.dialog("option","draggable",!1),e.dialog("option","resizable",!1)}t.addClass("mobile-layout"),t.css({left:"0px",top:"0px",width:$(window).width()+"px",height:$(window).height()+"px",position:"fixed"}),$(document.body).scrollTop(0),lo(this.element)}else{var a=this.element.data("responsiveData");a&&(e.dialog("option","draggable",a.draggable),e.dialog("option","resizable",a.resizable),this.element.closest(".ui-dialog").css({left:"0px",top:"0px",width:a.width+"px",height:a.height+"px",position:a.position}),this.element.height(a.contentHeight),t.removeClass("mobile-layout"),this.element.removeData("responsiveData"))}}};N=h([m.registerClass("Serenity.TemplatedDialog",[be])],N);import{validateOptions as go}from"@serenity-is/corelib/q";var _t=class extends B{constructor(e,t){super(e,t);this.initValidator(),this.initTabs(),this.initToolbar()}destroy(){var e,t;this.tabs&&((t=(e=this.tabs).tabs)==null||t.call(e,"destroy"),this.tabs=null),this.toolbar&&(this.toolbar.destroy(),this.toolbar=null),this.validator&&(this.byId("Form").remove(),this.validator=null),super.destroy()}arrange(){this.element.find(".require-layout").filter(":visible").each(function(e,t){$(t).triggerHandler("layout")})}getToolbarButtons(){return[]}getValidatorOptions(){return{}}initTabs(){var t;var e=this.byId("Tabs");e.length!==0&&(this.tabs=(t=e.tabs)==null?void 0:t.call(e,{}))}initToolbar(){var e=this.byId("Toolbar");if(e.length!==0){var t={buttons:this.getToolbarButtons()};this.toolbar=new G(e,t)}}initValidator(){var e=this.byId("Form");if(e.length>0){var t=this.getValidatorOptions();this.validator=e.validate(go(t))}}resetValidation(){this.validator&&this.validator.resetAll()}validateForm(){return this.validator==null||!!this.validator.form()}};_t=h([m.registerClass("Serenity.TemplatedPanel")],_t);import{Exception as fo,validatorAbortHandler as yo}from"@serenity-is/corelib/q";var Pt;(t=>{function d(i,r,a){var o=i.validate(),l=o.settings;return l.abortHandler||r!=null&&r()===!1?!1:(l.abortHandler=yo,l.submitHandler=function(){return a!=null&&a(),!1},i.trigger("submit"),!0)}t.asyncSubmit=d;function n(i,r,a){var o=i.validate(),l=o.settings;return l.abortHandler!=null||r!=null&&r()===!1||!o.form()?!1:(a!=null&&a(),!0)}t.submit=n;function e(i){var r=i.closest("form");return r.length===0?null:r.data("validator")}t.getValidator=e})(Pt||(Pt={}));var Ms;(t=>{function d(i,r,a){if(!i.length)return i;if(a==null)throw new fo("rule is null!");return i.addClass("customValidate").bind("customValidate."+r,a),i}t.addValidationRule=d;function n(i,r){return i.unbind("customValidate."+r),i}t.removeValidationRule=n;function e(i,r){return i.element(r.element[0])}t.validateElement=e})(Ms||(Ms={}));import{findElementWithRelativeId as Js,isEmptyOrNull as $s,notifyError as vo}from"@serenity-is/corelib/q";var Ke=class{constructor(n,e,t){this.parentType=n;this.widget=e;this.parentChange=t;this.bind(),this.widget.element.bind("remove."+e.uniqueName+"cwh",i=>{this.unbind(),this.widget=null,this.parentChange=null})}bind(){if($s(this._parentID))return null;var n=Js(this.widget.element,this._parentID).tryGetWidget(this.parentType);return n!=null?(n.element.bind("change."+this.widget.uniqueName,()=>{this.parentChange(n)}),n):(vo("Can't find cascaded parent element with ID: "+this._parentID+"!","",null),null)}unbind(){if($s(this._parentID))return null;var n=Js(this.widget.element,this._parentID).tryGetWidget(this.parentType);return n!=null&&n.element.unbind("."+this.widget.uniqueName),n}get_parentID(){return this._parentID}set_parentID(n){this._parentID!==n&&(this.unbind(),this._parentID=n,this.bind())}};Ke=h([m.registerClass("Serenity.CascadedWidgetLink")],Ke);var Wi;(r=>{function d(a,o,l){var p,g;if(a){var u=t(a);if(u){var c=u[o];c!=null&&(l&&c===a.tabs("option","active")&&((p=a.tabs)==null||p.call(a,"option","active",0)),(g=a.tabs)==null||g.call(a,l?"disable":"enable",c))}}}r.setDisabled=d;function n(a,o,l){var p,g;if(a){var u=t(a);if(u){var c=u[o];c!=null&&(!l&&c===((p=a.tabs)==null?void 0:p.call(a,"option","active"))&&((g=a.tabs)==null||g.call(a,"option","active",0)),a.children("ul").children("li").eq(c).toggle(l))}}}r.toggle=n;function e(a){var c;var o=a.children("ul").children("li").eq((c=a.tabs)==null?void 0:c.call(a,"option","active")).children("a").attr("href").toString(),l="_Tab",u=o.lastIndexOf(l);return u>=0&&(o=o.substr(u+l.length)),o}r.activeTabKey=e;function t(a){var o=a.data("indexByKey");return o||(o={},a.children("ul").children("li").children("a").each(function(l,u){var c=u.getAttribute("href").toString(),p="_Tab",g=c.lastIndexOf(p);g>=0&&(c=c.substr(g+p.length)),o[c]=l}),a.data("indexByKey",o)),o}r.indexByKey=t;function i(a,o){var c,p;var l=t(a);if(l){var u=l[o];u!=null&&u!==((c=a.tabs)==null?void 0:c.call(a,"option","active"))&&((p=a.tabs)==null||p.call(a,"option","active",u))}}r.selectTab=i})(Wi||(Wi={}));import{getInstanceType as bo,getMembers as zs,isInstanceOfType as qi,MemberType as Hs}from"@serenity-is/corelib/q";var ne;(n=>{function d(e,t){if(t!=null){var i=bo(e);if(i!==Object){var r=i.__propByName,a=i.__fieldByName;if(r==null){var o=zs(i,Hs.property),l=o.filter(function(x){return!!x.setter&&((x.attr||[]).filter(function(I){return qi(I,ze)}).length>0||(x.attr||[]).filter(function(I){return qi(I,De)}).length>0)});r={};for(var u of l)r[se.makeCamelCase(u.name)]=u;i.__propByName=r}if(a==null){var c=zs(i,Hs.field),p=c.filter(function(x){return(x.attr||[]).filter(function(I){return qi(I,ze)}).length>0||(x.attr||[]).filter(function(I){return qi(I,De)}).length>0});a={};for(var g=0;g<p.length;g++){var f=p[g];a[se.makeCamelCase(f.name)]=f}i.__fieldByName=a}var y=Object.keys(t);for(var v of y){var C=t[v],T=se.makeCamelCase(v),w=r[T]||r[v];if(w!=null){var k=e[w.setter];k&&k.call(e,C)}else{var _=a[T]||a[v];_&&(e[_.name]=C)}}}}}n.set=d})(ne||(ne={}));import{any as js,Authorization as is,Culture as To,extend as Ks,getAttributes as So,getTypeShortName as Ys,isBS3 as rs,isBS5Plus as ko,isEmptyOrNull as Qe,startsWith as Xs,localText as Oo,trimToEmpty as Zs,trimToNull as en,tryGetText as tn}from"@serenity-is/corelib/q";import{cast as ii,isInstanceOfType as ts,isTrimmedEmpty as Co,parseDecimal as xo,safeCast as xe,localText as Io,tryGetText as Us}from"@serenity-is/corelib/q";var S;(c=>{function d(p){var v,C,T;var g=p.element.data("select2");if(g!=null){var f=p.element.select2("data");return f==null?"":(v=f.text)!=null?v:""}var y=e(p);return y==null?"":typeof y=="string"?y:y instanceof Boolean?y?(C=Us("Controls.FilterPanel.OperatorNames.true"))!=null?C:"True":(T=Us("Controls.FilterPanel.OperatorNames.true"))!=null?T:"False":y.toString()}c.getDisplayText=d;var n={name:"_"};function e(p){var g={};return t(p,n,g),g._}c.getValue=e;function t(p,g,f){var y=xe(p,X);if(y!=null){y.getEditValue(g,f);return}var v=xe(p,D);if(v!=null){f[g.name]=v.get_value();return}var C=xe(p,Re);if(C!=null){f[g.name]=C.get_value();return}var T=xe(p,Y);if(T!=null){var w=T.get_value();f[g.name]=isNaN(w)?null:w;return}if(p.getEditValue!=null){p.getEditValue(g,f);return}if(p.element.is(":input")){f[g.name]=p.element.val();return}}c.saveValue=t;function i(p,g){var f={_:g};r(p,n,f)}c.setValue=i;function r(p,g,f){var y=xe(p,Z);if(y!=null){y.setEditValue(f,g);return}var v=xe(p,D);if(v!=null){var C=f[g.name];C!=null&&(C=C.toString()),v.set_value(ii(C,String));return}var T=xe(p,Re);if(T!=null){var w=f[g.name];typeof w=="number"?T.set_value(w>0):T.set_value(!!w);return}var k=xe(p,Y);if(k!=null){var _=f[g.name];_==null||ts(_,String)&&Co(ii(_,String))?k.set_value(null):ts(_,String)?k.set_value(ii(xo(ii(_,String)),Number)):ts(_,Boolean)?k.set_value(_?1:0):k.set_value(ii(_,Number));return}if(p.setEditValue!=null){p.setEditValue(f,g);return}if(p.element.is(":input")){var x=f[g.name];x==null?p.element.val(""):p.element.val(x);return}}c.loadValue=r;function a(p,g){return p.each(function(f,y){var v=$(y),C=v.attr("type");return v.is("select")||C==="radio"||C==="checkbox"?g?v.addClass("readonly").attr("disabled","disabled"):v.removeClass("readonly").removeAttr("disabled"):g?v.addClass("readonly").attr("readonly","readonly"):v.removeClass("readonly").removeAttr("readonly"),!0}),p}c.setReadonly=a;function o(p,g){var f=xe(p,R);f!=null?f.set_readOnly(g):p.element.is(":input")&&a(p.element,g)}c.setReadOnly=o;function l(p,g){var f=xe(p,Ne);f!=null?f.set_required(g):p.element.is(":input")&&p.element.toggleClass("required",!!g);var y=p.element.closest(".field"),v=y.find("sup").get().length>0;g&&!v?$("<sup>*</sup>").attr("title",Io("Controls.PropertyGrid.RequiredHint")).prependTo(y.find(".caption")[0]):!g&&v&&$(y.find("sup")[0]).remove()}c.setRequired=l;function u(p,g){if(!g){if(!p.hasClass("readonly-container"))return;p.removeClass("readonly-container").find(".editor.container-readonly").removeClass("container-readonly").each((f,y)=>{var v=$(y).tryGetWidget(b);v!=null?c.setReadOnly(v,!1):c.setReadonly($(y),!1)});return}p.addClass("readonly-container").find(".editor").not(".container-readonly").each((f,y)=>{var v=$(y).tryGetWidget(b);if(v!=null){if(v.get_readOnly){if(v.get_readOnly())return}else if($(y).is("[readonly]")||$(y).is("[disabled]")||$(y).is(".readonly")||$(y).is(".disabled"))return;$(y).addClass("container-readonly"),c.setReadOnly(v,!0)}else{if($(y).is("[readonly]")||$(y).is("[disabled]")||$(y).is(".readonly")||$(y).is(".disabled"))return;c.setReadonly($(y).addClass("container-readonly"),!0)}})}c.setContainerReadOnly=u})(S||(S={}));var q=class extends b{constructor(e,t){var w;super(e,t);this.categoryLinkClick=e=>{e.preventDefault();var t=$("a[name="+e.target.getAttribute("href").toString().substr(1)+"]");t.closest(".category").hasClass("collapsed")&&t.closest(".category").children(".category-title").click();var i=function(){$.fn.fadeTo&&t.fadeTo(100,.5,function(){t.fadeTo(100,1,function(){})})},r=t.closest(".category");$.fn.scrollintoview?r.closest(":scrollable(both)").length===0?i():r.scrollintoview({duration:"fast",direction:"y",complete:i}):r&&r[0]&&r[0].scrollIntoView&&(r[0].scrollIntoView(),i())};this.idPrefix=this.options.idPrefix=(w=this.options.idPrefix)!=null?w:this.idPrefix,this.options.mode==null&&(this.options.mode=1),e.addClass("s-PropertyGrid"),this.editors=[];var i=this.options.items||[];this.items=[];var r=js(i,function(k){return!Qe(k.tab)});if(r){var a=i.filter(k=>Qe(k.tab));a.length>0&&(this.createItems(this.element,a),$("<div class='pad'></div>").appendTo(this.element));for(var o=i.filter(k=>!Qe(k.tab)),l=$("<ul class='nav nav-tabs property-tabs' role='tablist'></ul>").appendTo(this.element),u=$("<div class='tab-content property-panes'></div>").appendTo(this.element),c=0,p=0;p<o.length;){var g={$:Zs(o[p].tab)},f=[],y=p;do f.push(o[y]);while(++y<o.length&&Zs(o[y].tab)===g.$);p=y;var v=$(rs()?'<li><a data-toggle="tab" role="tab"></a></li>':`<li class="nav-item"><a class="nav-link" data-${ko()?"bs-":""}toggle="tab" role="tab"></a></li>`).appendTo(l);c===0&&(rs()?v.addClass("active"):v.children("a").addClass("active"));var C=this.uniqueName+"_Tab"+c;v.children("a").attr("href","#"+C).text(this.determineText(g.$,function(k){return k+"Tabs."+this.tab.$}.bind({tab:g})));var T=$("<div class='tab-pane fade' role='tabpanel'>").appendTo(u);c===0&&T.addClass(rs()?"in active":"show active"),T.attr("id",C),this.createItems(T,f),c++}}else this.createItems(this.element,i);this.updateInterface()}destroy(){if(this.editors!=null){for(var e=0;e<this.editors.length;e++)this.editors[e].destroy();this.editors=null}this.element.find("a.category-link").unbind("click",this.categoryLinkClick).remove(),b.prototype.destroy.call(this)}createItems(e,t){var v,C;var i={},r=e,a=this.options.useCategories!==!1&&js(t,function(T){return!Qe(T.category)});if(a){var o=$("<div/>").addClass("category-links");i=this.createCategoryLinks(o,t),Object.keys(i).length>1?o.appendTo(e):o.find("a.category-link").unbind("click",this.categoryLinkClick).remove()}r=$("<div/>").addClass("categories").appendTo(e);var l;a?l=r:l=$("<div/>").addClass("category").appendTo(r);for(var u=null,c=0;c<t.length;c++){var p=t[c],g=p.category;if(g==null&&(g=(v=this.options.defaultCategory)!=null?v:""),a&&u!==g){var f=this.createCategoryDiv(r,i,g,p.collapsible!==!0?null:(C=p.collapsed)!=null?C:!1);u==null&&f.addClass("first-category"),u=g,l=f}var y=this.createField(l,p);this.items.push(p),this.editors.push(y)}}createCategoryDiv(e,t,i,r){var a=$("<div/>").addClass("category").appendTo(e),o=$("<div/>").addClass("category-title").append($("<a/>").addClass("category-anchor").text(this.determineText(i,function(u){return u+"Categories."+i})).attr("name",this.idPrefix+"Category"+t[i].toString())).appendTo(a);if(r!=null){a.addClass(r===!0?"collapsible collapsed":"collapsible");var l=$("<i/>").addClass(r===!0?"fa fa-plus":"fa fa-minus").appendTo(o);o.click(function(u){a.toggleClass("collapsed"),l.toggleClass("fa-plus").toggleClass("fa-minus")})}return a}determineText(e,t){if(e!=null&&!Xs(e,"`")){var i=tn(e);if(i!=null)return i}if(e!=null&&Xs(e,"`")&&(e=e.substring(1)),!Qe(this.options.localTextPrefix)){var r=tn(t(this.options.localTextPrefix));if(r!=null)return r}return e}createField(e,t){var T,w;var i=$("<div/>").addClass("field").addClass(t.name).data("PropertyItem",t).appendTo(e);if(Qe(t.cssClass)||i.addClass(t.cssClass),!Qe(t.formCssClass)&&(i.addClass(t.formCssClass),t.formCssClass.indexOf("line-break-")>=0)){var r=t.formCssClass.split(String.fromCharCode(32));r.indexOf("line-break-xs")>=0?$("<div class='line-break' style='width: 100%' />").insertBefore(i):r.indexOf("line-break-sm")>=0?$("<div class='line-break hidden-xs' style='width: 100%' />").insertBefore(i):r.indexOf("line-break-md")>=0?$("<div class='line-break hidden-sm' style='width: 100%' />").insertBefore(i):r.indexOf("line-break-lg")>=0&&$("<div class='line-break hidden-md' style='width: 100%' />").insertBefore(i)}var a=this.idPrefix+t.name,o=this.determineText(t.title,function(k){return k+t.name}),l=this.determineText(t.hint,function(k){return k+t.name+"_Hint"}),u=this.determineText(t.placeholder,function(k){return k+t.name+"_Placeholder"});l==null&&(l=o!=null?o:"");var c=$("<label/>").addClass("caption").attr("for",a).attr("title",l).text(o!=null?o:"").appendTo(i);Qe(t.labelWidth)||(t.labelWidth==="0"?c.hide():c.css("width",t.labelWidth)),t.required===!0&&$("<sup>*</sup>").attr("title",Oo("Controls.PropertyGrid.RequiredHint")).prependTo(c);var p=gt.get((T=t.editorType)!=null?T:"String"),g=b.elementFor(p).addClass("editor").attr("id",a).appendTo(i);g.is(":input")&&g.attr("name",(w=t.name)!=null?w:""),Qe(u)||g.attr("placeholder",u);var f=t.editorParams,y=null,v=So(p,ut,!0);v!=null&&v.length>0&&(y=v[0].optionsType);var C;return y!=null?(f=Ks(new y,t.editorParams),C=new p(g,f)):(f=Ks(new Object,t.editorParams),C=new p(g,f)),C.initialize(),Ys(C)=="BooleanEditor"&&(t.editorParams==null||!t.editorParams.labelFor)&&c.removeAttr("for"),Ys(C)=="RadioButtonEditor"&&(t.editorParams==null||!t.editorParams.labelFor)&&c.removeAttr("for"),t.maxLength!=null&&q.setMaxLength(C,t.maxLength),t.editorParams!=null&&ne.set(C,t.editorParams),$("<div/>").addClass("vx").appendTo(i),$("<div/>").addClass("clear").appendTo(i),C}getCategoryOrder(e){var p;var t=0,i={},r=en(this.options.categoryOrder);if(r!=null){var a=r.split(";");for(var o of a){var l=en(o);l!=null&&i[l]==null&&(i[l]=t++)}}for(var u of e){var c=u.category;c==null&&(c=(p=this.options.defaultCategory)!=null?p:""),i[c]==null&&(i[c]=t++)}return i}createCategoryLinks(e,t){var T;var i=0,r={},a={};for(var o of t){var l=o.name,u=o.category;u==null&&(u=(T=this.options.defaultCategory)!=null?T:""),a[l]=u,r[o.name]=i++}var c=this,p=this.getCategoryOrder(t);t.sort(function(w,k){var _=0,x=a[w.name],I=a[k.name];if(x!=I){var E=p[x],j=p[I];E!=null&&j!=null?_=E-j:E!=null?_=-1:j!=null&&(_=1)}return _===0&&(_=To.stringCompare(x,I)),_===0&&(_=r[w.name]<r[k.name]?-1:r[w.name]>r[k.name]?1:0),_});for(var g={},f=0;f<t.length;f++){var y=t[f],v={$:a[y.name]};if(g[v.$]==null){var C=Object.keys(g).length+1;g[v.$]=C,C>1&&$("<span/>").addClass("separator").text("|").prependTo(e),$("<a/>").addClass("category-link").text(this.determineText(v.$,function(w){return w+"Categories."+this.category.$}.bind({category:v}))).attr("tabindex","-1").attr("href","#"+this.idPrefix+"Category"+C.toString()).click(this.categoryLinkClick).prependTo(e)}}return $("<div/>").addClass("clear").appendTo(e),g}get_editors(){return this.editors}get_items(){return this.items}get_idPrefix(){return this.idPrefix}get_mode(){return this.options.mode}set_mode(e){this.options.mode!==e&&(this.options.mode=e,this.updateInterface())}static loadEditorValue(e,t,i){}static saveEditorValue(e,t,i){S.saveValue(e,t,i)}static setReadOnly(e,t){S.setReadOnly(e,t)}static setReadonly(e,t){return S.setReadonly(e,t)}static setRequired(e,t){S.setRequired(e,t)}static setMaxLength(e,t){e.element.is(":input")&&(t>0?e.element.attr("maxlength",t):e.element.removeAttr("maxlength"))}load(e){for(var t=0;t<this.editors.length;t++){var i=this.items[t],r=this.editors[t];this.get_mode()===1&&i.defaultValue!=null&&typeof e[i.name]=="undefined"&&(e[i.name]=i.defaultValue),S.loadValue(r,i,e)}}save(e){e==null&&(e=Object.create(null));for(var t=0;t<this.editors.length;t++){var i=this.items[t];if(i.oneWay!==!0&&this.canModifyItem(i)){var r=this.editors[t];S.saveValue(r,i,e)}}return e}get value(){return this.save()}set value(e){e==null&&(e=Object.create(null)),this.load(e)}canModifyItem(e){return this.get_mode()===ri.insert?e.insertable===!1?!1:e.insertPermission==null?!0:is.hasPermission(e.insertPermission):this.get_mode()===ri.update?e.updatable===!1?!1:e.updatePermission==null?!0:is.hasPermission(e.updatePermission):!0}updateInterface(){for(var e=0;e<this.editors.length;e++){var t=this.items[e],i=this.editors[e],r=t.readOnly===!0||!this.canModifyItem(t);if(S.setReadOnly(i,r),S.setRequired(i,!r&&!!t.required&&t.editorType!=="Boolean"),t.visible===!1||t.readPermission!=null||t.insertPermission!=null||t.updatePermission!=null||t.hideOnInsert===!0||t.hideOnUpdate===!0){var a=t.readPermission!=null&&!is.hasPermission(t.readPermission)||t.visible===!1||this.get_mode()===ri.insert&&t.hideOnInsert===!0||this.get_mode()===2&&t.hideOnUpdate===!0;i.getGridField().toggle(!a)}}}enumerateItems(e){for(var t=0;t<this.editors.length;t++){var i=this.items[t],r=this.editors[t];e(i,r)}}};q=h([m.registerClass("Serenity.PropertyGrid")],q);var ri=(e=>(e[e.insert=1]="insert",e[e.update=2]="update",e))(ri||{});import{endsWith as rn,getAttributes as wo,getForm as _o,getInstanceType as sn,getTypeFullName as Po}from"@serenity-is/corelib/q";var Mi=class extends _t{constructor(e,t){super(e,t);this.initPropertyGrid(),this.loadInitialEntity()}destroy(){this.propertyGrid&&(this.propertyGrid.destroy(),this.propertyGrid=null),this.validator&&(this.byId("Form").remove(),this.validator=null),super.destroy()}initPropertyGrid(){var e=this.byId("PropertyGrid");if(!(e.length<=0)){var t=this.getPropertyGridOptions();this.propertyGrid=new q(e,t).init(null),this.element.closest(".ui-Panel").hasClass("s-Flexify")&&this.propertyGrid.element.children(".categories").flexHeightOnly(1)}}loadInitialEntity(){this.propertyGrid&&this.propertyGrid.load(new Object)}getFormKey(){var e=wo(sn(this),ve,!0);if(e.length>=1)return e[0].value;var t=Po(sn(this)),i=t.indexOf(".");return i>=0&&(t=t.substring(i+1)),rn(t,"Panel")?t=t.substr(0,t.length-6):rn(t,"Panel")&&(t=t.substr(0,t.length-5)),t}getPropertyGridOptions(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,useCategories:!1,localTextPrefix:"Forms."+this.getFormKey()+"."}}getPropertyItems(){var e=this.getFormKey();return _o(e)}getSaveEntity(){var e=new Object;return this.propertyGrid&&this.propertyGrid.save(e),e}get_entity(){return this._entity}get_entityId(){return this._entityId}set_entity(e){this._entity=e!=null?e:new Object}set_entityId(e){this._entityId=e}validateBeforeSave(){return this.validator.form()}};Mi=h([m.registerClass("Serenity.PropertyPanel")],Mi);var Ie;(a=>{function d(o,l,u,c){var p=l.widgetName;return o.element.bind("ondatachange."+p,function(g,f){c?window.setTimeout(function(){u(g,f)},0):u(g,f)}).bind("remove."+p,function(){o.element.unbind("ondatachange."+p)}),o}a.bindToDataChange=d;function n(o){return o.element.triggerHandler("ondatachange"),o}a.triggerDataChange=n;function e(o){return o.triggerHandler("ondatachange"),o}a.triggerDataChanged=e;function t(o,l,u){return d(o,l,function(c,p){l.element.triggerHandler("ondatachange")},u)}a.bubbleDataChange=t;function i(o,l){return o.element.one("dialogopen",function(u){o.element.dialog().dialog("option","position",r(l))}),o}a.cascade=i;function r(o){return{my:"left top",at:"left+20 top+20",of:o[0]}}a.cascadedDialogOffset=r})(Ie||(Ie={}));import{endsWith as nn,getAttributes as Do,getFormData as Fo,getFormDataAsync as Eo,getInstanceType as an,getTypeFullName as Ro,isEmptyOrNull as on,ScriptData as Vo,localText as ln}from"@serenity-is/corelib/q";var yt=class extends N{constructor(e){super(e);this.useAsync()?this.initAsync():this.initSync()}internalInit(){this.initPropertyGrid(),this.loadInitialEntity()}initSync(){this.propertyItemsData=this.getPropertyItemsData(),this.internalInit(),this.afterInit()}initAsync(){return Pe(this,null,function*(){this.propertyItemsData=yield this.getPropertyItemsDataAsync(),this.internalInit(),this.afterInit()})}afterInit(){}useAsync(){return!1}destroy(){this.propertyGrid&&(this.propertyGrid.destroy(),this.propertyGrid=null),this.validator&&(this.byId("Form").remove(),this.validator=null),super.destroy()}getDialogOptions(){var e=super.getDialogOptions();return e.width=400,e}getDialogButtons(){return super.getDialogButtons(),[{text:ln("Dialogs.OkButton"),cssClass:"btn btn-primary",click:()=>this.okClick()},{text:ln("Dialogs.CancelButton"),click:()=>this.cancelClick()}]}okClick(){this.validateBeforeSave()&&this.okClickValidated()}okClickValidated(){this.dialogClose()}cancelClick(){this.dialogClose()}initPropertyGrid(){var e=this.byId("PropertyGrid");if(!(e.length<=0)){var t=this.getPropertyGridOptions();this.propertyGrid=new q(e,t).init(null),this.element.closest(".ui-dialog").hasClass("s-Flexify")&&this.propertyGrid.element.children(".categories").flexHeightOnly(1)}}getFormKey(){var e=Do(an(this),ve,!0);if(e.length>=1)return e[0].value;var t=Ro(an(this)),i=t.indexOf(".");return i>=0&&(t=t.substring(i+1)),nn(t,"Dialog")?t=t.substr(0,t.length-6):nn(t,"Panel")&&(t=t.substr(0,t.length-5)),t}getPropertyGridOptions(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,useCategories:!1,localTextPrefix:"Forms."+this.getFormKey()+"."}}getPropertyItems(){var e;return((e=this.propertyItemsData)==null?void 0:e.items)||[]}getPropertyItemsData(){var e=this.getFormKey();return this.getFormKey===yt.prototype.getFormKey&&this.getPropertyItems!==yt.prototype.getPropertyItems&&!Vo.canLoad("Form."+e)?{items:this.getPropertyItems(),additionalItems:[]}:on(e)?{items:[],additionalItems:[]}:Fo(e)}getPropertyItemsDataAsync(){return Pe(this,null,function*(){var e=this.getFormKey();return on(e)?{items:[],additionalItems:[]}:yield Eo(e)})}getSaveEntity(){var e=new Object;return this.propertyGrid&&this.propertyGrid.save(e),e}loadInitialEntity(){this.propertyGrid&&this.propertyGrid.load(new Object)}get_entity(){return this.entity}set_entity(e){this.entity=e!=null?e:new Object}get_entityId(){return this.entityId}set_entityId(e){this.entityId=e}validateBeforeSave(){return this.validator.form()}updateTitle(){}getFallbackTemplate(){return`<div>
    <div class="s-Form">
        <form id="~_Form" action="">
            <div class="fieldset">
                <div id="~_PropertyGrid"></div>
                <div class="clear"></div>
            </div>
        </form> 
    </div>
</div>`}};yt=h([m.registerClass("Serenity.PropertyDialog")],yt);var ae=class extends b{constructor(n){super(n)}get value(){return this.element.val()}get_value(){return this.value}set value(n){this.element.val(n)}set_value(n){this.value=n}};ae=h([m.registerEditor("Serenity.StringEditor",[D]),m.element('<input type="text"/>')],ae);var Ji=class extends ae{constructor(n){super(n),n.attr("type","password")}};Ji=h([m.registerEditor("Serenity.PasswordEditor")],Ji);var $i=class extends b{constructor(n,e){var t,i;super(n,e),this.options.cols!==0&&n.attr("cols",(t=this.options.cols)!=null?t:80),this.options.rows!==0&&n.attr("rows",(i=this.options.rows)!=null?i:6)}get value(){return this.element.val()}get_value(){return this.value}set value(n){this.element.val(n)}set_value(n){this.value=n}};$i=h([m.registerEditor("Serenity.TextAreaEditor",[D]),m.element("<textarea />")],$i);var zi=class extends b{get value(){return this.element.is(":checked")}get_value(){return this.value}set value(n){this.element.prop("checked",!!n)}set_value(n){this.value=n}};zi=h([m.registerEditor("Serenity.BooleanEditor",[Re]),m.element('<input type="checkbox"/>')],zi);import{Culture as ss,extend as No,formatNumber as Qo,parseDecimal as Bo}from"@serenity-is/corelib/q";var Te=class extends b{constructor(n,e){var i,r;super(n,e),n.addClass("decimalQ");var t=No(Te.defaultAutoNumericOptions(),{vMin:(i=this.options.minValue)!=null?i:this.options.allowNegatives?this.options.maxValue!=null?"-"+this.options.maxValue:"-999999999999.99":"0.00",vMax:(r=this.options.maxValue)!=null?r:"999999999999.99"});this.options.decimals!=null&&(t.mDec=this.options.decimals),this.options.padDecimals!=null&&(t.aPad=this.options.padDecimals),$.fn.autoNumeric&&n.autoNumeric(t)}get_value(){if($.fn.autoNumeric){var n=this.element.autoNumeric("get");return n==null||n===""?null:parseFloat(n)}var n=this.element.val();return Bo(n)}get value(){return this.get_value()}set_value(n){n==null||n===""?this.element.val(""):$.fn.autoNumeric?this.element.autoNumeric("set",n):this.element.val(Qo(n))}set value(n){this.set_value(n)}get_isValid(){return!isNaN(this.get_value())}static defaultAutoNumericOptions(){return{aDec:ss.decimalSeparator,altDec:ss.decimalSeparator==="."?",":".",aSep:ss.decimalSeparator==="."?",":".",aPad:!0}}};Te=h([m.registerEditor("Serenity.DecimalEditor",[Y]),m.element('<input type="text"/>')],Te);import{extend as Lo,formatNumber as Ao,isTrimmedEmpty as Go,parseInteger as Wo,trimToNull as qo}from"@serenity-is/corelib/q";var Dt=class extends b{constructor(n,e){var i,r;super(n,e),n.addClass("integerQ");var t=Lo(Te.defaultAutoNumericOptions(),{vMin:((i=this.options.minValue)!=null?i:this.options.allowNegatives)?this.options.maxValue!=null?"-"+this.options.maxValue:"-2147483647":"0",vMax:(r=this.options.maxValue)!=null?r:2147483647,aSep:null});$.fn.autoNumeric&&n.autoNumeric(t)}get_value(){if($.fn.autoNumeric){var n=this.element.autoNumeric("get");return Go(n)?null:parseInt(n,10)}else{var n=qo(this.element.val());return n==null?null:Wo(n)}}get value(){return this.get_value()}set_value(n){n==null||n===""?this.element.val(""):$.fn.autoNumeric?this.element.autoNumeric("set",n):this.element.val(Ao(n))}set value(n){this.set_value(n)}get_isValid(){return!isNaN(this.get_value())}};Dt=h([m.registerEditor("Serenity.IntegerEditor",[Y]),m.element('<input type="text"/>')],Dt);import{addValidationRule as Mo,Culture as F,format as dn,formatDate as te,Invariant as un,isEmptyOrNull as Hi,parseDate as Jo,parseISODateTime as ns,replaceAll as $o,localText as pn,today as as}from"@serenity-is/corelib/q";var hn='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 17 17"><g></g><path d="M14 2v-1h-3v1h-5v-1h-3v1h-3v15h17v-15h-3zM12 2h1v2h-1v-2zM4 2h1v2h-1v-2zM16 16h-15v-8.921h15v8.921zM1 6.079v-3.079h2v2h3v-2h5v2h3v-2h2v3.079h-15z" fill="currentColor"></path></svg>',V=class extends b{constructor(e){var t,i;super(e);typeof flatpickr!="undefined"&&(V.useFlatpickr||!$.fn.datepicker)?flatpickr(e[0],V.flatPickrOptions(e)):(t=$.fn)!=null&&t.datepicker?e.datepicker({showOn:"button",beforeShow:(r,a)=>e.hasClass("readonly")?!1:(V.uiPickerZIndexWorkaround(this.element),!0),yearRange:(i=this.yearRange)!=null?i:"-100:+50"}):e.attr("type","date"),e.on("keyup."+this.uniqueName,r=>{r.which===32&&!this.get_readOnly()?this.get_valueAsDate()!=as()&&(this.set_valueAsDate(as()),this.element.trigger("change")):V.dateInputKeyup(r)}),e.on("change."+this.uniqueName,V.dateInputChange),Mo(e,this.uniqueName,r=>{var a=this.get_value();return Hi(a)?null:!Hi(this.get_minValue())&&un.stringCompare(te(a,"yyyy-MM-dd"),te(this.get_minValue(),"yyyy-MM-dd"))<0?dn(pn("Validation.MinDate"),te(this.get_minValue(),null)):!Hi(this.get_maxValue())&&un.stringCompare(te(a,"yyyy-MM-dd"),te(this.get_maxValue(),"yyyy-MM-dd"))>0?dn(pn("Validation.MaxDate"),te(this.get_maxValue(),null)):null}),this.set_sqlMinMax(!0)}static flatPickrOptions(e){return{clickOpens:!0,allowInput:!0,dateFormat:F.dateOrder.split("").join(F.dateSeparator).replace("y","Y"),onChange:function(){e.triggerHandler("change")}}}get_value(){var e=this.element.val().trim();return e!=null&&e.length===0?null:te(e,"yyyy-MM-dd")}get value(){return this.get_value()}set_value(e){e==null?this.element.val(""):e.toLowerCase()==="today"||e.toLowerCase()==="now"?this.element.val(te(as(),null)):this.element.val(te(e,null))}set value(e){this.set_value(e)}get_valueAsDate(){return Hi(this.get_value())?null:ns(this.get_value())}get valueAsDate(){return this.get_valueAsDate()}set_valueAsDate(e){e==null&&this.set_value(null),this.set_value(te(e,"yyyy-MM-dd"))}set valueAsDate(e){this.set_valueAsDate(e)}get_readOnly(){return this.element.hasClass("readonly")}set_readOnly(e){e!==this.get_readOnly()&&(e?(this.element.addClass("readonly").attr("readonly","readonly"),this.element.nextAll(".ui-datepicker-trigger").css("opacity","0.1")):(this.element.removeClass("readonly").removeAttr("readonly"),this.element.nextAll(".ui-datepicker-trigger").css("opacity","1")))}get_minValue(){return this.minValue}set_minValue(e){this.minValue=e}get_maxValue(){return this.maxValue}set_maxValue(e){this.maxValue=e}get_minDate(){return ns(this.get_minValue())}set_minDate(e){this.set_minValue(te(e,"yyyy-MM-dd"))}get_maxDate(){return ns(this.get_maxValue())}set_maxDate(e){this.set_maxValue(te(e,"yyyy-MM-dd"))}get_sqlMinMax(){return this.get_minValue()==="1753-01-01"&&this.get_maxValue()==="9999-12-31"}set_sqlMinMax(e){e?(this.set_minValue("1753-01-01"),this.set_maxValue("9999-12-31")):(this.set_minValue(null),this.set_maxValue(null))}static flatPickrTrigger(e){return $('<i class="ui-datepicker-trigger" href="javascript:;">'+hn+"</i>").insertAfter(e).click(()=>{e.hasClass("readonly")||e[0]._flatpickr.open()})}static dateInputKeyup(e){var a;if(F.dateOrder!=="dmy")return;var t=$(e.target);if(!t.is(":input")||t.attr("type")=="date"||t.is("[readonly]")||t.is(":disabled"))return;var i=(a=t.val())!=null?a:"";if(i.length===0||t[0].selectionEnd!==i.length)return;if(i.indexOf(F.dateSeparator+F.dateSeparator)!==-1){t.val($o(i,F.dateSeparator+F.dateSeparator,F.dateSeparator));return}function r(o){return o>=48&&o<=57}if(e.which===47||e.which===111){if(i.length>=2&&i.charAt(i.length-1)===F.dateSeparator&&i.charAt(i.length-2)===F.dateSeparator){t.val(i.substr(0,i.length-1));return}if(i.charAt(i.length-1)!==F.dateSeparator)return;switch(i.length){case 2:if(r(i.charCodeAt(0))){i="0"+i;break}else return;case 4:if(r(i.charCodeAt(0))&&r(i.charCodeAt(2))&&i.charAt(1)==F.dateSeparator){i="0"+i.charAt(0)+F.dateSeparator+"0"+i.charAt(2)+F.dateSeparator;break}else return;case 5:if(r(i.charCodeAt(0))&&r(i.charCodeAt(2))&&r(i.charCodeAt(3))&&i.charAt(1)===F.dateSeparator){i="0"+i;break}else if(r(i.charCodeAt(0))&&r(i.charCodeAt(1))&&r(i.charCodeAt(3))&&i.charAt(2)===F.dateSeparator){i=i.charAt(0)+i.charAt(1)+F.dateSeparator+"0"+i.charAt(3)+F.dateSeparator;break}else break;default:return}t.val(i)}if(i.length<6&&(e.which>=48&&e.which<=57||e.which>=96&&e.which<=105)&&r(i.charCodeAt(i.length-1))){switch(i.length){case 1:{if(i.charCodeAt(0)<=51)return;i="0"+i;break}case 2:{if(!r(i.charCodeAt(0)))return;break}case 3:{if(!r(i.charCodeAt(0))||i.charAt(1)!==F.dateSeparator||i.charCodeAt(2)<=49)return;i="0"+i.charAt(0)+F.dateSeparator+"0"+i.charAt(2);break}case 4:if(i.charAt(1)==F.dateSeparator){if(!r(i.charCodeAt(0))||!r(i.charCodeAt(2)))return;i="0"+i;break}else if(i.charAt(2)==F.dateSeparator){if(!r(i.charCodeAt(0))||!r(i.charCodeAt(1))||i.charCodeAt(3)<=49)return;i=i.charAt(0)+i.charAt(1)+F.dateSeparator+"0"+i.charAt(3);break}else return;case 5:{if(i.charAt(2)!==F.dateSeparator||!r(i.charCodeAt(0))||!r(i.charCodeAt(1))||!r(i.charCodeAt(3)))return;break}default:return}t.val(i+F.dateSeparator)}}static uiPickerZIndexWorkaround(e){if(e!=null&&e.closest(".ui-dialog").length){var t=parseInt(e.closest(".ui-dialog").css("z-index"),10);t==null||isNaN(t)||setTimeout(()=>{var i=e.datepicker("widget");if(i!=null&&i.length){var r=parseInt(i.css("z-index"));!isNaN(r)&&r<=t&&i.css("z-index",t+1)}},0)}}};V.dateInputChange=function(e){var o,l;if(F.dateOrder==="dmy"){var t=$(e.target);if(!(!t.is(":input")||t.attr("type")=="date")){var i=(o=t.val())!=null?o:"",r={};if(i.length>=6&&/^[0-9]*$/g.test(i)&&t.val(i.substr(0,2)+F.dateSeparator+i.substr(2,2)+F.dateSeparator+i.substr(4)),i=(l=t.val())!=null?l:"",i.length>=5){var a=Jo(i);a&&!isNaN(a.valueOf())&&t.val(te(a,null))}}}},h([m.option()],V.prototype,"yearRange",2),h([m.option()],V.prototype,"get_minValue",1),h([m.option()],V.prototype,"get_maxValue",1),h([m.option()],V.prototype,"get_maxDate",1),h([m.option()],V.prototype,"get_sqlMinMax",1),V=h([m.registerEditor("Serenity.DateEditor",[D,R]),m.element('<input type="text"/>')],V);function cn(){var t,i;if(!((i=(t=$.datepicker)==null?void 0:t.regional)!=null&&i.en))return!1;let d=F.dateOrder,n=F.dateSeparator,e=($("html").attr("lang")||"en").toLowerCase();return $.datepicker.regional[e]||(e=e.split("-")[0],$.datepicker.regional[e]||(e="en")),$.datepicker.setDefaults($.datepicker.regional.en),$.datepicker.setDefaults($.datepicker.regional[e]),$.datepicker.setDefaults({dateFormat:d=="mdy"?"mm"+n+"dd"+n+"yy":d=="ymd"?"yy"+n+"mm"+n+"dd":"dd"+n+"mm"+n+"yy",buttonImage:"data:image/svg+xml,"+encodeURIComponent(hn),buttonImageOnly:!0,showOn:"both",showButtonPanel:!0,changeMonth:!0,changeYear:!0}),$.ui&&$.ui.version<="1.12.1"&&$.datepicker.setDefaults({buttonImage:null,buttonImageOnly:!1,buttonText:'<i class="fa fa-calendar"></i>'}),!0}typeof $!="undefined"&&$.fn&&!cn()&&$(cn);import{addOption as zo,addValidationRule as Ho,Culture as Ui,format as mn,formatDate as ce,formatISODateTimeUTC as Uo,Invariant as gn,isEmptyOrNull as Ft,parseDate as jo,parseISODateTime as si,round as Ko,localText as fn,today as Yo,trunc as Xo,tryGetText as Zo}from"@serenity-is/corelib/q";var A=class extends b{constructor(e,t){var o,l,u,c,p;super(e,t);if(e.addClass("s-DateTimeEditor"),this.options.inputOnly)e.addClass("dateTimeQ");else if(typeof flatpickr!="undefined"&&(V.useFlatpickr||!$.fn.datepicker||this.options.seconds))e.addClass("dateTimeQ"),flatpickr(e[0],this.getFlatpickrOptions());else if((o=$.fn)!=null&&o.datepicker){e.addClass("dateQ"),e.datepicker({showOn:"button",beforeShow:function(){return e.hasClass("readonly")?!1:(V.uiPickerZIndexWorkaround(this.element),!0)},yearRange:(l=this.options.yearRange)!=null?l:"-100:+50"}),e.bind("change."+this.uniqueName,g=>{this.lastSetValue=null,V.dateInputChange(g)}),this.time=$("<select/>").addClass("editor s-DateTimeEditor time");var i=e.next(".ui-datepicker-trigger");i.length>0?this.time.insertAfter(i):(i=e.prev(".ui-datepicker-trigger"),i.length>0?this.time.insertBefore(i):this.time.insertAfter(e)),this.time.on("change",function(g){this.lastSetValue=null,e.triggerHandler("change")});var r=A.getTimeOptions((u=this.options.startHour)!=null?u:0,0,(c=this.options.endHour)!=null?c:23,59,(p=this.options.intervalMinutes)!=null?p:5);for(var a of r)zo(this.time,a,a);Ho(e,this.uniqueName,g=>{var f=this.get_value();return Ft(f)?null:!Ft(this.get_minValue())&&gn.stringCompare(f,this.get_minValue())<0?mn(fn("Validation.MinDate"),ce(this.get_minValue(),null)):!Ft(this.get_maxValue())&&gn.stringCompare(f,this.get_maxValue())>0?mn(fn("Validation.MaxDate"),ce(this.get_maxValue(),null)):null})}else e.attr("type","datetime").addClass("dateTimeQ");e.bind("keyup."+this.uniqueName,g=>{if(!this.get_readOnly()&&this.time)if(g.which===32)this.get_valueAsDate()!==new Date&&(this.set_valueAsDate(new Date),this.element.trigger("change"));else{var f=this.element.val();V.dateInputKeyup(g),f!=this.element.val()&&(this.lastSetValue=null)}}),this.set_sqlMinMax(!0),this.options.inputOnly||$("<i class='inplace-button inplace-now'><b></b></div>").attr("title",this.getInplaceNowText()).insertAfter(this.time).click(g=>{this.element.hasClass("readonly")||(this.lastSetValue=null,this.set_valueAsDate(new Date),e.triggerHandler("change"))})}getFlatpickrOptions(){var e;return{clickOpens:!0,allowInput:!0,enableTime:!0,time_24hr:!0,enableSeconds:!!this.options.seconds,minuteIncrement:(e=this.options.intervalMinutes)!=null?e:5,dateFormat:Ui.dateOrder.split("").join(Ui.dateSeparator).replace("y","Y")+" H:i"+(this.options.seconds?":S":""),onChange:()=>{this.lastSetValue=null,this.element&&this.element.triggerHandler("change")}}}get_value(){var e=this.element.val().trim();if(e!=null&&e.length===0)return null;var t;if(this.time){var i=ce(e,"yyyy-MM-dd"),r=this.time.val();t=i+"T"+r+":00.000"}else t=ce(jo(this.element.val()),"yyyy-MM-ddTHH:mm:ss.fff");return this.options.useUtc&&(t=Uo(si(t))),this.lastSetValue!=null&&this.lastSetValueGet==t?this.lastSetValue:t}get value(){return this.get_value()}set_value(e){var i;if(Ft(e))this.element.val(""),this.time&&this.time.val("00:00");else if(e.toLowerCase()==="today")this.time?(this.element.val(ce(Yo(),null)),this.time.val("00:00")):this.element.val(this.getDisplayFormat());else{var t=e.toLowerCase()==="now"?new Date:si(e);this.time?(t=A.roundToMinutes(t,(i=this.options.intervalMinutes)!=null?i:5),this.element.val(ce(t,null)),this.time.val(ce(t,"HH:mm"))):this.element.val(ce(t,this.getDisplayFormat()))}this.lastSetValue=null,!Ft(e)&&e.toLowerCase()!="today"&&e.toLowerCase()!="now"&&(this.lastSetValueGet=this.get_value(),this.lastSetValue=e)}getInplaceNowText(){var e;return(e=Zo("Controls.DateTimeEditor.SetToNow"))!=null?e:"set to now"}getDisplayFormat(){return this.options.seconds?Ui.dateTimeFormat:Ui.dateTimeFormat.replace(":ss","")}set value(e){this.set_value(e)}get_valueAsDate(){return Ft(this.get_value())?null:si(this.get_value())}get valueAsDate(){return this.get_valueAsDate()}set_valueAsDate(e){e==null&&this.set_value(null),this.set_value(ce(e,"yyyy-MM-ddTHH:mm"+(this.options.seconds?":ss":"")))}set valueAsDate(e){this.set_valueAsDate(e)}get_minValue(){return this.minValue}set_minValue(e){this.minValue=e}get_maxValue(){return this.maxValue}set_maxValue(e){this.maxValue=e}get_minDate(){return si(this.get_minValue())}set_minDate(e){this.set_minValue(ce(e,"yyyy-MM-ddTHH:mm:ss"))}get_maxDate(){return si(this.get_maxValue())}set_maxDate(e){this.set_maxValue(ce(e,"yyyy-MM-ddTHH:mm:ss"))}get_sqlMinMax(){return this.get_minValue()==="1753-01-01"&&this.get_maxValue()==="9999-12-31"}set_sqlMinMax(e){e?(this.set_minValue("1753-01-01"),this.set_maxValue("9999-12-31")):(this.set_minValue(null),this.set_maxValue(null))}get_readOnly(){return this.element.hasClass("readonly")}set_readOnly(e){e!==this.get_readOnly()&&(e?(this.element.addClass("readonly").attr("readonly","readonly"),this.element.nextAll(".ui-datepicker-trigger").css("opacity","0.1"),this.element.nextAll(".inplace-now").css("opacity","0.1")):(this.element.removeClass("readonly").removeAttr("readonly"),this.element.nextAll(".ui-datepicker-trigger").css("opacity","1"),this.element.nextAll(".inplace-now").css("opacity","1")),this.time&&S.setReadonly(this.time,e))}static roundToMinutes(e,t){e=new Date(e.getTime());var i=Xo(Ko(e.getMinutes()/t)*t);return e.setMinutes(i),e.setSeconds(0),e.setMilliseconds(0),e}};A.getTimeOptions=function(e,t,i,r,a){var o=[];i>=23&&(i=23),r>=60&&(r=59);for(var l=e,u=t;!(l>i||l===i&&u>r);){var c=(l>=10?"":"0")+l+":"+(u>=10?"":"0")+u;o.push(c),u+=a,u>=60&&(u-=60,l++)}return o},h([m.option()],A.prototype,"get_minValue",1),h([m.option()],A.prototype,"get_maxValue",1),h([m.option()],A.prototype,"get_maxDate",1),h([m.option()],A.prototype,"get_sqlMinMax",1),A=h([m.registerEditor("Serenity.DateTimeEditor",[D,R]),m.element('<input type="text"/>')],A);import{addOption as os,toId as yn}from"@serenity-is/corelib/q";var ji=class extends b{constructor(e,t){super(e,t);e.addClass("editor s-TimeEditor hour"),this.options.noEmptyOption||os(e,"","--");for(var i=this.options.startHour||0;i<=(this.options.endHour||23);i++)os(e,i.toString(),i<10?"0"+i:i.toString());this.minutes=$("<select/>").addClass("editor s-TimeEditor minute").insertAfter(e),this.minutes.change(()=>this.element.trigger("change"));for(var r=0;r<=59;r+=this.options.intervalMinutes||5)os(this.minutes,r.toString(),r<10?"0"+r:r.toString())}get value(){var e=yn(this.element.val()),t=yn(this.minutes.val());return e==null||t==null?null:e*60+t}get_value(){return this.value}set value(e){e?(this.element.val(Math.floor(e/60).toString()),this.minutes.val(e%60)):this.options.noEmptyOption?(this.element.val(this.options.startHour),this.minutes.val("0")):(this.element.val(""),this.minutes.val("0"))}set_value(e){this.value=e}get_readOnly(){return this.element.hasClass("readonly")}set_readOnly(e){e!==this.get_readOnly()&&(e?this.element.addClass("readonly").attr("readonly","readonly"):this.element.removeClass("readonly").removeAttr("readonly"),S.setReadonly(this.minutes,e))}};ji=h([m.registerEditor("Serenity.TimeEditor",[Y,R]),m.element("<select />")],ji);import{isEmptyOrNull as Ki,trimToNull as el,tryGetText as tl}from"@serenity-is/corelib/q";var Et=class extends b{constructor(n,e){super(n,e),Et.registerValidationMethods(),n.addClass("emailuser");var t=$("<span/>").text("@").addClass("emailat").insertAfter(n),i=$('<input type="text"/>').addClass("emaildomain").insertAfter(t);i.bind("blur."+this.uniqueName,function(){var r=i.closest("form").data("validator");r!=null&&r.element(n[0])}),Ki(this.options.domain)||i.val(this.options.domain),this.options.readOnlyDomain&&i.attr("readonly","readonly").addClass("disabled").attr("tabindex","-1"),n.bind("keypress."+this.uniqueName,r=>{r.which===64&&(r.preventDefault(),this.options.readOnlyDomain||(i.focus(),i.select()))}),i.bind("keypress."+this.uniqueName,function(r){r.which===64&&r.preventDefault()}),this.options.readOnlyDomain||n.change(r=>this.set_value(n.val()))}static registerValidationMethods(){var n;!$.validator||!$.validator.methods||$.validator.methods.emailuser!=null||$.validator.addMethod("emailuser",function(e,t){var i=$(t).nextAll(".emaildomain");return i.length>0&&i.attr("readonly")==null?this.optional(t)&&this.optional(i[0])?!0:$.validator.methods.email.call(this,e+"@"+i.val(),t):$.validator.methods.email.call(this,e+"@dummy.com",t)},(n=tl("Validation.Email"))!=null?n:$.validator.messages.email)}get_value(){var n=this.element.nextAll(".emaildomain"),e=this.element.val(),t=n.val();return Ki(e)?this.options.readOnlyDomain||Ki(t)?"":"@"+t:e+"@"+t}get value(){return this.get_value()}set_value(n){var e=this.element.nextAll(".emaildomain");if(n=el(n),n==null)this.options.readOnlyDomain||e.val(""),this.element.val("");else{var t=n.split("@");t.length>1?this.options.readOnlyDomain?Ki(this.options.domain)?this.element.val(t[0]):t[1]!==this.options.domain?this.element.val(n):this.element.val(t[0]):(e.val(t[1]),this.element.val(t[0])):this.element.val(t[0])}}set value(n){this.set_value(n)}get_readOnly(){var n=this.element.nextAll(".emaildomain");return!(this.element.attr("readonly")==null&&(!this.options.readOnlyDomain||n.attr("readonly")==null))}set_readOnly(n){var e=this.element.nextAll(".emaildomain");n?(this.element.attr("readonly","readonly").addClass("readonly"),this.options.readOnlyDomain||e.attr("readonly","readonly").addClass("readonly")):(this.element.removeAttr("readonly").removeClass("readonly"),this.options.readOnlyDomain||e.removeAttr("readonly").removeClass("readonly"))}};Et=h([m.registerEditor("Serenity.EmailEditor",[D,R]),m.element('<input type="text"/>')],Et);var Yi=class extends ae{constructor(n){super(n),n.attr("type","email").addClass("email")}};Yi=h([m.registerEditor("Serenity.EmailAddressEditor")],Yi);import{trimToNull as il}from"@serenity-is/corelib/q";var Xi=class extends ae{constructor(n){super(n),n.addClass("url").attr("title","URL should be entered in format: 'http://www.site.com/page'."),n.on("blur."+this.uniqueName,e=>{var t=n.closest("form").data("validator");if(t!=null&&n.hasClass("error")){var i=il(n.val());i&&(i="http://"+i,$.validator.methods.url.call(t,i,n[0])==!0&&(n.val(i),t.element(n)))}})}};Xi=h([m.registerEditor("Serenity.URLEditor",[D])],Xi);import{Enum as vn,getAttributes as rl,getLookup as sl,isEmptyOrNull as Zi,tryGetText as nl}from"@serenity-is/corelib/q";var er=class extends b{constructor(n,e){var v;if(super(n,e),!(Zi(this.options.enumKey)&&this.options.enumType==null&&Zi(this.options.lookupKey)))if(Zi(this.options.lookupKey)){var u=this.options.enumType||Ue.get(this.options.enumKey),c=this.options.enumKey;if(c==null&&u!=null){var p=rl(u,z,!1);p.length>0&&(c=p[0].value)}var g=vn.getValues(u);for(var f of g){var y=vn.toString(u,f);this.addRadio(f.toString(),(v=nl("Enums."+c+"."+y))!=null?v:y)}}else{var t=sl(this.options.lookupKey);for(var i of t.items){var r=i[t.textField],a=r==null?"":r.toString(),o=i[t.idField],l=o==null?"":o.toString();this.addRadio(l,a)}}}addRadio(n,e){var t=$("<label/>").text(e);$('<input type="radio"/>').attr("name",this.uniqueName).attr("id",this.uniqueName+"_"+n).attr("value",n).prependTo(t),t.appendTo(this.element)}get_value(){return this.element.find("input:checked").first().val()}get value(){return this.get_value()}set_value(n){if(n!==this.get_value()){var e=this.element.find("input"),t=e.filter(":checked");t.length>0&&(t[0].checked=!1),Zi(n)||(t=e.filter("[value="+n+"]"),t.length>0&&(t[0].checked=!0))}}set value(n){this.set_value(n)}get_readOnly(){return this.element.attr("disabled")!=null}set_readOnly(n){this.get_readOnly()!==n&&(n?this.element.attr("disabled","disabled").find("input").attr("disabled","disabled"):this.element.removeAttr("disabled").find("input").removeAttr("disabled"))}};er=h([m.registerEditor("Serenity.RadioButtonEditor",[D,R]),m.element("<div/>")],er);var al=typeof Select2!="undefined"?Select2:void 0,Rt=al;import{Authorization as ol,any as ls,isEmptyOrNull as Se,isTrimmedEmpty as ll,localText as Vt,startsWith as dl,trimToEmpty as ul,trimToNull as bn}from"@serenity-is/corelib/q";var L=class extends b{constructor(e,t){super(e,t);this._items=[],this._itemById={};var i=this.emptyItemText();i!=null&&e.attr("placeholder",i);var r=this.getSelect2Options();e.select2(r),e.attr("type","text"),e.on("change."+this.uniqueName,(a,o)=>{o!==!0&&e.closest("form").data("validator")&&e.valid()}),this.setCascadeFrom(this.options.cascadeFrom),this.useInplaceAdd()&&this.addInplaceCreate(Vt("Controls.SelectEditor.InplaceAdd"),null)}destroy(){var e,t,i,r;(t=(e=this.initSelectionPromise)==null?void 0:e.abort)==null||t.call(e),this.abortPendingQuery(),(r=(i=this.element)==null?void 0:i.select2)==null||r.call(i,"destroy"),super.destroy()}hasAsyncSource(){return!1}asyncSearch(e,t){return t({items:[],more:!1}),null}getTypeDelay(){var e;return(e=this.options.typeDelay)!=null?e:200}emptyItemText(){var e;return(e=this.element.attr("placeholder"))!=null?e:Vt("Controls.SelectEditor.EmptyItemText")}getPageSize(){var e;return(e=this.options.pageSize)!=null?e:100}getIdField(){return this.options.idField}itemId(e){var t=e[this.getIdField()];return t==null?"":t.toString()}getTextField(){var e;return(e=this.options.textField)!=null?e:this.getIdField()}itemText(e){var t=e[this.getTextField()];return t==null?"":t.toString()}itemDisabled(e){return!1}mapItem(e){return{id:this.itemId(e),text:this.itemText(e),disabled:this.itemDisabled(e),source:e}}mapItems(e){return e.map(this.mapItem.bind(this))}allowClear(){return this.options.allowClear!=null?!!this.options.allowClear:this.emptyItemText()!=null}isMultiple(){return!!this.options.multiple}abortPendingQuery(){var e,t;(t=(e=this.queryPromise)==null?void 0:e.abort)==null||t.call(e),this.queryPromise=null,this.typeTimeout&&(clearTimeout(this.typeTimeout),this.typeTimeout=null)}getSelect2Options(){var e=this.emptyItemText(),t={multiple:this.isMultiple(),placeHolder:Se(e)?null:e,allowClear:this.allowClear(),createSearchChoicePosition:"bottom"};return this.hasAsyncSource()?(t.query=i=>{var l,u;var r=this.getPageSize(),a={searchTerm:bn(i.term),skip:(i.page-1)*r,take:r,checkMore:!0};this.abortPendingQuery();var o=$(this.element).data("select2");(u=(l=o==null?void 0:o.search)==null?void 0:l.removeClass)==null||u.call(l,"select2-active").parent().removeClass("select2-active"),this.typeTimeout=setTimeout(()=>{var c,p,g,f,y;this.abortPendingQuery(),(p=(c=o==null?void 0:o.search)==null?void 0:c.addClass)==null||p.call(c,"select2-active").parent().addClass("select2-active"),this.queryPromise=this.asyncSearch(a,v=>{var C,T;(T=(C=o==null?void 0:o.search)==null?void 0:C.removeClass)==null||T.call(C,"select2-active").parent().removeClass("select2-active"),this.queryPromise=null,i.callback({results:this.mapItems(v.items),more:v.more})}),(y=((g=this.queryPromise)==null?void 0:g.catch)||((f=this.queryPromise)==null?void 0:f.fail))==null||y.call(this.queryPromise,()=>{var v,C;this.queryPromise=null,(C=(v=o==null?void 0:o.search)==null?void 0:v.removeClass)==null||C.call(v,"select2-active").parent().removeClass("select2-active")})},i.term?this.getTypeDelay():0)},t.initSelection=(i,r)=>{var c,p,g;var a=i.val();if(a==null||a==""){r(null);return}var o=this.isMultiple(),l=o?a.split(","):[a],u={idList:l};(p=(c=this.initSelectionPromise)==null?void 0:c.abort)==null||p.call(c),this.initSelectionPromise=this.asyncSearch(u,f=>{if(this.initSelectionPromise=null,o){var y=(f.items||[]).map(T=>this.mapItem(T));this._itemById=this._itemById||{};for(var v of y)this._itemById[v.id]=v;if(this.isAutoComplete&&y.length!=l.length)for(var C of l)ls(y,T=>T.id==C)||y.push({id:C,text:C});r(y)}else if(!f.items||!f.items.length)this.isAutoComplete?r({id:a,text:a}):r(null);else{var v=this.mapItem(f.items[0]);this._itemById=this._itemById||{},this._itemById[v.id]=v,r(v)}}),(g=this.initSelectionPromise.catch||this.initSelectionPromise.fail)==null||g.call(this.initSelectionPromise,()=>{this.initSelectionPromise=null})}):(t.data=this._items,t.query=i=>{var r=L.filterByText(this._items,o=>o.text,i.term),a=this.getPageSize();i.callback({results:r.slice((i.page-1)*a,i.page*a),more:r.length>=i.page*a})},t.initSelection=(i,r)=>{var a=i.val(),o=this.isAutoComplete();if(this.isMultiple()){var l=[];for(var u of a.split(",")){var c=this._itemById[u];c==null&&o&&(c={id:u,text:u},this.addItem(c)),c!=null&&l.push(c)}r(l);return}var p=this._itemById[a];p==null&&o&&(p={id:a,text:a},this.addItem(p)),r(p)}),this.options.minimumResultsForSearch!=null&&(t.minimumResultsForSearch=this.options.minimumResultsForSearch),(this.isAutoComplete()||this.useInplaceAdd())&&(t.createSearchChoice=this.getCreateSearchChoice(null)),t}get_delimited(){return!!this.options.delimited}get items(){if(this.hasAsyncSource())throw new Error("Can't read items property of an async select editor!");return this._items||[]}set items(e){if(this.hasAsyncSource())throw new Error("Can't set items of an async select editor!");this._items=e||[],this._itemById={};for(var t of this._items)this._itemById[t.id]=t}get itemById(){if(this.hasAsyncSource())throw new Error("Can't read items property of an async select editor!");return this._itemById}set itemById(e){if(this.hasAsyncSource())throw new Error("Can't set itemById of an async select editor!");this._itemById=e||{}}clearItems(){if(this.hasAsyncSource())throw new Error("Can't clear items of an async select editor!");this._items.length=0,this._itemById={}}addItem(e){if(this.hasAsyncSource())throw new Error("Can't add item to an async select editor!");this._items.push(e),this._itemById[e.id]=e}addOption(e,t,i,r){this.addItem({id:e,text:t,source:i,disabled:r})}addInplaceCreate(e,t){var i=this;e=e!=null?e:Vt("Controls.SelectEditor.InplaceAdd"),t=t!=null?t:Vt("Controls.SelectEditor.InplaceEdit");var r=$("<a><b/></a>").addClass("inplace-button inplace-create").attr("title",e).insertAfter(this.element).click(function(a){i.inplaceCreateClick(a)});this.get_select2Container().add(this.element).addClass("has-inplace-button"),this.element.change(()=>{var a=this.isMultiple()||Se(this.get_value());r.attr("title",a?e:t).toggleClass("edit",!a)}),this.element.change((a,o)=>{if(o!==!0)if(this.isMultiple()){var l=this.get_values();l.length>0&&l[l.length-1]==(-2147483648).toString()&&(this.set_values(l.slice(0,l.length-1)),this.inplaceCreateClick(a))}else this.get_value()==(-2147483648).toString()&&(this.set_value(null),this.inplaceCreateClick(a))}),this.isMultiple()&&this.get_select2Container().on("dblclick."+this.uniqueName,".select2-search-choice",a=>{var o=$(a.target);o.hasClass("select2-search-choice")||(o=o.closest(".select2-search-choice"));var l=o.index(),u=this.get_values();l<0||l>=this.get_values().length||(a.editItem=u[l],this.inplaceCreateClick(a))})}useInplaceAdd(){return!this.isAutoComplete()&&this.options.inplaceAdd&&(this.options.inplaceAddPermission==null||ol.hasPermission(this.options.inplaceAddPermission))}isAutoComplete(){return!!this.options.autoComplete}getCreateSearchChoice(e){return t=>{var r;if(this.lastCreateTerm=t,t=((r=Rt.util.stripDiacritics(t))!=null?r:"").toLowerCase(),ll(t))return null;var i=!1;return ls(this._items||[],a=>{var o=e?e(a.source):a.text;return Rt.util.stripDiacritics(o!=null?o:"").toLowerCase()==t})?null:ls(this._items||[],a=>{var o;return((o=Rt.util.stripDiacritics(a.text))!=null?o:"").toLowerCase().indexOf(t)!==-1})?this.isAutoComplete()?{id:this.lastCreateTerm,text:this.lastCreateTerm}:{id:(-2147483648).toString(),text:Vt("Controls.SelectEditor.ClickToDefine")}:this.isAutoComplete()?{id:this.lastCreateTerm,text:this.lastCreateTerm}:{id:(-2147483648).toString(),text:Vt("Controls.SelectEditor.NoResultsClickToDefine")}}}setEditValue(e,t){var i=e[t.name];Array.isArray(i)?this.set_values(i):this.set_value(i==null?null:i.toString())}getEditValue(e,t){!this.isMultiple()||this.get_delimited()?t[e.name]=this.get_value():t[e.name]=this.get_values()}get_select2Container(){return this.element.prevAll(".select2-container")}get_items(){return this.items}get_itemByKey(){return this.itemById}static filterByText(e,t,i){if(i==null||i.length==0)return e;i=Rt.util.stripDiacritics(i).toUpperCase();var r=[];function a(o){var l=t(o);return l==null||!l.length?!1:(l=Rt.util.stripDiacritics(l).toUpperCase(),dl(l,i)?!0:(l.indexOf(i)>=0&&r.push(o),!1))}return e.filter(a).concat(r)}get_value(){var e;if(this.element.data("select2")){if(e=this.element.select2("val"),e!=null&&Array.isArray(e))return e.join(",")}else e=this.element.val();return e}get value(){return this.get_value()}set_value(e){if(e!=this.get_value()){var t=e;!Se(e)&&this.isMultiple()&&(t=e.split(String.fromCharCode(44)).map(function(r){return bn(r)}).filter(function(r){return r!=null}));var i=this.element;i.select2("val",t),i.data("select2-change-triggered",!0);try{i.triggerHandler("change",[!0])}finally{i.data("select2-change-triggered",!1)}this.updateInplaceReadOnly()}}set value(e){this.set_value(e)}get selectedItem(){let e=this.get_value();if(e&&this._itemById){let t=this._itemById[e];if(t)return t.source}return null}get selectedItems(){let e=this.values;var t=[];for(var i of e)if(i&&this._itemById){let r=this._itemById[i];r&&r.source?t.push(r.source):t.push(null)}return t}get_values(){var e=this.element.select2("val");if(e==null)return[];if(Array.isArray(e))return e;var t=e;return Se(t)?[]:[t]}get values(){return this.get_values()}set_values(e){if(e==null||e.length===0){this.set_value(null);return}this.set_value(e.join(","))}set values(e){this.set_values(e)}get_text(){var e;return((e=this.element.select2("data"))!=null?e:{}).text}get text(){return this.get_text()}get_readOnly(){return!Se(this.element.attr("readonly"))}get readOnly(){return this.get_readOnly()}updateInplaceReadOnly(){var e=this.get_readOnly()&&(this.isMultiple()||!this.value);this.element.nextAll(".inplace-create").attr("disabled",e?"disabled":"").css("opacity",e?"0.1":"").css("cursor",e?"default":"")}set_readOnly(e){e!==this.get_readOnly()&&(this.element.attr("readonly",e?"readonly":null),this.updateInplaceReadOnly())}set readOnly(e){this.set_readOnly(e)}getCascadeFromValue(e){return S.getValue(e)}setCascadeFrom(e){if(Se(e)){this.cascadeLink!=null&&(this.cascadeLink.set_parentID(null),this.cascadeLink=null),this.options.cascadeFrom=null;return}this.cascadeLink=new Ke(b,this,t=>{this.set_cascadeValue(this.getCascadeFromValue(t))}),this.cascadeLink.set_parentID(e),this.options.cascadeFrom=e}get_cascadeFrom(){return this.options.cascadeFrom}get cascadeFrom(){return this.get_cascadeFrom()}set_cascadeFrom(e){e!==this.options.cascadeFrom&&(this.setCascadeFrom(e),this.updateItems())}set cascadeFrom(e){this.set_cascadeFrom(e)}get_cascadeField(){var e;return(e=this.options.cascadeField)!=null?e:this.options.cascadeFrom}get cascadeField(){return this.get_cascadeField()}set_cascadeField(e){this.options.cascadeField=e}set cascadeField(e){this.set_cascadeField(e)}get_cascadeValue(){return this.options.cascadeValue}get cascadeValue(){return this.get_cascadeValue()}set_cascadeValue(e){this.options.cascadeValue!==e&&(this.options.cascadeValue=e,this.set_value(null),this.updateItems())}set cascadeValue(e){this.set_cascadeValue(e)}get_filterField(){return this.options.filterField}get filterField(){return this.get_filterField()}set_filterField(e){this.options.filterField=e}set filterField(e){this.set_filterField(e)}get_filterValue(){return this.options.filterValue}get filterValue(){return this.get_filterValue()}set_filterValue(e){this.options.filterValue!==e&&(this.options.filterValue=e,this.set_value(null),this.updateItems())}set filterValue(e){this.set_filterValue(e)}cascadeItems(e){var t=this.get_cascadeValue();if(t==null||t==="")return Se(this.get_cascadeField())?e:[];var i=t.toString(),r=this.get_cascadeField();return e.filter(a=>{var l;var o=(l=a[r])!=null?l:se.getPropertyValue(a,r);return o!=null&&o.toString()===i})}filterItems(e){var t=this.get_filterValue();if(t==null||t==="")return e;var i=t.toString(),r=this.get_filterField();return e.filter(a=>{var l;var o=(l=a[r])!=null?l:se.getPropertyValue(a,r);return o!=null&&o.toString()===i})}updateItems(){}getDialogTypeKey(){return this.options.dialogType!=null?this.options.dialogType:null}createEditDialog(e){var t=this.getDialogTypeKey(),i=mt.get(t);b.create({type:i,init:r=>e(r)})}initNewEntity(e){Se(this.get_cascadeField())||(e[this.get_cascadeField()]=this.get_cascadeValue()),Se(this.get_filterField())||(e[this.get_filterField()]=this.get_filterValue()),this.onInitNewEntity!=null&&this.onInitNewEntity(e)}setEditDialogReadOnly(e){e.element&&e.element.find(".tool-button.delete-button").addClass("disabled").unbind("click")}editDialogDataChange(){}setTermOnNewEntity(e,t){}inplaceCreateClick(e){this.get_readOnly()&&(this.isMultiple()&&!e.editItem||!this.value)||this.createEditDialog(t=>{this.get_readOnly()&&this.setEditDialogReadOnly(t),Ie.bindToDataChange(t,this,(a,o)=>{if(this.editDialogDataChange(),this.updateItems(),this.lastCreateTerm=null,(o.type==="create"||o.type==="update")&&o.entityId!=null){var l=o.entityId.toString();if(this.isMultiple()){var u=this.get_values().slice();u.indexOf(l)<0&&u.push(l),this.set_values(null),this.set_values(u.slice())}else this.set_value(null),this.set_value(l)}else if(this.isMultiple()&&o.type==="delete"&&o.entityId!=null){var c=o.entityId.toString(),p=this.get_values().slice(),g=p.indexOf(c);g>=0&&p.splice(g,1),this.set_values(p.slice())}else this.isMultiple()||this.set_value(null)},!0);var i=e.editItem;if(i!=null)t.load(i,()=>{t.dialogOpen(this.openDialogAsPanel)},null);else if(this.isMultiple()||Se(this.get_value())){var r={};this.setTermOnNewEntity(r,ul(this.lastCreateTerm)),this.initNewEntity(r),t.load(r,()=>{t.dialogOpen(this.openDialogAsPanel)},null)}else t.load(this.get_value(),()=>{t.dialogOpen(this.openDialogAsPanel)},null)})}};L=h([m.registerClass("Serenity.Select2Editor",[Z,X,D,R]),m.element('<input type="hidden"/>')],L);import{isEmptyOrNull as pl}from"@serenity-is/corelib/q";var Ye=class extends L{constructor(n,e){super(n,e),this.updateItems()}getItems(){return this.options.items||[]}emptyItemText(){return pl(this.options.emptyOptionText)?super.emptyItemText():this.options.emptyOptionText}updateItems(){var a;var n=this.getItems();if(this.clearItems(),n.length>0){var e=typeof n[0]=="string";for(var t of n){var i=e?t:t[0],r=e?t:(a=t[1])!=null?a:t[0];this.addOption(i,r,t,!1)}}}};Ye=h([m.registerClass("Serenity.SelectEditor")],Ye);import{startsWith as tr}from"@serenity-is/corelib/q";var ir=class extends Ye{constructor(n,e){super(n,e),this.updateItems()}getItems(){var o,l;var n=this.options;if(n.items!=null&&n.items.length>=1)return n.items;var e=[],t=new Date().getFullYear(),i=new Date().getFullYear();if(n.minYear=((o=n.minYear)!=null?o:"-10").toString(),tr(n.minYear,"-")?t-=parseInt(n.minYear.substr(1),10):tr(n.minYear,"+")?t+=parseInt(n.minYear.substr(1),10):t=parseInt(n.minYear,10),n.maxYear=((l=n.maxYear)!=null?l:"+10").toString(),tr(n.maxYear,"-")?i-=parseInt(n.maxYear.substr(1),10):tr(n.maxYear,"+")?i+=parseInt(n.maxYear.substr(1),10):i=parseInt(n.maxYear,10),n.descending)for(var r=i;r>=t;r--)e.push(r.toString());else for(var a=t;a<=i;a++)e.push(a.toString());return e}};ir=h([m.registerEditor("Serenity.DateYearEditor")],ir);import{Enum as Cn,getAttributes as cl,tryGetText as hl}from"@serenity-is/corelib/q";var Nt=class extends L{constructor(n,e){super(n,e),this.updateItems()}updateItems(){var o;this.clearItems();var n=this.options.enumType||Ue.get(this.options.enumKey),e=this.options.enumKey;if(e==null&&n!=null){var t=cl(n,z,!1);t.length>0&&(e=t[0].value)}var i=Cn.getValues(n);for(var r of i){var a=Cn.toString(n,r);this.addOption(parseInt(r,10).toString(),(o=hl("Enums."+e+"."+a))!=null?o:a,null,!1)}}allowClear(){var n;return(n=this.options.allowClear)!=null?n:!0}};Nt=h([m.registerEditor("Serenity.EnumEditor")],Nt);import{endsWith as ml,getInstanceType as gl,getLookup as fl,getLookupAsync as yl,getTypeFullName as vl,reloadLookup as bl,ScriptData as xn}from"@serenity-is/corelib/q";var ni=class extends L{constructor(e,t){super(e,t);if(!this.hasAsyncSource()){this.updateItems();var i=this;xn.bindToChange("Lookup."+this.getLookupKey(),this.uniqueName,function(){i.hasAsyncSource()||i.updateItems()})}}hasAsyncSource(){return!!this.options.async}destroy(){this.hasAsyncSource()||xn.unbindFromChange(this.uniqueName),super.destroy()}getLookupKey(){if(this.options.lookupKey!=null)return this.options.lookupKey;var e=vl(gl(this)),t=e.indexOf(".");return t>=0&&(e=e.substring(t+1)),ml(e,"Editor")&&(e=e.substr(0,e.length-6)),e}getLookupAsync(){return yl(this.getLookupKey())}getLookup(){return fl(this.getLookupKey())}getItems(e){return this.filterItems(this.cascadeItems(e.items))}getIdField(){return this.lookup!=null?this.lookup.idField:super.getIdField()}getItemText(e,t){if(t==null)return super.itemText(e);var i=t.textFormatter?t.textFormatter(e):e[t.textField];return i==null?"":i.toString()}mapItem(e){return{id:this.itemId(e),text:this.getItemText(e,this.lookup),disabled:this.getItemDisabled(e,this.lookup),source:e}}getItemDisabled(e,t){return super.itemDisabled(e)}updateItems(){if(!this.hasAsyncSource()){this.clearItems(),this.lookup=this.getLookup();var e=this.getItems(this.lookup);for(var t of e)this.addItem(this.mapItem(t))}}asyncSearch(e,t){return this.getLookupAsync().then(i=>{this.lookup=i;var r=this.getItems(this.lookup);e.idList!=null&&(r=r.filter(o=>e.idList.indexOf(this.itemId(o))>=0));function a(o){return this.getItemText(o,this.lookup)}r=L.filterByText(r,a.bind(this),e.searchTerm),t({items:r.slice(e.skip,e.take),more:r.length>=e.take})})}getDialogTypeKey(){var e=super.getDialogTypeKey();return e||this.getLookupKey()}setCreateTermOnNewEntity(e,t){e[this.getLookup().textField]=t}editDialogDataChange(){bl(this.getLookupKey())}};ni=h([m.registerEditor("Serenity.LookupEditorBase")],ni);var Qt=class extends ni{constructor(n,e){super(n,e)}};Qt=h([m.registerEditor("Serenity.LookupEditor")],Qt);import{ColumnSelection as Cl,Criteria as ai,isEmptyOrNull as xl,resolveUrl as Il,serviceCall as Tl,startsWith as rr}from"@serenity-is/corelib/q";var oi=class extends L{constructor(n,e){super(n,e)}getDialogTypeKey(){var n=super.getDialogTypeKey();if(n)return n;var e=this.getService();return rr(e,"~/Services/")&&(e=e.substr(11)),e.split("/").length==3&&(e=e.substr(0,e.lastIndexOf("/"))),e.replace("/",".")}getService(){return this.options.service}getServiceUrl(){var n=this.getService();if(n==null)throw new Error("ServiceLookupEditor requires 'service' option to be configured!");return!rr(n,"~")&&!rr(n,"/")&&n.indexOf("://")<0&&(n="~/Services/"+n),rr(n,"~")&&(n=Il(n)),n}getIncludeColumns(){var n=this.options.includeColumns||[],e=this.getIdField();e&&n.indexOf(e)<0&&n.push(e);var t=this.getTextField();return t&&n.indexOf(t)<0&&n.push(t),n}getSort(){return this.options.sort||(this.getTextField()?[this.getTextField()]:null)}getCascadeCriteria(){var n=this.get_cascadeValue();if(n==null||n==="")return xl(this.get_cascadeField())?null:["0","=","1"];var e=this.get_cascadeField();return ai(e).eq(n)}getFilterCriteria(){var n=this.get_filterValue();if(n==null||n==="")return null;var e=this.get_filterField();return[[e],"=",n]}getIdListCriteria(n){if(n==null)return null;if(n.length==0)return["0","=","1"];var e=this.getIdField();if(e==null)throw new Error("ServiceLookupEditor requires 'idField' option to be configured!");return ai(e).in(n)}getCriteria(n){return ai.and(ai.and(this.getIdListCriteria(n.idList),this.options.criteria),ai.and(this.getCascadeCriteria(),this.getFilterCriteria()))}getListRequest(n){var e={};return n.searchTerm&&(e.ContainsText=n.searchTerm),e.Sort=this.getSort(),e.ColumnSelection=this.options.columnSelection||Cl.KeyOnly,e.IncludeColumns=this.getIncludeColumns(),e.ExcludeColumns=this.options.excludeColumns,e.ContainsField=this.options.containsField,e.EqualityFilter=this.options.equalityFilter,e.Criteria=this.getCriteria(n),e.Skip=n.skip||0,e.Take=n.take?n.checkMore?n.take+1:n.take:0,e.IncludeDeleted=this.options.includeDeleted,e.ExcludeTotalCount=!0,e}getServiceCallOptions(n,e){return{blockUI:!1,url:this.getServiceUrl(),request:this.getListRequest(n),onSuccess:t=>{var i=t.Entities||[];i&&n.take&&n.checkMore&&t.Entities.length>i.length&&(i=i.slice(0,n.take)),e({items:i.slice(0,n.take),more:n.checkMore&&n.take&&i.length>n.take})}}}hasAsyncSource(){return!0}asyncSearch(n,e){var t=this.getServiceCallOptions(n,e);return Tl(t)}};oi=h([m.registerEditor("Serenity.ServiceLookupEditorBase")],oi);var Bt=class extends oi{constructor(n,e){super(n,e)}};Bt=h([m.registerEditor("Serenity.ServiceLookupEditor")],Bt);import{endsWith as Sl,isEmptyOrNull as kl,isTrimmedEmpty as Ol,resolveUrl as In,localText as wl,trimToNull as Tn}from"@serenity-is/corelib/q";var oe=class extends b{constructor(e,t){super(e,t);this._instanceReady=!1,oe.includeCKEditor();var i=e.attr("id");Ol(i)&&(e.attr("id",this.uniqueName),i=this.uniqueName),this.options.cols!=null&&e.attr("cols",this.options.cols),this.options.rows!=null&&e.attr("rows",this.options.rows),this.addValidationRule(this.uniqueName,r=>{if(r.hasClass("required")){var a=Tn(this.get_value());if(a==null)return wl("Validation.Required")}return null}),Ce.executeOnceWhenShown(this.element,()=>{var r=this.getConfig();window.CKEDITOR&&window.CKEDITOR.replace(i,r)})}instanceReady(e){this._instanceReady=!0,$(e.editor.container.$).addClass(this.element.attr("class")),this.element.addClass("select2-offscreen").css("display","block"),e.editor.setData(this.element.val()),e.editor.setReadOnly(this.get_readOnly())}getLanguage(){var i;if(!window.CKEDITOR)return"en";var e=window.CKEDITOR,t=(i=Tn($("html").attr("lang")))!=null?i:"en";return e.lang.languages[t]||(t.indexOf(String.fromCharCode(45))>=0&&(t=t.split(String.fromCharCode(45))[0]),e.lang.languages[t])?t:"en"}getConfig(){return{customConfig:"",language:this.getLanguage(),bodyClass:"s-HtmlContentBody",on:{instanceReady:e=>this.instanceReady(e),change:e=>{e.editor.updateElement(),this.element.triggerHandler("change")}},toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker"]},{name:"insert",groups:["links","insert","blocks","bidi","list","indent"]},{name:"forms",groups:["forms","mode","document","doctools","others","about","tools"]},{name:"colors"},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"align"},{name:"styles"}],removeButtons:"SpecialChar,Anchor,Subscript,Styles",format_tags:"p;h1;h2;h3;pre",removeDialogTabs:"image:advanced;link:advanced",removePlugins:"uploadimage,image2",contentsCss:In("~/Content/site/site.htmlcontent.css"),entities:!1,entities_latin:!1,entities_greek:!1,autoUpdateElement:!0,height:this.options.rows==null||this.options.rows===0?null:this.options.rows*20+"px"}}getEditorInstance(){var e=this.element.attr("id");return window.CKEDITOR.instances[e]}destroy(){var e=this.getEditorInstance();e&&e.destroy(!0),super.destroy()}get_value(){var e=this.getEditorInstance();return this._instanceReady&&e?e.getData():this.element.val()}get value(){return this.get_value()}set_value(e){var t=this.getEditorInstance();this.element.val(e),this._instanceReady&&t&&t.setData(e)}set value(e){this.set_value(e)}get_readOnly(){return!kl(this.element.attr("disabled"))}set_readOnly(e){if(this.get_readOnly()!==e){e?this.element.attr("disabled","disabled"):this.element.removeAttr("disabled");var t=this.getEditorInstance();this._instanceReady&&t&&t.setReadOnly(e)}}static getCKEditorBasePath(){var e=oe.CKEditorBasePath;if(e==null)if(typeof CKEDITOR_BASEPATH!="undefined"&&CKEDITOR_BASEPATH)e=CKEDITOR_BASEPATH;else return"~/Serenity.Assets/Scripts/ckeditor/";return Sl(e,"/")?e:e+"/"}static includeCKEditor(){if(!window.CKEDITOR){var e=$("#CKEditorScript");e.length>0||$("<script/>").attr("type","text/javascript").attr("id","CKEditorScript").attr("src",In(oe.getCKEditorBasePath()+"ckeditor.js?v="+oe.CKEditorVer)).appendTo(window.document.head)}}};oe.CKEditorVer="4.7.1",oe=h([m.registerEditor("Serenity.HtmlContentEditor",[D,R]),m.element("<textarea/>")],oe);var sr=class extends oe{constructor(n,e){super(n,e)}getConfig(){var n=super.getConfig();return n.removeButtons+=",Cut,Copy,Paste,BulletedList,NumberedList,Indent,Outdent,SpecialChar,Subscript,Superscript,Styles,PasteText,PasteFromWord,Strike,Link,Unlink,CreatePlaceholder,Image,Table,HorizontalRule,Source,Maximize,Format,Font,FontSize,Anchor,Blockquote,CreatePlaceholder,BGColor,JustifyLeft,JustifyCenter,JustifyRight,JustifyBlock,Superscript,RemoveFormat",n.removePlugins="elementspath,uploadimage,image2",n}};sr=h([m.registerEditor("Serenity.HtmlNoteContentEditor")],sr);var nr=class extends oe{constructor(n,e){super(n,e)}getConfig(){var n=super.getConfig();return n.removeButtons+=",Cut,Copy,Paste,BulletedList,NumberedList,Indent,Outdent,SpecialChar,Subscript,Superscript,Styles,PasteText,PasteFromWord,Strike,Link,Unlink,CreatePlaceholder,Image,Table,HorizontalRule,Source,Maximize,Format,Font,FontSize,Anchor,Blockquote,CreatePlaceholder,BGColor,JustifyLeft,JustifyCenter,JustifyRight,JustifyBlock,Superscript,RemoveFormat",n.removePlugins="elementspath,uploadimage,image2",n}};nr=h([m.registerEditor("Serenity.HtmlReportContentEditor")],nr);var ar=class extends b{constructor(n,e){var t;super(n,e),n.mask(this.options.mask||"",{placeholder:(t=this.options.placeholder)!=null?t:"_"})}get value(){return this.element.triggerHandler("blur.mask"),this.element.val()}get_value(){return this.value}set value(n){this.element.val(n)}set_value(n){this.value=n}};ar=h([m.registerEditor("Serenity.MaskedEditor",[D]),m.element('<input type="text"/>')],ar);import{addValidationRule as _l,isEmptyOrNull as Pl,localText as Dl}from"@serenity-is/corelib/q";var or=class extends b{constructor(n,e){var u;if(super(n,e),this.element.addClass("g-recaptcha").attr("data-sitekey",this.options.siteKey),window.grecaptcha==null&&$("script#RecaptchaInclude").length===0){var t="https://www.google.com/recaptcha/api.js",i=this.options.language;i==null&&(i=(u=$("html").attr("lang"))!=null?u:""),t+="?hl="+i,$("<script/>").attr("id","RecaptchaInclude").attr("src",t).appendTo(document.body)}var r=$("<input />").insertBefore(this.element).attr("id",this.uniqueName+"_validate").val("x"),a={};a.visibility="hidden",a.width="0px",a.height="0px",a.padding="0px";var o=r.css(a),l=this;_l(o,this.uniqueName,c=>Pl(this.get_value())?Dl("Validation.Required"):null)}get_value(){return this.element.find(".g-recaptcha-response").val()}set_value(n){}};or=h([m.registerEditor("Serenity.Recaptcha",[D]),m.element("<div/>")],or);import{alertDialog as vt,htmlEncode as lr,blockUI as Fl,blockUndo as El,endsWith as dr,format as Lt,iframeDialog as Rl,isEmptyOrNull as Sn,notifyError as At,replaceAll as Vl,resolveUrl as kn,round as On,startsWith as Nl,localText as he}from"@serenity-is/corelib/q";var ke;(u=>{function d(c){c.container.addClass("fileinput-button");var p=c.uploadUrl||"~/File/TemporaryUpload";c.uploadIntent&&(p.indexOf("?")<0?p+="?":p+="&",p+="uploadIntent=",p+=encodeURIComponent(c.uploadIntent));var g=$("<input/>").attr("type","file").attr("name",c.inputName+"[]").attr("data-url",kn(p)).appendTo(c.container);return c.allowMultiple&&g.attr("multiple","multiple"),g.fileupload({dataType:"json",dropZone:c.zone,pasteZone:c.zone,done:function(f,y){var v=y.result;if(v.Error){At(v.Error.Message);return}c.fileDone!=null&&c.fileDone(v,y.files[0].name,y)},fail:function(f,y){var w;var v=(w=y==null?void 0:y._response)==null?void 0:w.jqXHR;if(!v){At("An error occurred during file upload.");return}if((v.getResponseHeader("content-type")||"").toLowerCase().indexOf("application/json")>=0){var C=$.parseJSON(v.responseText);if(C&&C.Error&&C.Error.Message){At(C.Error.Message);return}}var T=v.responseText;if(T){Rl({html:T});return}if(!v.status){v.statusText!="abort"&&At("An unknown connection error occurred! Check browser console for details.");return}if(v.status==500){At("HTTP 500: Connection refused! Check browser console for details.");return}At("HTTP "+v.status+" error! Check browser console for details.")},start:function(){Fl(null),c.progress!=null&&c.progress.show()},stop:function(){El(),c.progress!=null&&c.progress.hide()},progress:function(f,y){if(c.progress!=null){var v=y.loaded/y.total*100;c.progress.children().css("width",v.toString()+"%")}}}),g}u.addUploadInput=d;function n(c,p){return!c.IsImage&&!p.allowNonImage?(vt(he("Controls.ImageUpload.NotAnImageFile")),!1):p.minSize>0&&c.Size<p.minSize?(vt(Lt(he("Controls.ImageUpload.UploadFileTooSmall"),t(p.minSize))),!1):p.maxSize>0&&c.Size>p.maxSize?(vt(Lt(he("Controls.ImageUpload.UploadFileTooBig"),t(p.maxSize))),!1):c.IsImage?p.minWidth>0&&c.Width<p.minWidth?(vt(Lt(he("Controls.ImageUpload.MinWidth"),p.minWidth)),!1):p.maxWidth>0&&c.Width>p.maxWidth?(vt(Lt(he("Controls.ImageUpload.MaxWidth"),p.maxWidth)),!1):p.minHeight>0&&c.Height<p.minHeight?(vt(Lt(he("Controls.ImageUpload.MinHeight"),p.minHeight)),!1):p.maxHeight>0&&c.Height>p.maxHeight?(vt(Lt(he("Controls.ImageUpload.MaxHeight"),p.maxHeight)),!1):!0:!0}u.checkImageConstraints=n;function e(c,p){return c+" ("+t(p)+")"}u.fileNameSizeDisplay=e;function t(c){var p=On(c*100/1024)*.01,g="KB";p>=1024&&(p=On(p*100/1024)*.01,g="MB");var f=p.toString().split(String.fromCharCode(46)),y;return f.length>1?y=f[0]+"."+f[1].substr(0,2):y=f[0],y+" "+g}u.fileSizeDisplay=t;function i(c){return Sn(c)?!1:(c=c.toLowerCase(),dr(c,".jpg")||dr(c,".jpeg")||dr(c,".gif")||dr(c,".png"))}u.hasImageExtension=i;function r(c){c=c!=null?c:"";var p=c.lastIndexOf(".");return p>=0&&(c=c.substr(0,p)),c+"_t.jpg"}u.thumbFileName=r;function a(c){return c=Vl(c!=null?c:"","\\","/"),kn("~/upload/")+c}u.dbFileUrl=a;function o(c,p){c.colorbox({current:lr(he("Controls.ImageUpload.ColorboxCurrent")),previous:lr(he("Controls.ImageUpload.ColorboxPrior")),next:lr(he("Controls.ImageUpload.ColorboxNext")),close:lr(he("Controls.ImageUpload.ColorboxClose"))})}u.colorBox=o;function l(c,p,g,f){var I;p=p||[],c.html("");for(var y=0;y<p.length;y++){var v=p[y],C=$("<li/>").addClass("file-item").data("index",y),T=i(v.Filename);T?C.addClass("file-image"):C.addClass("file-binary");var w="#"+y,k=$("<a/>").addClass("thumb").appendTo(C),_=(I=v.OriginalName)!=null?I:"",x=v.Filename;f!=null&&x!=null&&!Nl(x,"temporary/")&&(x=f+x),k.attr("href",a(x)),k.attr("target","_blank"),Sn(_)||k.attr("title",_),T&&(k.css("backgroundImage","url('"+a(r(v.Filename))+"')"),o(k,new Object)),g&&$("<div/>").addClass("filename").text(_).attr("title",_).appendTo(C),C.appendTo(c)}}u.populateFileSymbols=l})(ke||(ke={}));import{endsWith as Ql,extend as cr,isEmptyOrNull as wn,isInstanceOfType as Bl,isTrimmedEmpty as _n,replaceAll as Ll,startsWith as Al,localText as ds,trimToNull as di}from"@serenity-is/corelib/q";var li=class extends b{constructor(e,t){super(e,t);(!t||t.allowNonImage==null)&&(this.options.allowNonImage=!0),e.addClass("s-FileUploadEditor"),wn(this.options.originalNameProperty)&&e.addClass("hide-original-name"),this.toolbar=new G($("<div/>").appendTo(this.element),{buttons:this.getToolButtons()}),this.progress=$("<div><div></div></div>").addClass("upload-progress").prependTo(this.toolbar.element);var i=this.getUploadInputOptions();this.uploadInput=ke.addUploadInput(i),this.fileSymbols=$("<ul/>").appendTo(this.element),this.element.attr("id")||this.element.attr("id",this.uniqueName),this.hiddenInput=$('<input type="text" class="s-offscreen" name="'+this.uniqueName+'_Validator" data-vx-highlight="'+this.element.attr("id")+'"/>').appendTo(this.element),this.updateInterface()}getUploadInputOptions(){return{container:this.toolbar.findButton("add-file-button"),zone:this.element,inputName:this.uniqueName,progress:this.progress,uploadIntent:this.options.uploadIntent,uploadUrl:this.options.uploadUrl,fileDone:(e,t,i)=>{if(ke.checkImageConstraints(e,this.options)){var r={OriginalName:t,Filename:e.TemporaryFile};this.entity=r,this.populate(),this.updateInterface();var a=this.hiddenInput.closest("form").data("validator");a!=null&&a.element(this.hiddenInput)}}}}addFileButtonText(){return ds("Controls.ImageUpload.AddFileButton")}getToolButtons(){return[{title:this.addFileButtonText(),action:"add-file",cssClass:"add-file-button",onClick:function(){}},{title:"",hint:ds("Controls.ImageUpload.DeleteButtonHint"),action:"delete",cssClass:"delete-button",onClick:()=>{this.entity=null,this.populate(),this.updateInterface();var e=this.hiddenInput.closest("form").data("validator");e!=null&&e.element(this.hiddenInput)}}]}populate(){var e=this.options.displayFileName||!_n(this.options.originalNameProperty);this.entity==null?ke.populateFileSymbols(this.fileSymbols,null,e,this.options.urlPrefix):ke.populateFileSymbols(this.fileSymbols,[this.entity],e,this.options.urlPrefix),this.hiddenInput.val(di((this.get_value()||{}).Filename))}updateInterface(){var e=this.toolbar.findButton("add-file-button"),t=this.toolbar.findButton("delete-button");e.toggleClass("disabled",this.get_readOnly()),t.toggleClass("disabled",this.get_readOnly()||this.entity==null)}get_readOnly(){return this.uploadInput.attr("disabled")!=null}set_readOnly(e){if(this.get_readOnly()!==e){if(e){this.uploadInput.attr("disabled","disabled");try{this.uploadInput.fileupload("disable")}catch(t){}}else{this.uploadInput.removeAttr("disabled");try{this.uploadInput.fileupload("enable")}catch(t){}}this.updateInterface()}}get_required(){return this.hiddenInput.hasClass("required")}set_required(e){this.hiddenInput.toggleClass("required",!!e)}get_value(){if(this.entity==null)return null;var e=cr({},this.entity);return e}get value(){return this.get_value()}set_value(e){var t=e;if(typeof t=="string"){var t=di(t);if(e!=null){var i=t.indexOf("/");i<0&&(i=t.indexOf("\\")),e={Filename:e,OriginalName:t.substring(i+1)}}}else e!=null&&_n(e.Filename)&&(e=null);e!=null?e.Filename==null?this.entity=null:this.entity=cr({},e):this.entity=null,this.populate();var r=this.hiddenInput.closest("form").data("validator");r!=null&&r.element(this.hiddenInput),this.updateInterface()}set value(e){this.set_value(e)}getEditValue(e,t){t[e.name]=this.entity==null?null:di(this.entity.Filename)}setEditValue(e,t){var o;var i={};if(i.Filename=e[t.name],wn(this.options.originalNameProperty)){if(this.options.displayFileName){var r=(o=i.Filename)!=null?o:"",a=Ll(r,"\\","/").lastIndexOf("/");a>=0?i.OriginalName=r.substr(a+1):i.OriginalName=r}}else i.OriginalName=e[this.options.originalNameProperty];this.set_value(i)}};li=h([m.registerEditor("Serenity.FileUploadEditor",[R,X,Z,Ne]),m.element("<div/>")],li);var ur=class extends li{constructor(n,e){super(n,e),e&&e.allowNonImage==null&&(this.options.allowNonImage=!1),n.addClass("s-ImageUploadEditor")}};ur=h([m.registerEditor("Serenity.ImageUploadEditor")],ur);var Gt=class extends b{constructor(e,t){super(e,t);this.entities=[],e.addClass("s-MultipleFileUploadEditor");var i=this;this.toolbar=new G($("<div/>").appendTo(this.element),{buttons:this.getToolButtons()}),this.progress=$("<div><div></div></div>").addClass("upload-progress").prependTo(this.toolbar.element),this.uploadInput=ke.addUploadInput(this.getUploadInputOptions()),this.fileSymbols=$("<ul/>").appendTo(this.element),this.element.attr("id")||this.element.attr("id",this.uniqueName),this.hiddenInput=$('<input type="text" class="s-offscreen" name="'+this.uniqueName+'_Validator" data-vx-highlight="'+this.element.attr("id")+'" multiple="multiple"></input>').appendTo(this.element),this.updateInterface()}getUploadInputOptions(){var e=this.toolbar.findButton("add-file-button");return{container:e,zone:this.element,inputName:this.uniqueName,progress:this.progress,uploadIntent:this.options.uploadIntent,uploadUrl:this.options.uploadUrl,allowMultiple:!0,fileDone:(t,i)=>{if(ke.checkImageConstraints(t,this.options)){var r={OriginalName:i,Filename:t.TemporaryFile};this.entities.push(r),this.populate();var a=this.hiddenInput.closest("form").data("validator");a!=null&&a.element(this.hiddenInput),this.updateInterface()}}}}addFileButtonText(){return ds("Controls.ImageUpload.AddFileButton")}getToolButtons(){return[{title:this.addFileButtonText(),action:"add-file",cssClass:"add-file-button",onClick:function(){}}]}populate(){ke.populateFileSymbols(this.fileSymbols,this.entities,!0,this.options.urlPrefix),this.fileSymbols.children().each((e,t)=>{var i=e;$("<a class='delete'></a>").appendTo($(t).children(".filename")).click(r=>{r.preventDefault(),this.entities.splice(i,1),this.populate();var a=this.hiddenInput.closest("form").data("validator");a!=null&&a.element(this.hiddenInput)})}),this.hiddenInput.val(di((this.get_value()[0]||{}).Filename))}updateInterface(){var e=this.toolbar.findButton("add-file-button");e.toggleClass("disabled",this.get_readOnly()),this.fileSymbols.find("a.delete").toggle(!this.get_readOnly())}get_readOnly(){return this.uploadInput.attr("disabled")!=null}set_readOnly(e){if(this.get_readOnly()!==e){if(e){this.uploadInput.attr("disabled","disabled");try{this.uploadInput.fileupload("disable")}catch(t){}}else{this.uploadInput.removeAttr("disabled");try{this.uploadInput.fileupload("enable")}catch(t){}}this.updateInterface()}}get_required(){return this.hiddenInput.hasClass("required")}set_required(e){this.hiddenInput&&this.hiddenInput.toggleClass("required",!!e)}get_value(){return this.entities.map(function(e){return cr({},e)})}get value(){return this.get_value()}set_value(e){this.entities=(e||[]).map(function(t){return cr({},t)}),this.populate(),this.updateInterface()}set value(e){this.set_value(e)}getEditValue(e,t){this.jsonEncodeValue?t[e.name]=JSON.stringify(this.get_value()):t[e.name]=this.get_value()}setEditValue(e,t){var a;var i=e[t.name];if(Bl(i,String)){var r=(a=di(i))!=null?a:"[]";Al(r,"[")&&Ql(r,"]")?this.set_value($.parseJSON(r)):this.set_value([{Filename:r,OriginalName:"UnknownFile"}])}else this.set_value(i)}};h([m.option()],Gt.prototype,"jsonEncodeValue",2),Gt=h([m.registerEditor("Serenity.MultipleFileUploadEditor",[R,X,Z,Ne]),m.element("<div/>")],Gt);var pr=class extends Gt{constructor(n,e){super(n,e),n.addClass("s-MultipleImageUploadEditor")}};pr=h([m.registerEditor("Serenity.MultipleImageUploadEditor")],pr);import{ArgumentNullException as Gl,Criteria as Xe,delegateCombine as Wl,delegateRemove as ql,formatDate as Ml,isEmptyOrNull as H,localText as Wt,notifyWarning as hr,parseDate as mr,toId as Jl,tryGetText as us}from"@serenity-is/corelib/q";var W=class extends b{constructor(e,t){var o;super(e,t);e.addClass("quick-filters-bar").addClass("clear");for(var i=this.options.filters,r=0;r<i.length;r++){var a=i[r];this.add(a)}this.options.idPrefix=(o=this.options.idPrefix)!=null?o:this.uniqueName+"_"}addSeparator(){this.element.append($("<hr/>"))}add(e){var l;if(e==null)throw new Gl("opt");e.separator&&this.addSeparator();var t=$("<div class='quick-filter-item'><span class='quick-filter-label'></span></div>").appendTo(this.element).data("qffield",e.field).children(),i=(l=us(e.title))!=null?l:e.title;i==null&&(i=this.options.getTitle?this.options.getTitle(e):null,i==null&&(i=e.field));var r=t.text(i).parent();e.displayText!=null&&r.data("qfdisplaytext",e.displayText),e.saveState!=null&&r.data("qfsavestate",e.saveState),e.loadState!=null&&r.data("qfloadstate",e.loadState),H(e.cssClass)||r.addClass(e.cssClass);var a=b.create({type:e.type,element:u=>{H(e.field)||u.attr("id",this.options.idPrefix+e.field),u.attr("placeholder"," "),u.appendTo(r),e.element!=null&&e.element(u)},options:e.options,init:e.init}),o=u=>{if(!r.hasClass("ignore")){u.EqualityFilter=u.EqualityFilter||{};var c=S.getValue(a),p=c!=null&&!H(c.toString());if(e.handler!=null){var g={field:e.field,request:u,equalityFilter:u.EqualityFilter,value:c,active:p,widget:a,handled:!0};e.handler(g),r.toggleClass("quick-filter-active",g.active),g.handled||(u.EqualityFilter[e.field]=c)}else u.EqualityFilter[e.field]=c,r.toggleClass("quick-filter-active",p)}};return a.changeSelect2(u=>{window.setTimeout(()=>this.onChange&&this.onChange(u),0)}),this.add_submitHandlers(o),a.element.bind("remove."+this.uniqueName,u=>{this.remove_submitHandlers(o)}),a}addDateRange(e,t){return this.add(W.dateRange(e,t))}static dateRange(e,t){var i=null;return{field:e,type:V,title:t,element:function(r){i=b.create({type:V,element:function(a){a.insertAfter(r)},options:null,init:null}),i.element.change(function(a){r.triggerHandler("change")}),$("<span/>").addClass("range-separator").text("-").insertAfter(r)},handler:function(r){var a=mr(r.widget.value);a&&(isNaN(a.valueOf())?(hr(Wt("Validation.DateInvalid"),"",null),r.widget.element.val(""),a=null):r.request.Criteria=Xe.and(r.request.Criteria,Xe(r.field).ge(r.widget.value)));var o=mr(i.value);if(o)if(isNaN(o==null?void 0:o.valueOf()))hr(Wt("Validation.DateInvalid"),"",null),i.element.val(""),o=null;else{var l=new Date(i.valueAsDate.valueOf());l.setDate(l.getDate()+1),r.request.Criteria=Xe.and(r.request.Criteria,Xe(r.field).lt(Ml(l,"yyyy-MM-dd")))}r.active=!!(a||o)},displayText:function(r,a){var p;var o=S.getDisplayText(r),l=S.getDisplayText(i);if(H(o)&&H(l))return null;var u=a+" >= "+o,c=a+" <= "+l;return!H(o)&&!H(l)?u+" "+((p=us("Controls.FilterPanel.And"))!=null?p:"and")+" "+c:H(o)?c:u},saveState:function(r){return[S.getValue(r),S.getValue(i)]},loadState:function(r,a){(a==null||!Array.isArray(a)||a.length!==2)&&(a=[null,null]),S.setValue(r,a[0]),S.setValue(i,a[1])}}}addDateTimeRange(e,t){return this.add(W.dateTimeRange(e,t))}static dateTimeRange(e,t,i){var r=null;return{field:e,type:A,title:t,element:function(a){r=b.create({type:A,element:function(o){o.insertAfter(a)},options:i==null?null:{useUtc:i},init:null}),r.element.change(function(o){a.triggerHandler("change")}),$("<span/>").addClass("range-separator").text("-").insertAfter(a)},init:function(a){a.element.parent().find(".time").change(function(o){a.element.triggerHandler("change")})},handler:function(a){var o=mr(a.widget.value);o&&(isNaN(o==null?void 0:o.valueOf())?(hr(Wt("Validation.DateInvalid"),"",null),a.widget.element.val(""),o=null):a.request.Criteria=Xe.and(a.request.Criteria,Xe(a.field).ge(a.widget.value)));var l=mr(r.value);l&&(isNaN(l==null?void 0:l.valueOf())?(hr(Wt("Validation.DateInvalid"),"",null),r.element.val(""),l=null):a.request.Criteria=Xe.and(a.request.Criteria,Xe(a.field).le(r.value))),a.active=!!(o||l)},displayText:function(a,o){var g;var l=S.getDisplayText(a),u=S.getDisplayText(r);if(H(l)&&H(u))return null;var c=o+" >= "+l,p=o+" <= "+u;return!H(l)&&!H(u)?c+" "+((g=us("Controls.FilterPanel.And"))!=null?g:"and")+" "+p:H(l)?p:c},saveState:function(a){return[S.getValue(a),S.getValue(r)]},loadState:function(a,o){(o==null||!Array.isArray(o)||o.length!==2)&&(o=[null,null]),S.setValue(a,o[0]),S.setValue(r,o[1])},options:i==null?null:{useUtc:i}}}addBoolean(e,t,i,r){return this.add(W.boolean(e,t,i,r))}static boolean(e,t,i,r){var a={},o=[],l=i;l==null&&(l=Wt("Controls.FilterPanel.OperatorNames.true")),o.push(["1",l]);var u=r;return u==null&&(u=Wt("Controls.FilterPanel.OperatorNames.false")),o.push(["0",u]),a.items=o,{field:e,type:Ye,title:t,options:a,handler:function(c){c.equalityFilter[c.field]=c.value==null||H(c.value.toString())?null:!!Jl(c.value)}}}destroy(){this.submitHandlers=null,super.destroy()}onSubmit(e){this.submitHandlers&&this.submitHandlers(e)}add_submitHandlers(e){this.submitHandlers=Wl(this.submitHandlers,e)}remove_submitHandlers(e){this.submitHandlers=ql(this.submitHandlers,e)}clear_submitHandlers(){}find(e,t){return $("#"+this.options.idPrefix+t).getWidget(e)}tryFind(e,t){var i=$("#"+this.options.idPrefix+t);return i.length?i.tryGetWidget(e):null}};W=h([m.registerClass("Serenity.QuickFilterBar"),m.element("<div/>")],W);import{isEmptyOrNull as Pn,isValue as $l,localText as ps,trim as gr}from"@serenity-is/corelib/q";var ie=class extends b{constructor(e,t){var u,c;super(e,t);e.attr("title",ps("Controls.QuickSearch.Hint")).attr("placeholder",ps("Controls.QuickSearch.Placeholder")),this.lastValue=gr((u=e.val())!=null?u:"");var i=this;if(this.element.bind("keyup."+this.uniqueName,function(){i.checkIfValueChanged()}),this.element.bind("change."+this.uniqueName,function(){i.checkIfValueChanged()}),$("<span><i></i></span>").addClass("quick-search-icon").insertBefore(e),$l(this.options.fields)&&this.options.fields.length>0){var r=$("<a/>").addClass("quick-search-field").attr("title",ps("Controls.QuickSearch.FieldSelection")).insertBefore(e),a=$("<ul></ul>").css("width","120px");for(var o of this.options.fields){var l={$:o};$("<li><a/></li>").appendTo(a).children().attr("href","#").text((c=o.title)!=null?c:"").click(function(p){p.preventDefault(),this.$this.fieldChanged=i.field!==this.field.$,i.field=this.field.$,this.$this.updateInputPlaceHolder(),this.$this.checkIfValueChanged()}.bind({field:l,$this:this}))}new ft(r,{positionMy:"right top",positionAt:"right bottom",menu:a}),this.field=this.options.fields[0],this.updateInputPlaceHolder()}this.element.bind("execute-search."+this.uniqueName,p=>{var g;this.timer&&window.clearTimeout(this.timer),this.searchNow(gr((g=this.element.val())!=null?g:""))})}checkIfValueChanged(){var i;if(!this.element.hasClass("ignore-change")){var e=this.get_value();if(e==this.lastValue&&(!this.fieldChanged||Pn(e))){this.fieldChanged=!1;return}this.fieldChanged=!1,this.timer&&window.clearTimeout(this.timer);var t=this;this.timer=window.setTimeout(function(){t.searchNow(e)},(i=this.options.typeDelay)!=null?i:500),this.lastValue=e}}get_value(){var e;return gr((e=this.element.val())!=null?e:"")}get_field(){return this.field}set_field(e){this.field!==e&&(this.fieldChanged=!0,this.field=e,this.updateInputPlaceHolder(),this.checkIfValueChanged())}updateInputPlaceHolder(){var e=this.element.prevAll(".quick-search-field");this.field?e.text(this.field.title):e.text("")}restoreState(i,t){this.fieldChanged=!1,this.field=t;var i=gr(i!=null?i:"");this.element.val(i),this.lastValue=i,this.timer&&(window.clearTimeout(this.timer),this.timer=null),this.updateInputPlaceHolder()}searchNow(e){var i,r,a;this.element.parent().toggleClass((i=this.options.filteredParentClass)!=null?i:"s-QuickSearchFiltered",e.length>0),this.element.parent().addClass((r=this.options.loadingParentClass)!=null?r:"s-QuickSearchLoading").addClass((a=this.options.loadingParentClass)!=null?a:"s-QuickSearchLoading");var t=o=>{var u,c;if(this.element.removeClass((u=this.options.loadingParentClass)!=null?u:"s-QuickSearchLoading").parent().removeClass((c=this.options.loadingParentClass)!=null?c:"s-QuickSearchLoading"),!o){var l=this.element.closest(".s-QuickSearchBar").find(".quick-search-icon i")[0];l&&(l.classList.add("s-shake-effect"),setTimeout(()=>l.classList.remove("s-shake-effect"),2e3))}};this.options.onSearch!=null?this.options.onSearch(this.field!=null&&!Pn(this.field.name)?this.field.name:null,e,t):t(!0)}};ie=h([m.registerClass("Serenity.QuickSearchInput")],ie);var O;(v=>(v.isTrue="true",v.isFalse="false",v.contains="contains",v.startsWith="startswith",v.EQ="eq",v.NE="ne",v.GT="gt",v.GE="ge",v.LT="lt",v.LE="le",v.BW="bw",v.IN="in",v.isNull="isnull",v.isNotNull="isnotnull",v.toCriteriaOperator={eq:"=",ne:"!=",gt:">",ge:">=",lt:"<",le:"<="}))(O||(O={}));import{ArgumentNullException as zl,Criteria as me,Culture as Hl,delegateCombine as Ul,delegateRemove as jl,localText as Kl,tryGetText as Dn}from"@serenity-is/corelib/q";var le=class{constructor(n){if(this.items=[],n==null)throw new zl("source");this.fields=n.slice(),this.get_fields().sort(function(t,i){var r=Dn(t.title);r==null&&(r=t.title,r==null&&(r=t.name));var a=Dn(i.title);return a==null&&(a=i.title,a==null&&(a=i.name)),Hl.stringCompare(r,a)}),this.fieldByName={};for(var e of n)this.get_fieldByName()[e.name]=e}static getCriteriaFor(n){if(n==null)return[""];for(var e=!1,t=[""],i=!1,r=[""],a=0;a<n.length;a++){var o=n[a];(o.leftParen||e&&o.rightParen)&&(me.isEmpty(t)||(e&&(t=me.paren(t)),i?r=me.or(r,t):r=me.and(r,t),t=[""]),e=!1),o.leftParen&&(i=o.isOr,e=!0),o.isOr?t=me.or(t,o.criteria):t=me.and(t,o.criteria)}return me.isEmpty(t)||(i?r=me.or(r,me.paren(t)):r=me.and(r,me.paren(t))),r}static getDisplayTextFor(n){if(n==null)return"";for(var e=!1,t="",i=0;i<n.length;i++){var r=n[i];e&&(r.rightParen||r.leftParen)&&(t+=")",e=!1),t.length>0&&(t+=" "+Kl("Controls.FilterPanel."+(r.isOr?"Or":"And"))+" "),r.leftParen&&(t+="(",e=!0),t+=r.displayText}return e&&(t+=")"),t}get_fields(){return this.fields}get_fieldByName(){return this.fieldByName}get_items(){return this.items}raiseChanged(){this.displayText=null,this.changed&&this.changed(this,{})}add_changed(n){this.changed=Ul(this.changed,n)}remove_changed(n){this.changed=jl(this.changed,n)}get_activeCriteria(){return le.getCriteriaFor(this.items)}get_displayText(){return this.displayText==null&&(this.displayText=le.getDisplayTextFor(this.items)),this.displayText}};le=h([m.registerClass("Serenity.FilterStore")],le);import{ArgumentNullException as Vn,Config as Yl,Criteria as ui,deepClone as Ir,endsWith as Xl,Exception as Tr,extend as Sr,format as Ct,formatDate as Fn,getInstanceType as En,getTypeFullName as cs,getTypes as Zl,isAssignableFrom as ed,isEmptyOrNull as hs,parseISODateTime as td,startsWith as id,localText as rd,tryGetText as Rn}from"@serenity-is/corelib/q";var Ze=class{};Ze=h([m.registerInterface("Serenity.IFiltering")],Ze);var xt=class{};xt=h([m.registerInterface("Serenity.IQuickFiltering")],xt);var It=class{get_field(){return this.field}set_field(n){this.field=n}get_container(){return this.container}set_container(n){this.container=n}get_operator(){return this.operator}set_operator(n){this.operator=n}appendNullableOperators(n){return this.isNullable()&&(n.push({key:O.isNotNull}),n.push({key:O.isNull})),n}appendComparisonOperators(n){return n.push({key:O.EQ}),n.push({key:O.NE}),n.push({key:O.LT}),n.push({key:O.LE}),n.push({key:O.GT}),n.push({key:O.GE}),n}isNullable(){return this.get_field().required!==!0}createEditor(){switch(this.get_operator().key){case"true":case"false":case"isnull":case"isnotnull":return;case"contains":case"startswith":case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{this.get_container().html('<input type="text"/>');return}}throw new Tr(Ct("Filtering '{0}' has no editor for '{1}' operator",cs(En(this)),this.get_operator().key))}operatorFormat(n){var e,t;return(t=(e=n.format)!=null?e:Rn("Controls.FilterPanel.OperatorFormats."+n.key))!=null?t:n.key}getTitle(n){var e,t;return(t=Rn(n.title))!=null?t:(e=n.title)!=null?e:n.name}displayText(n,e){return!e||e.length===0?Ct(this.operatorFormat(n),this.getTitle(this.field)):e.length===1?Ct(this.operatorFormat(n),this.getTitle(this.field),e[0]):Ct(this.operatorFormat(n),this.getTitle(this.field),e[0],e[1])}getCriteriaField(){return this.field.name}getCriteria(){var n={},e,t=ui(this.getCriteriaField()),i=this.get_operator().key;switch(i){case"true":return n.displayText=this.displayText(this.get_operator(),[]),n.criteria=t.eq(!0),n;case"false":return n.displayText=this.displayText(this.get_operator(),[]),n.criteria=t.eq(!1),n;case"isnull":return n.displayText=this.displayText(this.get_operator(),[]),n.criteria=t.isNull(),n;case"isnotnull":return n.displayText=this.displayText(this.get_operator(),[]),n.criteria=t.isNotNull(),n;case"contains":return e=this.getEditorText(),n.displayText=this.displayText(this.get_operator(),[e]),n.criteria=t.contains(e),n;case"startswith":return e=this.getEditorText(),n.displayText=this.displayText(this.get_operator(),[e]),n.criteria=t.startsWith(e),n;case"eq":case"ne":case"lt":case"le":case"gt":case"ge":return e=this.getEditorText(),n.displayText=this.displayText(this.get_operator(),[e]),n.criteria=t[i](this.getEditorValue()),n}throw new Tr(Ct("Filtering '{0}' has no handler for '{1}' operator",cs(En(this)),this.get_operator().key))}loadState(n){var e=this.get_container().find(":input").first();e.val(n)}saveState(){switch(this.get_operator().key){case"contains":case"startswith":case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{var n=this.get_container().find(":input").first();return n.val()}}return null}argumentNull(){return new Vn("value",rd("Controls.FilterPanel.ValueRequired"))}validateEditorValue(n){if(n.length===0)throw this.argumentNull();return n}getEditorValue(){var t;var n=this.get_container().find(":input").not(".select2-focusser").first();if(n.length!==1)throw new Tr(Ct("Couldn't find input in filter container for {0}",(t=this.field.title)!=null?t:this.field.name));var e;return n.data("select2")!=null?e=n.select2("val"):e=n.val(),e=(e!=null?e:"").trim(),this.validateEditorValue(e)}getEditorText(){var t;var n=this.get_container().find(":input").not(".select2-focusser").not(".select2-input").first();if(n.length===0)return this.get_container().text().trim();var e;return n.data("select2")!=null?e=((t=n.select2("data"))!=null?t:{}).text:e=n.val(),e}initQuickFilter(n){n.field=this.getCriteriaField(),n.type=ae,n.title=this.getTitle(this.field),n.options=Ir(this.get_field().quickFilterParams)}};It=h([m.registerClass("Serenity.BaseFiltering",[Ze,xt])],It);function ge(d){return m.registerClass("Serenity."+d+"Filtering")}var de=class extends It{constructor(e){super();this.editorType=e}useEditor(){switch(this.get_operator().key){case"eq":case"ne":case"lt":case"le":case"gt":case"ge":return!0}return!1}createEditor(){if(this.useEditor()){this.editor=b.create({type:this.editorType,container:this.get_container(),options:this.getEditorOptions(),init:null});return}this.editor=null,super.createEditor()}useIdField(){return!1}getCriteriaField(){return this.useEditor()&&this.useIdField()&&!hs(this.get_field().filteringIdField)?this.get_field().filteringIdField:super.getCriteriaField()}getEditorOptions(){var e=Ir(this.get_field().editorParams||{});return delete e.cascadeFrom,Sr(e,this.get_field().filteringParams)}loadState(e){if(this.useEditor()){if(e==null)return;S.setValue(this.editor,e);return}super.loadState(e)}saveState(){return this.useEditor()?S.getValue(this.editor):super.saveState()}getEditorValue(){if(this.useEditor()){var e=S.getValue(this.editor);if(e==null||typeof e=="string"&&e.trim().length===0)throw this.argumentNull();return e}return super.getEditorValue()}initQuickFilter(e){super.initQuickFilter(e),e.type=this.editorType,e.options=Sr(Sr({},Ir(this.getEditorOptions())),Ir(this.get_field().quickFilterParams))}};de=h([ge("BaseEditor")],de);var qt=class extends de{constructor(){super(V)}getOperators(){return this.appendNullableOperators(this.appendComparisonOperators([]))}};qt=h([ge("Date")],qt);var Mt=class extends It{getOperators(){return this.appendNullableOperators([{key:O.isTrue},{key:O.isFalse}])}};Mt=h([ge("Boolean")],Mt);var Jt=class extends de{constructor(){super(A)}getOperators(){return this.appendNullableOperators(this.appendComparisonOperators([]))}getCriteria(){var n={};switch(this.get_operator().key){case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{{var e=this.getEditorText();n.displayText=this.displayText(this.get_operator(),[e]);var t=td(this.getEditorValue());t=new Date(t.getFullYear(),t.getMonth(),t.getDate());var i=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1),r=ui(this.getCriteriaField()),a=Fn(t,"yyyy-MM-dd"),o=Fn(i,"yyyy-MM-dd");switch(this.get_operator().key){case"eq":return n.criteria=ui.and(r.ge(a),r.lt(o)),n;case"ne":return n.criteria=ui.paren(ui.or(r.lt(a),r.gt(o))),n;case"lt":return n.criteria=r.lt(a),n;case"le":n.criteria=r.lt(o);case"gt":return n.criteria=r.ge(o),n;case"ge":return n.criteria=r.ge(a),n}}break}}return super.getCriteria()}};Jt=h([ge("DateTime")],Jt);var fr=class extends de{constructor(){super(Te)}getOperators(){return this.appendNullableOperators(this.appendComparisonOperators([]))}};fr=h([ge("Decimal")],fr);var bt=class extends de{constructor(){super(b)}getOperators(){var e=[];return e.push({key:O.EQ}),e.push({key:O.NE}),this.useRelative&&(e.push({key:O.LT}),e.push({key:O.LE}),e.push({key:O.GT}),e.push({key:O.GE})),this.useLike&&(e.push({key:O.contains}),e.push({key:O.startsWith})),this.appendNullableOperators(e),e}useEditor(){var e=this.get_operator().key;return e===O.EQ||e===O.NE||this.useRelative&&(e===O.LT||e===O.LE||e===O.GT||e===O.GE)}getEditorOptions(){var t;var e=super.getEditorOptions();return this.useEditor()&&this.editorType===((t=this.get_field().editorType)!=null?t:"String")&&(e=Sr(e,this.get_field().editorParams)),e}createEditor(){if(this.useEditor()){var e=gt.get(this.editorType);this.editor=b.create({type:e,element:t=>t.appendTo(this.get_container()),options:this.getEditorOptions()});return}super.createEditor()}useIdField(){return this.useEditor()}initQuickFilter(e){super.initQuickFilter(e),e.type=gt.get(this.editorType)}};h([m.option()],bt.prototype,"editorType",2),h([m.option()],bt.prototype,"useRelative",2),h([m.option()],bt.prototype,"useLike",2),bt=h([ge("Editor")],bt);var yr=class extends de{constructor(){super(Nt)}getOperators(){var n=[{key:O.EQ},{key:O.NE}];return this.appendNullableOperators(n)}};yr=h([ge("Enum")],yr);var vr=class extends de{constructor(){super(Dt)}getOperators(){return this.appendNullableOperators(this.appendComparisonOperators([]))}};vr=h([ge("Integer")],vr);var br=class extends de{constructor(){super(Qt)}getOperators(){var n=[{key:O.EQ},{key:O.NE},{key:O.contains},{key:O.startsWith}];return this.appendNullableOperators(n)}useEditor(){var n=this.get_operator().key;return n==O.EQ||n==O.NE}useIdField(){return this.useEditor()}getEditorText(){return this.useEditor()?this.editor.text:super.getEditorText()}};br=h([ge("Lookup")],br);var Cr=class extends de{constructor(){super(Bt)}getOperators(){var n=[{key:O.EQ},{key:O.NE},{key:O.contains},{key:O.startsWith}];return this.appendNullableOperators(n)}useEditor(){var n=this.get_operator().key;return n==O.EQ||n==O.NE}useIdField(){return this.useEditor()}getEditorText(){return this.useEditor()?this.editor.text:super.getEditorText()}};Cr=h([ge("ServiceLookup")],Cr);var xr=class extends It{getOperators(){var n=[{key:O.contains},{key:O.startsWith},{key:O.EQ},{key:O.NE}];return this.appendNullableOperators(n)}validateEditorValue(n){return n.length===0?n:super.validateEditorValue(n)}};xr=h([ge("String")],xr);var $t;(r=>{let d;function n(){if(d==null){d={};for(var a of Zl())if(ed(Ze,a)){var o=cs(a).toLowerCase();d[o]=a;for(var l of Yl.rootNamespaces)if(id(o,l.toLowerCase()+".")){var u=o.substr(l.length+1).toLowerCase();d[u]==null&&(d[u]=a)}}e()}}function e(){var a="filtering";for(var o of Object.keys(d))if(Xl(o,a)){var l=o.substr(0,o.length-a.length);hs(l)||d[l]==null&&(d[l]=d[o])}}function t(){d=null}function i(a){if(hs(a))throw new Vn("key");n();var o=d[a.toLowerCase()];if(o==null)throw new Tr(Ct("Can't find {0} filter handler type!",a));return o}r.get=i})($t||($t={}));var et=class extends B{constructor(e,t){super(e,t);this.store=new le([]),this.onFilterStoreChanged=()=>this.filterStoreChanged(),this.store.add_changed(this.onFilterStoreChanged)}destroy(){this.store&&(this.store.remove_changed(this.onFilterStoreChanged),this.onFilterStoreChanged=null,this.store=null),super.destroy()}filterStoreChanged(){}get_store(){return this.store}set_store(e){this.store!==e&&(this.store!=null&&this.store.remove_changed(this.onFilterStoreChanged),this.store=e||new le([]),this.store.add_changed(this.onFilterStoreChanged),this.filterStoreChanged())}};et=h([m.registerClass("Serenity.FilterWidgetBase")],et);import{cast as sd,isEmptyOrNull as ms,localText as fe,tryGetText as Nn}from"@serenity-is/corelib/q";var tt=class extends L{constructor(n,e){var i,r;super(n);for(var t of e)this.addOption(t.name,(r=(i=Nn(t.title))!=null?i:t.title)!=null?r:t.name,t)}emptyItemText(){return ms(this.value)?fe("Controls.FilterPanel.SelectField"):null}getSelect2Options(){var n=super.getSelect2Options();return n.allowClear=!1,n}};tt=h([m.registerClass("Serenity.FilterFieldSelect")],tt);var it=class extends L{constructor(n,e){var r,a;super(n);for(var t of e){var i=(a=t.title)!=null?a:(r=Nn("Controls.FilterPanel.OperatorNames."+t.key))!=null?r:t.key;this.addOption(t.key,i,t)}e.length&&e[0]&&(this.value=e[0].key)}emptyItemText(){return null}getSelect2Options(){var n=super.getSelect2Options();return n.allowClear=!1,n}};it=h([m.registerClass("Serenity.FilterOperatorSelect")],it);var zt=class extends et{constructor(e){super(e);this.element.addClass("s-FilterPanel"),this.rowsDiv=this.byId("Rows"),this.initButtons(),this.updateButtons()}get_showInitialLine(){return this.showInitialLine}set_showInitialLine(e){this.showInitialLine!==e&&(this.showInitialLine=e,this.showInitialLine&&this.rowsDiv.children().length===0&&this.addEmptyRow(!1))}filterStoreChanged(){super.filterStoreChanged(),this.updateRowsFromStore()}updateRowsFromStore(){this.rowsDiv.empty();var e=this.get_store().get_items();for(var t of e){this.addEmptyRow(!1);var i=this.rowsDiv.children().last(),r=i.children("div.l");r.children(".leftparen").toggleClass("active",!!t.leftParen),r.children(".rightparen").toggleClass("active",!!t.rightParen),r.children(".andor").toggleClass("or",!!t.isOr).text(fe(t.isOr?"Controls.FilterPanel.Or":"Controls.FilterPanel.And"));var a=i.children("div.f").find("input.field-select").getWidget(tt);a.value=t.field,this.rowFieldChange(i);var o=i.children("div.o").find("input.op-select").getWidget(it);o.set_value(t.operator),this.rowOperatorChange(i);var l=this.getFilteringFor(i);l!=null&&(l.set_operator({key:t.operator}),l.loadState(t.state))}this.get_showInitialLine()&&this.rowsDiv.children().length===0&&this.addEmptyRow(!1),this.updateParens()}get_showSearchButton(){return this.showSearchButton}set_showSearchButton(e){this.showSearchButton!==e&&(this.showSearchButton=e,this.updateButtons())}get_updateStoreOnReset(){return this.updateStoreOnReset}set_updateStoreOnReset(e){this.updateStoreOnReset!==e&&(this.updateStoreOnReset=e)}getTemplate(){return"<div id='~_Rows' class='filter-lines'></div><div id='~_Buttons' class='buttons'><button id='~_AddButton' class='btn btn-primary add'></button><button id='~_SearchButton' class='btn btn-success search'></button><button id='~_ResetButton' class='btn btn-danger reset'></button></div><div style='clear: both'></div>"}initButtons(){this.byId("AddButton").text(fe("Controls.FilterPanel.AddFilter")).click(e=>this.addButtonClick(e)),this.byId("SearchButton").text(fe("Controls.FilterPanel.SearchButton")).click(e=>this.searchButtonClick(e)),this.byId("ResetButton").text(fe("Controls.FilterPanel.ResetButton")).click(e=>this.resetButtonClick(e))}searchButtonClick(e){e.preventDefault(),this.search()}get_hasErrors(){return this.rowsDiv.children().children("div.v").children("span.error").length>0}search(){this.rowsDiv.children().children("div.v").children("span.error").remove();for(var e=[],t=null,i=null,r=0;r<this.rowsDiv.children().length;r++){i=this.rowsDiv.children().eq(r);var a=this.getFilteringFor(i);if(a!=null){var o=this.getFieldFor(i),l=i.children("div.o").find("input.op-select").getWidget(it).value;if(l==null||l.length===0){t=fe("Controls.FilterPanel.InvalidOperator");break}var u={};u.field=o.name,u.operator=l,u.isOr=i.children("div.l").children("a.andor").hasClass("or"),u.leftParen=i.children("div.l").children("a.leftparen").hasClass("active"),u.rightParen=i.children("div.l").children("a.rightparen").hasClass("active"),a.set_operator({key:l});var c=a.getCriteria();u.criteria=c.criteria,u.state=a.saveState(),u.displayText=c.displayText,e.push(u)}}if(t!=null){$("<span/>").addClass("error").attr("title",t).appendTo(i.children("div.v")),i.children("div.v").find("input:first").focus();return}var p=this.get_store().get_items();p.length=0,p.push.apply(p,e),this.get_store().raiseChanged()}addButtonClick(e){this.addEmptyRow(!0),e.preventDefault()}resetButtonClick(e){e.preventDefault(),this.get_updateStoreOnReset()&&this.get_store().get_items().length>0&&(this.get_store().get_items().length=0,this.get_store().raiseChanged()),this.rowsDiv.empty(),this.updateButtons(),this.get_showInitialLine()&&this.addEmptyRow(!1)}findEmptyRow(){var e=null;return this.rowsDiv.children().each(function(t,i){var r=$(i).children("div.f").children("input.field-select").first();if(r.length===0)return!0;var a=r.val();return a==null||a.length===0?(e=$(i),!1):!0}),e}addEmptyRow(e){var t=this.findEmptyRow();if(t!=null)return t.find("input.field-select").select2("focus"),e&&t.find("input.field-select").select2("open"),t;var i=this.rowsDiv.children().last().children("a.andor").hasClass("or"),r=$("<div class='filter-line'><a class='delete'><span></span></a><div class='l'><a class='rightparen' href='#'>)</a><a class='andor' href='#'></a><a class='leftparen' href='#'>(</a></div><div class='f'><input type='hidden' class='field-select'></div><div class='o'></div><div class='v'></div><div style='clear: both'></div></div>").appendTo(this.rowsDiv),a=r.children("div.l").hide();a.children("a.leftparen, a.rightparen").click(u=>this.leftRightParenClick(u));var o=a.children("a.andor").attr("title",fe("Controls.FilterPanel.ChangeAndOr"));i?o.addClass("or").text(fe("Controls.FilterPanel.Or")):o.text(fe("Controls.FilterPanel.And")),o.click(u=>this.andOrClick(u)),r.children("a.delete").attr("title",fe("Controls.FilterPanel.RemoveField")).click(u=>this.deleteRowClick(u));var l=new tt(r.children("div.f").children("input"),this.get_store().get_fields()).changeSelect2(u=>this.onRowFieldChange(u));return this.updateParens(),this.updateButtons(),r.find("input.field-select").select2("focus"),e&&r.find("input.field-select").select2("open"),r}onRowFieldChange(e){var t=$(e.target).closest("div.filter-line");this.rowFieldChange(t);var i=t.children("div.o").find("input.op-select");i.select2("focus")}rowFieldChange(e){e.removeData("Filtering");var t=e.children("div.f").find("input.field-select").getWidget(tt),i=t.get_value(),r=i==null||i==="";this.removeFiltering(e),this.populateOperatorList(e),this.rowOperatorChange(e),this.updateParens(),this.updateButtons()}removeFiltering(e){e.data("Filtering",null),e.data("FilteringField",null)}populateOperatorList(e){e.children("div.o").html("");var t=this.getFilteringFor(e);if(t!=null){var i=e.children("div.o").html("<input/>").children().attr("type","hidden").addClass("op-select"),r=t.getOperators(),a=new it(i,r);a.changeSelect2(o=>this.onRowOperatorChange(o))}}getFieldFor(e){if(e.length===0)return null;var t=e.children("div.f").find("input.field-select").getWidget(tt);return ms(t.value)?null:this.get_store().get_fieldByName()[t.get_value()]}getFilteringFor(e){var o;var t=this.getFieldFor(e);if(t==null)return null;var i=sd(e.data("Filtering"),Ze);if(i!=null)return i;var r=$t.get((o=t.filteringType)!=null?o:"String"),a=e.children("div.v");return i=new r,ne.set(i,t.filteringParams),i.set_container(a),i.set_field(t),e.data("Filtering",i),i}onRowOperatorChange(e){var t=$(e.target).closest("div.filter-line");this.rowOperatorChange(t);var i=t.children("div.v").find(":input:visible").first();try{i.focus()}catch(r){}}rowOperatorChange(e){if(e.length!==0){var t=e.children("div.v");t.html("");var i=this.getFilteringFor(e);if(i!=null){var r=e.children("div.o").find("input.op-select").getWidget(it);if(!ms(r.get_value())){var a=i.getOperators().filter(function(l){return l.key===r.value}),o=a.length>0?a[0]:null;o!=null&&(i.set_operator(o),i.createEditor())}}}}deleteRowClick(e){e.preventDefault();var t=$(e.target).closest("div.filter-line");t.remove(),this.rowsDiv.children().length===0&&this.search(),this.updateParens(),this.updateButtons()}updateButtons(){this.byId("SearchButton").toggle(this.rowsDiv.children().length>=1&&this.showSearchButton),this.byId("ResetButton").toggle(this.rowsDiv.children().length>=1)}andOrClick(e){e.preventDefault();var t=$(e.target).toggleClass("or");t.text(fe("Controls.FilterPanel."+(t.hasClass("or")?"Or":"And")))}leftRightParenClick(e){e.preventDefault(),$(e.target).toggleClass("active"),this.updateParens()}updateParens(){var e=this.rowsDiv.children();if(e.length!==0){e.removeClass("paren-start"),e.removeClass("paren-end"),e.children("div.l").css("display",e.length===1?"none":"block"),e.first().children("div.l").children("a.rightparen, a.andor").css("visibility","hidden");for(var t=1;t<e.length;t++){var i=e.eq(t);i.children("div.l").css("display","block").children("a.lefparen, a.andor").css("visibility","visible")}for(var r=!1,a=0;a<e.length;a++){var o=e.eq(a),l=o.children("div.l"),u=l.children("a.leftparen"),c=l.children("a.rightparen");c.hasClass("active")&&r&&(r=!1,a>0&&e.eq(a-1).addClass("paren-end")),u.hasClass("active")&&(r=!0,a>0&&o.addClass("paren-start"))}}}};zt=h([m.registerClass("Serenity.FilterPanel")],zt);import{notifyError as nd,localText as kr}from"@serenity-is/corelib/q";var Ht=class extends N{constructor(){super();this.filterPanel=new zt(this.byId("FilterPanel")),this.filterPanel.set_showInitialLine(!0),this.filterPanel.set_showSearchButton(!1),this.filterPanel.set_updateStoreOnReset(!1),this.dialogTitle=kr("Controls.FilterPanel.DialogTitle")}get_filterPanel(){return this.filterPanel}getTemplate(){return'<div id="~_FilterPanel"/>'}getDialogButtons(){return[{text:kr("Dialogs.OkButton"),click:()=>{if(this.filterPanel.search(),this.filterPanel.get_hasErrors()){nd(kr("Controls.FilterPanel.FixErrorsMessage"),"",null);return}this.dialogClose()}},{text:kr("Dialogs.CancelButton"),click:()=>this.dialogClose()}]}};Ht=h([m.registerClass("Serenity.FilterDialog")],Ht);import{localText as Or,trimToNull as ad}from"@serenity-is/corelib/q";var Ut=class extends et{constructor(n){super(n),this.element.find(".cap").text(Or("Controls.FilterPanel.EffectiveFilter")),this.element.find(".edit").text(Or("Controls.FilterPanel.EditFilter")),this.element.find(".reset").attr("title",Or("Controls.FilterPanel.ResetFilterHint"));var e=t=>{t.preventDefault();var i=new Ht;i.get_filterPanel().set_store(this.get_store()),i.dialogOpen(null)};this.element.find(".edit").click(e),this.element.find(".txt").click(e),this.element.find(".reset").click(t=>{t.preventDefault(),this.get_store().get_items().length=0,this.get_store().raiseChanged()})}filterStoreChanged(){super.filterStoreChanged();var n=ad(this.get_store().get_displayText());this.element.find(".current").toggle(n!=null),this.element.find(".reset").toggle(n!=null),n==null&&(n=Or("Controls.FilterPanel.EffectiveEmpty")),this.element.find(".txt").text("["+n+"]")}getTemplate(){return"<div><a class='reset'></a><a class='edit'></a><div class='current'><span class='cap'></span><a class='txt'></a></div></div>"}};Ut=h([m.registerClass("Serenity.FilterDisplayBar")],Ut);import{htmlEncode as wr,extend as od,localText as _r}from"@serenity-is/corelib/q";var jt=class extends b{constructor(n,e){super(n,od({showRowsPerPage:!0,rowsPerPageOptions:[20,100,500,2e3]},e)),e=this.options;var t=e.view;if(!t)throw"SlickPager requires view option to be set!";this.element.addClass("s-SlickPager slick-pg").html('<div class="slick-pg-in"><div class="slick-pg-grp"><div class="slick-pg-first slick-pg-btn"><span class="slick-pg-btn-span"></span></div><div class="slick-pg-prev slick-pg-btn"><span class="slick-pg-btn-span"></span></div></div><div class="slick-pg-sep"></div><div class="slick-pg-grp"><span class="slick-pg-control">&nbsp;'+wr(_r("Controls.Pager.Page"))+'&nbsp;<input class="slick-pg-current" type="text" size="4" value="1" /> / <span class="slick-pg-total"> 1 </span></span></div><div class="slick-pg-sep"></div><div class="slick-pg-grp"><div class="slick-pg-next slick-pg-btn"><span class="slick-pg-btn-span"></span></div><div class="slick-pg-last slick-pg-btn"><span class="slick-pg-btn-span"></span></div></div><div class="slick-pg-sep"></div><div class="slick-pg-grp"><div class="slick-pg-reload slick-pg-btn"><span class="slick-pg-btn-span"></span></div></div><div class="slick-pg-sep"></div><div class="slick-pg-grp"><span class="slick-pg-stat"></span></div></div>');var i=this;if($(".slick-pg-reload",this.element).click(function(){t.populate()}),$(".slick-pg-first",this.element).click(function(){i._changePage("first")}),$(".slick-pg-prev",this.element).click(function(){i._changePage("prev")}),$(".slick-pg-next",this.element).click(function(){i._changePage("next")}),$(".slick-pg-last",this.element).click(function(){i._changePage("last")}),$(".slick-pg-current",this.element).keydown(function(l){l.keyCode==13&&i._changePage("input")}),i.options.showRowsPerPage){for(var r="",a="",o=0;o<e.rowsPerPageOptions.length;o++)t.rowsPerPage==e.rowsPerPageOptions[o]?a='selected="selected"':a="",r+="<option value='"+e.rowsPerPageOptions[o]+"' "+a+" >"+e.rowsPerPageOptions[o]+"&nbsp;&nbsp;</option>";$(".slick-pg-in",this.element).prepend('<div class="slick-pg-grp"><select class="slick-pg-size" name="rp">'+r+'</select></div><div class="slick-pg-sep"></div>'),$("select.slick-pg-size",this.element).change(function(){e.onRowsPerPageChange?e.onRowsPerPageChange(+this.value):(t.newp=1,t.setPagingOptions({page:1,rowsPerPage:+this.value}))})}t.onPagingInfoChanged.subscribe(function(){i._updatePager()})}_changePage(n){var e=this.options.view;if(!e||e.loading)return!0;var t=e.getPagingInfo(),i=!t.rowsPerPage||!t.totalCount?1:Math.ceil(t.totalCount/t.rowsPerPage),r;switch(n){case"first":r=1;break;case"prev":t.page>1&&(r=parseInt(t.page)-1);break;case"next":t.page<i&&(r=parseInt(t.page)+1);break;case"last":r=i;break;case"input":var a=parseInt($("input.slick-pg-current",this.element).val());isNaN(a)||a<1?a=1:a>i&&(a=i),$(".slick-pg-current",this.element).val(a),r=a;break}if(r==t.page)return!1;this.options.onChangePage?this.options.onChangePage(r):e.setPagingOptions({page:r})}_updatePager(){var n=this.options.view,e=n.getPagingInfo(),t=!e.rowsPerPage||!e.totalCount?1:Math.ceil(e.totalCount/e.rowsPerPage);$(".slick-pg-current",this.element).val(e.page),$(".slick-pg-total",this.element).html(t);var i=(e.page-1)*e.rowsPerPage+1,r=i+e.rowsPerPage-1;e.totalCount<r&&(r=e.totalCount);var a;e.loading?a=wr(_r("Controls.Pager.LoadingStatus")):e.error?a=e.error:e.totalCount>0?(a=wr(_r("Controls.Pager.PageStatus")),a=a.replace(/{from}/,i),a=a.replace(/{to}/,r),a=a.replace(/{total}/,e.totalCount)):a=wr(_r("Controls.Pager.NoRowStatus")),$(".slick-pg-stat",this.element).html(a),$(".slick-pg-size",this.element).val((e.rowsPerPage||0).toString())}};jt=h([m.registerClass("Serenity.SlickPager")],jt);import{Authorization as Td,clearKeys as ci,Culture as Wn,htmlEncode as Xt,isEmptyOrNull as Mn,replaceAll as qn,safeCast as Sd,serviceCall as kd,startsWith as Od,localText as Jn,tryGetText as $n}from"@serenity-is/corelib/q";import{Culture as Ln,Enum as Qn,format as Fr,formatDate as ld,formatNumber as dd,getAttributes as ud,getTypeFullName as pd,htmlEncode as we,isEmptyOrNull as ue,ISlickFormatter as An,parseDecimal as cd,parseISODateTime as hd,replaceAll as md,resolveUrl as Gn,safeCast as Bn,startsWith as gd,tryGetText as pi}from"@serenity-is/corelib/q";var rt=class{};rt=h([m.registerInterface("Serenity.IInitializeColumn")],rt);var Kt=class{format(n){var t,i;if(n.value==null)return"";var e;return n.value?(e=pi(this.trueText),e==null&&(e=this.trueText,e==null&&(e=(t=pi("Dialogs.YesButton"))!=null?t:"Yes"))):(e=pi(this.falseText),e==null&&(e=this.falseText,e==null&&(e=(i=pi("Dialogs.NoButton"))!=null?i:"No"))),we(e)}};h([m.option()],Kt.prototype,"falseText",2),h([m.option()],Kt.prototype,"trueText",2),Kt=h([m.registerFormatter("Serenity.BooleanFormatter")],Kt);var Pr=class{format(n){return'<span class="check-box no-float readonly slick-edit-preclick '+(n.value?" checked":"")+'"></span>'}};Pr=h([m.registerFormatter("Serenity.CheckboxFormatter")],Pr);var ye=class{constructor(){this.displayFormat=Ln.dateFormat}static format(n,e){if(n==null)return"";var t;if(n instanceof Date)t=n;else if(typeof n=="string"){if(t=hd(n),t==null)return we(n)}else return n.toString();return we(ld(t,e))}format(n){return ye.format(n.value,this.displayFormat)}};h([m.option()],ye.prototype,"displayFormat",2),ye=h([m.registerFormatter("Serenity.DateFormatter")],ye);var Dr=class extends ye{constructor(){super(),this.displayFormat=Ln.dateTimeFormat}};Dr=h([m.registerFormatter("Serenity.DateTimeFormatter")],Dr);var Oe=class{format(n){return Oe.format(Ue.get(this.enumKey),n.value)}static format(n,e){if(e==null)return"";var t=Qn.toString(n,e),i=ud(n,z,!1),r=i.length>0?i[0].value:pd(n);return Oe.getText(r,t)}static getText(n,e){var t;return ue(e)?"":we((t=pi("Enums."+n+"."+e))!=null?t:e)}static getName(n,e){return e==null?"":Qn.toString(n,e)}};h([m.option()],Oe.prototype,"enumKey",2),Oe=h([m.registerFormatter("Serenity.EnumFormatter")],Oe);var Le=class{format(n){var o,l;var e=Bn(n.value,String);if(ue(e))return"";var t=Le.dbFileUrl(e),i=ue(this.originalNameProperty)?null:Bn(n.item[this.originalNameProperty],String);i=i!=null?i:"";var r=Fr((o=this.displayFormat)!=null?o:"{0}",i,e,t),a=(l=this.iconClass)!=null?l:"fa fa-download";return a.startsWith("fa-")&&(a="fa "+a),"<a class='file-download-link' target='_blank' href='"+we(t)+"'><i class='"+a+"'></i> "+we(r)+"</a>"}static dbFileUrl(n){return n=md(n!=null?n:"","\\","/"),Gn("~/upload/")+n}initializeColumn(n){if(n.referencedFields=n.referencedFields||[],!ue(this.originalNameProperty)){n.referencedFields.push(this.originalNameProperty);return}}};h([m.option()],Le.prototype,"displayFormat",2),h([m.option()],Le.prototype,"originalNameProperty",2),h([m.option()],Le.prototype,"iconClass",2),Le=h([m.registerFormatter("Serenity.FileDownloadFormatter",[An,rt])],Le);var Yt=class{format(n){return Yt.format(n.value)}static format(n){var e=Math.floor(n/60),t=n-e*60,i,r;return n==null||isNaN(n)?"":(e<10?i="0"+e:i=e.toString(),t<10?r="0"+t:r=t.toString(),Fr("{0}:{1}",i,r))}};Yt=h([m.registerFormatter("Serenity.MinuteFormatter")],Yt);var Ae=class{format(n){return Ae.format(n.value,this.displayFormat)}static format(n,e){if(e=e!=null?e:"0.##",n==null)return"";if(typeof n=="number")return isNaN(n)?"":we(dd(n,e));var t=cd(n.toString());return t==null?"":we(n.toString())}};h([m.option()],Ae.prototype,"displayFormat",2),Ae=h([m.registerFormatter("Serenity.NumberFormatter")],Ae);var Be=class{format(n){var r,a,o,l;var e=ue(this.urlProperty)?((a=n.value)!=null?a:"").toString():((r=n.item[this.urlProperty])!=null?r:"").toString();if(ue(e))return"";ue(this.urlFormat)||(e=Fr(this.urlFormat,e)),e!=null&&gd(e,"~/")&&(e=Gn(e));var t=ue(this.displayProperty)?((l=n.value)!=null?l:"").toString():((o=n.item[this.displayProperty])!=null?o:"").toString();ue(this.displayFormat)||(t=Fr(this.displayFormat,t));var i="<a href='"+we(e)+"'";return ue(this.target)||(i+=" target='"+this.target+"'"),i+=">"+we(t)+"</a>",i}initializeColumn(n){if(n.referencedFields=n.referencedFields||[],!ue(this.displayProperty)){n.referencedFields.push(this.displayProperty);return}if(!ue(this.urlProperty)){n.referencedFields.push(this.urlProperty);return}}};h([m.option()],Be.prototype,"displayProperty",2),h([m.option()],Be.prototype,"displayFormat",2),h([m.option()],Be.prototype,"urlProperty",2),h([m.option()],Be.prototype,"urlFormat",2),h([m.option()],Be.prototype,"target",2),Be=h([m.registerFormatter("Serenity.UrlFormatter",[An,rt])],Be);import{ArgumentNullException as fd,Exception as yd,htmlEncode as vd,isAssignableFrom as bd,isEmptyOrNull as Cd,ISlickFormatter as xd,notifyError as Id}from"@serenity-is/corelib/q";var Er;(i=>{let d=He(r=>bd(xd,r),null,"Formatter");function n(r){if(Cd(r))throw new fd("key");var a=d.tryGet(r);if(a)return a;var o=`"${vd(r)}" formatter class not found! 
Make sure there is such a formatter type under the project root namespace,
and its namespace parts start with capital letters like MyProject.MyModule.MyFormatter.

If using ES modules, make sure the formatter type has a decorator like 
@Decorators.registerFormatter('MyProject.MyModule.MyFormatter') with the full name 
of your formatter type and "side-effect-import" this formatter class from the current 
"page.ts/grid.ts/dialog.ts file (import "./path/to/MyFormatter.ts").

After applying fixes, build and run "node ./tsbuild.js" (or "tsc" if using namespaces) 
from the project folder.`;throw Id(o.replace(/\r?\n\r?\n/g,"<br/><br/>"),"",{escapeHtml:!1,timeOut:5e3}),new yd(o)}i.get=n;function e(){d.reset()}i.reset=e;function t(r){return d.tryGet(r)}i.tryGet=t})(Er||(Er={}));var Rr=class{constructor(n,e){this.include={},this.grid=n,this.idField=n.getView().idField,this.options=e||{},n.getGrid().onClick.subscribe((t,i)=>{if($(t.target).hasClass("select-item")){t.preventDefault();var r=n.getView().getItem(i.row),a=r[this.idField].toString();this.include[a]?delete this.include[a]:this.include[a]=!0;for(var o=0;o<n.getView().getLength();o++)n.getGrid().updateRow(o);this.updateSelectAll()}}),n.getGrid().onHeaderClick.subscribe((t,i)=>{if(!t.isDefaultPrevented()&&$(t.target).hasClass("select-all-items")){if(t.preventDefault(),Object.keys(this.include).length>0)ci(this.include);else{var r=n.getView().getItems();for(var a of r.filter(this.isSelectable.bind(this))){var o=a[this.idField];this.include[o]=!0}}this.updateSelectAll(),n.getView().setItems(n.getView().getItems(),!0),setTimeout(this.updateSelectAll.bind(this),0)}}),n.getView().onRowsChanged.subscribe(()=>this.updateSelectAll())}updateSelectAll(){var n=this.grid.getElement().find(".select-all-header .slick-column-name .select-all-items");if(n){var e=Object.keys(this.include);n.toggleClass("checked",e.length>0&&this.grid.getView().getItems().filter(this.isSelectable.bind(this)).length<=e.length)}}clear(){ci(this.include),this.updateSelectAll()}resetCheckedAndRefresh(){this.include={},this.updateSelectAll(),this.grid.getView().populate()}selectKeys(n){for(var e of n)this.include[e]=!0;this.updateSelectAll()}getSelectedKeys(){return Object.keys(this.include)}getSelectedAsInt32(){return Object.keys(this.include).map(function(n){return parseInt(n,10)})}getSelectedAsInt64(){return Object.keys(this.include).map(function(n){return parseInt(n,10)})}setSelectedKeys(n){this.clear();for(var e of n)this.include[e]=!0;this.updateSelectAll()}isSelectable(n){return n&&(this.options.selectable==null||this.options.selectable(n))}static createSelectColumn(n){return{name:'<span class="select-all-items check-box no-float "></span>',nameIsHtml:!0,toolTip:" ",field:"__select__",width:27,minWidth:27,headerCssClass:"select-all-header",sortable:!1,format:function(e){var t=e.item,i=n();if(!i||!i.isSelectable(t))return"";var r=i.include[e.item[i.idField]];return'<span class="select-item check-box no-float '+(r?" checked":"")+'"></span>'}}}};Rr=h([m.registerClass("Serenity.GridRowSelectionMixin")],Rr);var Vr=class{constructor(n,e){this.include={},this.grid=n,this.idField=n.getView().idField,this.options=e||{},n.getGrid().onClick.subscribe((t,i)=>{if($(t.target).hasClass("rad-select-item")){t.preventDefault();var r=n.getView().getItem(i.row);if(!this.isSelectable(r))return;var a=r[this.idField].toString();this.include[a]==!0?ci(this.include):(ci(this.include),this.include[a]=!0);for(var o=0;o<n.getView().getLength();o++)n.getGrid().updateRow(o)}})}isSelectable(n){return n&&(this.options.selectable==null||this.options.selectable(n))}clear(){ci(this.include)}resetCheckedAndRefresh(){this.include={},this.grid.getView().populate()}getSelectedKey(){var n=Object.keys(this.include);return n!=null&&n.length>0?n[0]:null}getSelectedAsInt32(){var n=Object.keys(this.include).map(function(e){return parseInt(e,10)});return n!=null&&n.length>0?n[0]:null}getSelectedAsInt64(){var n=Object.keys(this.include).map(function(e){return parseInt(e,10)});return n!=null&&n.length>0?n[0]:null}setSelectedKey(n){this.clear(),this.include[n]=!0}static createSelectColumn(n){return{name:"",toolTip:" ",field:"__select__",width:27,minWidth:27,headerCssClass:"",sortable:!1,formatter:function(e,t,i,r,a){var o=n();if(!o||!o.isSelectable(a))return"";var l=o.include[a[o.idField]];return'<input type="radio" name="radio-selection-group" class="rad-select-item no-float" style="cursor: pointer;width: 13px; height:13px;" '+(l?" checked":"")+" /> "}}}};Vr=h([m.registerClass("GridRadioSelectionMixin")],Vr);var hi;(e=>{function d(t,i){var r=t.element.children(".s-Toolbar");if(r.length!==0){var a=r.getWidget(G).findButton("select-all-button"),o=t.getView().getItems();a.toggleClass("checked",o.length>0&&!o.some(function(l){return!i(l)}))}}e.update=d;function n(t,i,r,a,o,l){var u;return o==null&&(o=(u=$n("Controls.CheckTreeEditor.SelectAll"))!=null?u:"Select All"),{title:o,action:"select-all",cssClass:"select-all-button",onClick:function(){var c=t(),p=c.getView(),g=c.element.children(".s-Toolbar").getWidget(G).findButton("select-all-button"),f=!g.hasClass("checked");p.beginUpdate();try{for(var y of p.getItems())a(y,f),p.updateItem(i(y),y);l&&l()}finally{p.endUpdate()}g.toggleClass("checked",f)}}}e.define=n})(hi||(hi={}));var Tt;(a=>{function d(o,l,u,c,p){var g=$('<div><a href="#"></a></div>').addClass("s-ToggleButton").addClass(l).prependTo(o);g.children("a").click(function(f){f.preventDefault(),g.toggleClass("pressed");var y=g.hasClass("pressed");u&&u(y)}).attr("title",c!=null?c:""),p&&g.addClass("pressed")}a.addToggleButton=d;function n(o,l,u,c){var p=!1,g=l.onSubmit;l.onSubmit=function(f){return f.params.IncludeDeleted=p,g!=null?g(f):!0},u==null&&(u=Jn("Controls.EntityGrid.IncludeDeletedToggle")),d(o,"s-IncludeDeletedToggle",function(f){p=f,l.seekToPage=1,l.populate()},u,c),o.bind("remove",function(){l.onSubmit=null,g=null})}a.addIncludeDeletedToggle=n;function e(o,l,u,c){var p=l.onSubmit,g;l.onSubmit=function(y){var T;if(g){var v=g.get_value();v&&v.length>0?y.params.ContainsText=v:delete y.params.ContainsText;var C=(T=g.get_field())==null?void 0:T.name;C!=null&&C.length>0?y.params.ContainsField=C:delete y.params.ContainsField}return p!=null?p(y):!0};var f=null;g=t(o,(y,v,C)=>{c&&c(),l.seekToPage=1,f=C,l.populate()},u),l.onDataLoaded.subscribe(function(y,v){f!=null&&(f(l.getLength()>0),f=null)})}a.addQuickSearchInput=e;function t(o,l,u){var c=$('<div><input type="text"/></div>').addClass("s-QuickSearchBar").prependTo(o);return u!=null&&u.length>0&&c.addClass("has-quick-search-fields"),new ie(c.children(),{fields:u,onSearch:l})}a.addQuickSearchInputCustom=t;function i(o,l){var u=new Slick.RowMoveManager({cancelEditOnDrag:!0});u.onBeforeMoveRows.subscribe(function(c,p){for(var g=0;g<p.rows.length;g++)if(p.rows[g]===p.insertBefore||p.rows[g]===p.insertBefore-1)return c.stopPropagation(),!1;return!0}),u.onMoveRows.subscribe(function(c,p){l(p.rows,p.insertBefore);try{o.setSelectedRows([])}catch(g){}}),o.registerPlugin(u)}a.makeOrderable=i;function r(o,l,u,c,p){i(o.getGrid(),function(g,f){var w,k;if(g.length!==0){var y,v=f;v<0?y=1:f>=o.getGrid().getDataLength()?(y=(w=u(o.getGrid().getDataItem(o.getGrid().getDataLength()-1)))!=null?w:0,y===0?y=f+1:y=y+1):(y=(k=u(o.getGrid().getDataItem(f)))!=null?k:0,y===0&&(y=f+1));var C=0,T=null;T=function(){kd({service:c,request:p(l(o.getGrid().getDataItem(g[C])),y++),onSuccess:function(_){C++,C<g.length?T():o.getView().populate()}})},T()}})}a.makeOrderableWithUpdateRequest=r})(Tt||(Tt={}));var Nr;(e=>{function d(t){var i=[];if(t==null)return i;for(var r=0;r<t.length;r++)i.push(e.toSlickColumn(t[r]));return i}e.toSlickColumns=d;function n(t){var u,c;var i={field:t.name,sourceItem:t,cssClass:t.cssClass,headerCssClass:t.headerCssClass,sortable:t.sortable!==!1,sortOrder:(u=t.sortOrder)!=null?u:0,width:t.width!=null?t.width:80,minWidth:(c=t.minWidth)!=null?c:30,maxWidth:t.maxWidth==null||t.maxWidth===0?null:t.maxWidth,resizable:t.resizable==null||!!t.resizable};i.visible=t.visible!==!1&&t.filterOnly!==!0&&(t.readPermission==null||Td.hasPermission(t.readPermission));var r=$n(t.title);if(r==null&&(r=t.title),i.name=r,t.alignment!=null&&t.alignment.length>0&&(Mn(i.cssClass)?i.cssClass="align-"+t.alignment:i.cssClass+=" align-"+t.alignment),t.formatterType!=null&&t.formatterType.length>0){var a=Er.get(t.formatterType),o=new a;t.formatterParams!=null&&ne.set(o,t.formatterParams);var l=Sd(o,rt);l!=null&&l.initializeColumn(i),i.format=p=>o.format(p)}return i}e.toSlickColumn=n})(Nr||(Nr={}));var _e;(c=>{function d(p,g){return Oe.getText(p,g)}c.getEnumText=d;function n(p,g,f){return function(y){var E,j;var v=f(y),C=p(),T=(E=y.item._indent)!=null?E:0,w='<span class="s-TreeIndent" style="width:'+15*T+'px"></span>',k=g(y.item),_=C.getIdxById(k),x=C.getItemByIdx(_+1);if(x!=null){var I=(j=x._indent)!=null?j:0;if(I>T)return y.item._collapsed?w+'<span class="s-TreeToggle s-TreeExpand"></span>'+v:w+'<span class="s-TreeToggle s-TreeCollapse"></span>'+v}return w+'<span class="s-TreeToggle"></span>'+v}}c.treeToggle=n;function e(p){return p==null&&(p=Wn.dateFormat),function(g){return Xt(ye.format(g.value,p))}}c.date=e;function t(p){return p==null&&(p=Wn.dateTimeFormat),function(g){return Xt(ye.format(g.value,p))}}c.dateTime=t;function i(){return function(p){return'<span class="check-box no-float '+(p.value?" checked":"")+'"></span>'}}c.checkBox=i;function r(p){return function(g){return Ae.format(g.value,p)}}c.number=r;function a(p){return p.data("item-type")}c.getItemType=a;function o(p){var g=p.data("item-id");return g==null?null:g.toString()}c.getItemId=o;function l(p,g,f,y,v){return"<a"+(g!=null?' href="#'+qn(p,".","-")+"/"+g+'"':"")+' data-item-type="'+Xt(p)+'" data-item-id="'+Xt(g)+'" class="s-EditLink s-'+qn(p,".","-")+"Link"+(Mn(y)?"":" "+y)+'">'+(v?Xt(f!=null?f:""):f!=null?f:"")+"</a>"}c.itemLinkText=l;function u(p,g,f,y,v){return function(C){var w,k;var T=(w=f==null?C.value:f(C))!=null?w:"";return(k=C.item)!=null&&k.__nonDataRow?v?Xt(T):T:l(p,C.item[g],f==null?C.value:f(C),y==null?"":y(C),v)}}c.itemLink=u})(_e||(_e={}));var Qr;(n=>{function d(e,t){for(var i of e){i.sortable=i.sortable!=null?i.sortable:!0;var r=i.id;if(r==null&&(r=i.field),i.id=r,t!=null&&i.id!=null&&(i.name==null||Od(i.name,"~"))){var a=i.name!=null?i.name.substr(1):i.id;i.name=Jn(t+a)}}return e}n.setDefaults=d})(Qr||(Qr={}));var re;(a=>{function d(o,l){for(var u=l(o),c=0;u!=null;){if(u._collapsed)return!1;if(u=l(u),c++>1e3)throw new Error("Possible infinite loop, check parents has no circular reference!")}return!0}a.filterCustom=d;function n(o,l,u){return d(o,function(c){var p=u(c);return p==null?null:l.getItemById(p)})}a.filterById=n;function e(o,l){if(o!=null)for(var u of o)u._collapsed=l}a.setCollapsed=e;function t(o,l){o._collapsed=l}a.setCollapsedFlag=t;function i(o,l,u,c){for(var p=0,g={},f=0;f<o.length;f++){var y=o[f];if(f>0){var v=u(y);v!=null&&v===l(o[f-1])?p+=1:v==null?p=0:v!==u(o[f-1])&&(g[v]!=null?p=g[v]+1:p=0)}g[l(y)]=p,y._indent=p,c!=null&&(y._collapsed=c)}}a.setIndents=i;function r(o,l,u,c,p){var g=$(o.target);if(g.hasClass("s-TreeToggle")&&(g.hasClass("s-TreeCollapse")||g.hasClass("s-TreeExpand"))){var f=c.getItem(l);if(f!=null&&(f._collapsed?f._collapsed=!1:f._collapsed=!0,c.updateItem(p(f),f)),o.shiftKey){c.beginUpdate();try{e(c.getItems(),!!f._collapsed),c.setItems(c.getItems(),!0)}finally{c.endUpdate()}}}}a.toggleClick=r})(re||(re={}));import{Authorization as gs,Criteria as wd,debounce as _d,deepClone as Pd,endsWith as fs,extend as Dd,getAttributes as Fd,getColumnsData as Ed,getColumnsDataAsync as Rd,getInstanceType as zn,getTypeFullName as Vd,htmlEncode as Nd,indexOf as Qd,isEmptyOrNull as U,isInstanceOfType as Bd,layoutFillHeight as Ld,LayoutTimer as ys,ScriptData as Ad,setEquality as Gd,startsWith as Wd,trimEnd as qd,trimToNull as Md,tryGetText as Br}from"@serenity-is/corelib/q";import{RemoteView as Jd}from"@serenity-is/corelib/slick";import{AutoTooltips as $d,Grid as zd}from"@serenity-is/sleekgrid";var Q=class extends b{constructor(e,t){super(e,t);this.restoringSettings=0;var i=this;this.element.addClass("s-DataGrid").html("");var r=function(){i.layout(),i._layoutTimer!=null&&ys.store(i._layoutTimer)};this.element.addClass("require-layout").on("layout."+this.uniqueName,r),this.useLayoutTimer()&&(this._layoutTimer=ys.onSizeChange(()=>this.element&&this.element[0],_d(r,50))),this.setTitle(this.getInitialTitle());var a=this.getButtons();a!=null&&this.createToolbar(a),this.slickContainer=this.createSlickContainer(),this.view=this.createView(),this.useAsync()?this.initAsync():this.initSync()}internalInit(){var e;this.allColumns=(e=this.allColumns)!=null?e:this.getColumns(),this.slickGrid=this.createSlickGrid(),this.enableFiltering()&&this.createFilterBar(),this.usePager()&&this.createPager(),this.bindToSlickEvents(),this.bindToViewEvents(),this.toolbar&&this.createToolbarExtensions(),this.createQuickFilters(),this.updateDisabledState(),this.updateInterface(),this.initialSettings=this.getCurrentSettings(null),this.restoreSettings(null,null),window.setTimeout(()=>this.initialPopulate(),0)}initSync(){this.propertyItemsData=this.getPropertyItemsData(),this.internalInit(),this.afterInit()}initAsync(){return Pe(this,null,function*(){this.propertyItemsData=yield this.getPropertyItemsDataAsync(),this.internalInit(),this.afterInit()})}afterInit(){}useAsync(){return!1}useLayoutTimer(){return!0}attrs(e){return Fd(zn(this),e,!0)}layout(){if(!(!this.element||!this.element.is(":visible")||!this.slickContainer||!this.slickGrid)){var e=this.element.hasClass("responsive-height"),t=this.slickGrid!=null&&this.slickGrid.getOptions().autoHeight,i=e&&window.innerWidth<768;i?(this.element[0]&&this.element[0].style.height!="auto"&&(this.element[0].style.height="auto"),t||(this.slickContainer.css("height","auto").children(".slick-pane").each((r,a)=>{a.style.height!=null&&a.style.height!="auto"&&(a.style.height="auto")}),this.slickGrid.setOptions({autoHeight:!0}))):(t&&(this.slickContainer.children(".slick-viewport").css("height","auto"),this.slickGrid.setOptions({autoHeight:!1})),Ld(this.slickContainer)),this.slickGrid.resizeCanvas()}}getInitialTitle(){return null}createToolbarExtensions(){}ensureQuickFilterBar(){return this.quickFiltersDiv==null&&this.createQuickFilters([]),this.quickFiltersBar}createQuickFilters(e){this.quickFiltersDiv==null&&(e!=null||(e=this.getQuickFilters())&&e!=null&&e.length)&&(this.quickFiltersDiv=$("<div/>").addClass("quick-filters-bar"),this.toolbar?($("<div/>").addClass("clear").appendTo(this.toolbar.element),this.quickFiltersDiv.appendTo(this.toolbar.element)):this.quickFiltersDiv.appendTo($("<div/>").addClass("s-Toolbar").insertBefore(this.slickContainer)),this.quickFiltersBar=new W(this.quickFiltersDiv,{filters:e,getTitle:t=>this.determineText(i=>i+t.field),idPrefix:this.uniqueName+"_QuickFilter_"}),this.quickFiltersBar.onChange=t=>this.quickFilterChange(t))}getQuickFilters(){return this.allColumns.filter(function(e){return e.sourceItem&&e.sourceItem.quickFilter===!0&&(e.sourceItem.readPermission==null||gs.hasPermission(e.sourceItem.readPermission))}).map(e=>Q.propertyItemToQuickFilter(e.sourceItem)).filter(e=>e!=null)}static propertyItemToQuickFilter(e){var g,f;var t={},i=e.name,r=Br(e.title);r==null&&(r=e.title,r==null&&(r=i));var a=$t.get((g=e.filteringType)!=null?g:"String");if(a===qt)t=W.dateRange(i,r);else if(a===Jt)t=W.dateTimeRange(i,r,(f=e.editorParams)==null?void 0:f.useUtc);else if(a===Mt){var o=e.quickFilterParams||{},l=e.filteringParams||{},u=o.trueText;u==null&&(u=l.trueText);var c=o.falseText;c==null&&(c=l.falseText),t=W.boolean(i,r,u,c)}else{var p=new a;if(p&&Bd(p,xt))ne.set(p,e.filteringParams),p.set_field(e),p.set_operator({key:O.EQ}),p.initQuickFilter(t),t.options=Dd(Pd(t.options),e.quickFilterParams);else return null}return e.quickFilterSeparator&&(t.separator=!0),t.cssClass=e.quickFilterCssClass,t}findQuickFilter(e,t){return this.quickFiltersBar!=null?this.quickFiltersBar.find(e,t):$("#"+this.uniqueName+"_QuickFilter_"+t).getWidget(e)}tryFindQuickFilter(e,t){if(this.quickFiltersBar!=null)return this.quickFiltersBar.tryFind(e,t);var i=$("#"+this.uniqueName+"_QuickFilter_"+t);return i.length?i.tryGetWidget(e):null}createIncludeDeletedButton(){(!U(this.getIsActiveProperty())||!U(this.getIsDeletedProperty()))&&Tt.addIncludeDeletedToggle(this.toolbar.element,this.view,null,!1)}getQuickSearchFields(){return null}createQuickSearchInput(){Tt.addQuickSearchInput(this.toolbar.element,this.view,this.getQuickSearchFields(),()=>this.persistSettings(null))}destroy(){this._layoutTimer&&(this._layoutTimer=ys.off(this._layoutTimer)),this.quickFiltersBar&&(this.quickFiltersBar.destroy(),this.quickFiltersBar=null),this.toolbar&&(this.toolbar.destroy(),this.toolbar=null),this.slickGrid&&(this.slickGrid.onClick.clear(),this.slickGrid.onSort.clear(),this.slickGrid.onColumnsResized.clear(),this.slickGrid.onColumnsReordered.clear(),this.slickGrid.destroy(),this.slickGrid=null),this.view&&(this.view.onDataChanged.clear(),this.view.onSubmit=null,this.view.setFilter(null),this.view=null),this.titleDiv=null,super.destroy()}getItemCssClass(e,t){var i=this.getIsActiveProperty(),r=this.getIsDeletedProperty();if(U(i)&&U(r))return null;if(i){var a=e[i];if(a==null)return null;if(typeof a=="number"){if(a<0)return"deleted";if(a===0)return"inactive"}else if(typeof a=="boolean"&&a===!1)return"deleted"}else return e[r]?"deleted":null;return null}getItemMetadata(e,t){var i=this.getItemCssClass(e,t);return U(i)?new Object:{cssClasses:i}}postProcessColumns(e){Qr.setDefaults(e,this.getLocalTextDbPrefix());var t=this.getColumnWidthDelta(),i=this.getColumnWidthScale();if(i<0&&(i=1),t!==0||i!==1)for(var r of e)typeof r.width=="number"&&(r.width=Math.round(r.width*i+t)),typeof r.minWidth=="number"&&(r.minWidth=Math.round(r.minWidth*i+t)),typeof r.maxWidth=="number"&&(r.maxWidth=Math.round(r.maxWidth*i+t));return e}getColumnWidthDelta(){var e;return(e=Q.defaultColumnWidthDelta)!=null?e:0}getColumnWidthScale(){var e;return(e=Q.defaultColumnWidthScale)!=null?e:1}initialPopulate(){var e=this;this.populateWhenVisible()?(Ce.executeEverytimeWhenShown(this.element,function(){e.refreshIfNeeded()},!1),this.element.is(":visible")&&this.view&&this.view.populate()):this.view&&this.view.populate()}canFilterColumn(e){return e.sourceItem!=null&&e.sourceItem.notFilterable!==!0&&(e.sourceItem.readPermission==null||gs.hasPermission(e.sourceItem.readPermission))}initializeFilterBar(){this.filterBar.set_store(new le(this.allColumns.filter(e=>this.canFilterColumn(e)).map(e=>e.sourceItem))),this.filterBar.get_store().add_changed((e,t)=>{this.restoringSettings<=0&&(this.persistSettings(null),this.view&&(this.view.seekToPage=1),this.refresh())})}createSlickGrid(){var e=this.postProcessColumns(this.allColumns).filter(function(r){return r.visible!==!1}),t=this.getSlickOptions(),i=new zd(this.slickContainer,this.view,e,t);return i.registerPlugin(new $d({enableForHeaderCells:!0})),this.slickGrid=i,this.setInitialSortOrder(),i}setInitialSortOrder(){var e=this.getDefaultSortBy();this.view&&(this.view.sortBy=Array.prototype.slice.call(e));var t=e.map(function(i){var r;return i&&fs(i.toLowerCase()," desc")?{columnId:qd(i.substr(0,i.length-5)),sortAsc:!1}:{columnId:i,sortAsc:!0}});this.slickGrid.setSortColumns(t)}itemAt(e){return this.slickGrid.getDataItem(e)}rowCount(){return this.slickGrid.getDataLength()}getItems(){return this.view.getItems()}setItems(e){this.view.setItems(e,!0)}bindToSlickEvents(){var e=this;this._slickGridOnSort=(t,i)=>{e.view.populateLock();try{var r=[],a;if(i.multiColumnSort)for(var o=0;o<i.sortCols.length;o++){var l=i.sortCols[o];a=l.sortCol,a==null&&(a={}),r.push(a.field+(l.sortAsc?"":" DESC"))}else{var a=i.sortCol;a==null&&(a={}),r.push(a.field+(i.sortAsc?"":" DESC"))}e.view.seekToPage=1,e.view.sortBy=r}finally{e.view.populateUnlock()}e.view.getLocalSort&&e.view.getLocalSort()?e.view.sort():e.view.populate(),this.persistSettings(null)},this.slickGrid.onSort.subscribe(this._slickGridOnSort),this._slickGridOnClick=(t,i)=>{e.onClick(t,i.row,i.cell)},this.slickGrid.onClick.subscribe(this._slickGridOnClick),this.slickGrid.onColumnsReordered.subscribe((t,i)=>this.persistSettings(null)),this.slickGrid.onColumnsResized.subscribe((t,i)=>this.persistSettings(null))}getAddButtonCaption(){var e;return(e=Br("Controls.DataGrid.NewButton"))!=null?e:"New"}getButtons(){return[]}editItem(e){throw new Error("Not Implemented!")}editItemOfType(e,t){if(e===this.getItemType()){this.editItem(t);return}throw new Error("Not Implemented!")}onClick(e,t,i){if(!e.isDefaultPrevented()){var r=$(e.target);r.hasClass("s-EditLink")||(r=r.closest("a")),r.hasClass("s-EditLink")&&(e.preventDefault(),this.editItemOfType(_e.getItemType(r),_e.getItemId(r)))}}viewDataChanged(e,t){this.markupReady(),this.layout()}bindToViewEvents(){var e=this;this.view.onDataChanged.subscribe(function(t,i){return e.viewDataChanged(t,i)}),this.view.onSubmit=function(t){return e.onViewSubmit()},this.view.setFilter(function(t,i){return e.onViewFilter(t)}),this.view.onProcessData=function(t,i){return e.onViewProcessData(t)}}onViewProcessData(e){return e}onViewFilter(e){return!0}getIncludeColumns(e){var t=this.slickGrid.getColumns();for(var i of t)if(i.field&&(e[i.field]=!0),i.referencedFields)for(var r of i.referencedFields)e[r]=!0}setCriteriaParameter(){if(delete this.view.params.Criteria,this.filterBar){var e=this.filterBar.get_store().get_activeCriteria();wd.isEmpty(e)||(this.view.params.Criteria=e)}}setEquality(e,t){Gd(this.view.params,e,t)}setIncludeColumnsParameter(){var e={};this.getIncludeColumns(e);var t=[];for(var i of Object.keys(e))t.push(i);this.view.params.IncludeColumns=t}onViewSubmit(){return this._isDisabled||!this.getGridCanLoad()?!1:(this.setCriteriaParameter(),this.setIncludeColumnsParameter(),this.invokeSubmitHandlers(),!0)}markupReady(){}createSlickContainer(){return $('<div class="grid-container"></div>').appendTo(this.element)}createView(){var e=this.getViewOptions();return new Jd(e)}getDefaultSortBy(){if(this.slickGrid){var e=this.slickGrid.getColumns().filter(function(a){return a.sortOrder&&a.sortOrder!==0});if(e.length>0){e.sort(function(a,o){return Math.abs(a.sortOrder)<Math.abs(o.sortOrder)?-1:Math.abs(a.sortOrder)>Math.abs(o.sortOrder)?1:0});for(var t=[],i=0;i<e.length;i++){var r=e[i];t.push(r.field+(r.sortOrder<0?" DESC":""))}return t}}return[]}usePager(){return!1}enableFiltering(){var e=this.attrs(ot);return e.length>0&&e[0].value}populateWhenVisible(){return!1}createFilterBar(){var e=$("<div/>").appendTo(this.element);this.filterBar=new Ut(e),this.initializeFilterBar()}getPagerOptions(){return{view:this.view,rowsPerPage:20,rowsPerPageOptions:[20,100,500,2500]}}createPager(){var e=$("<div></div>").appendTo(this.element);new jt(e,this.getPagerOptions())}getViewOptions(){var e={};return e.idField=this.getIdProperty(),e.sortBy=this.getDefaultSortBy(),this.usePager()?this.element.hasClass("responsive-height")?e.rowsPerPage=$(window.window).width()<768?20:100:e.rowsPerPage=100:e.rowsPerPage=0,e.getItemMetadata=(t,i)=>this.getItemMetadata(t,i),e}createToolbar(e){var t=$('<div class="grid-toolbar"></div>').appendTo(this.element);this.toolbar=new G(t,{buttons:e,hotkeyContext:this.element[0]})}getTitle(){return this.titleDiv?this.titleDiv.children(".title-text").text():null}setTitle(e){e!==this.getTitle()&&(e==null?this.titleDiv&&(this.titleDiv.remove(),this.titleDiv=null):(this.titleDiv||(this.titleDiv=$('<div class="grid-title"><div class="title-text"></div></div>').prependTo(this.element)),this.titleDiv.children(".title-text").text(e)),this.layout())}getItemType(){return"Item"}itemLink(e,t,i,r,a=!0){return e==null&&(e=this.getItemType()),t==null&&(t=this.getIdProperty()),_e.itemLink(e,t,i,r,a)}getColumnsKey(){var e=this.attrs(Ot);return e&&e.length>0?e[0].value:null}getPropertyItems(){var e;return((e=this.propertyItemsData)==null?void 0:e.items)||[]}getPropertyItemsData(){var e=this.getColumnsKey();return this.getColumnsKey===Q.prototype.getColumnsKey&&this.getPropertyItems!==Q.prototype.getPropertyItems&&!Ad.canLoad("Columns."+e)?{items:this.getPropertyItems(),additionalItems:[]}:U(e)?{items:[],additionalItems:[]}:Ed(e)}getPropertyItemsDataAsync(){return Pe(this,null,function*(){var e=this.getColumnsKey();return U(e)?{items:[],additionalItems:[]}:yield Rd(e)})}getColumns(){return this.propertyItemsToSlickColumns(this.getPropertyItems())}propertyItemsToSlickColumns(e){for(var t=Nr.toSlickColumns(e),i=0;i<e.length;i++){var r=e[i],a=t[i];if(r.editLink===!0){var o={$:a.format},l={$:r.editLinkCssClass!=null?r.editLinkCssClass:null};a.format=this.itemLink(r.editLinkItemType!=null?r.editLinkItemType:null,r.editLinkIdField!=null?r.editLinkIdField:null,function(u){return this.oldFormat.$!=null?this.oldFormat.$(u):Nd(u.value)}.bind({oldFormat:o}),function(u){var c;return(c=this.css.$)!=null?c:""}.bind({css:l}),!1),U(r.editLinkIdField)||(a.referencedFields=a.referencedFields||[],a.referencedFields.push(r.editLinkIdField))}}return t}getSlickOptions(){var e={};return e.multiSelect=!1,e.multiColumnSort=!0,e.enableCellNavigation=!1,Q.defaultHeaderHeight&&(e.headerRowHeight=Q.defaultHeaderHeight),Q.defaultRowHeight&&(e.rowHeight=Q.defaultRowHeight),e}populateLock(){this.view.populateLock()}populateUnlock(){this.view.populateUnlock()}getGridCanLoad(){return!0}refresh(){if(!this.populateWhenVisible()){this.internalRefresh();return}if(this.slickContainer.is(":visible")){this.slickContainer.data("needsRefresh",!1),this.internalRefresh();return}this.slickContainer.data("needsRefresh",!0)}refreshIfNeeded(){this.slickContainer.data("needsRefresh")&&(this.slickContainer.data("needsRefresh",!1),this.internalRefresh())}internalRefresh(){this.view.populate()}setIsDisabled(e){this._isDisabled!==e&&(this._isDisabled=e,this._isDisabled&&this.view.setItems([],!0),this.updateDisabledState())}get readOnly(){return this.get_readOnly()}set readOnly(e){this.set_readOnly(e)}get_readOnly(){return!!this._readonly}set_readOnly(e){!!this._readonly!=!!e&&(this._readonly=!!e,this.updateInterface())}updateInterface(){this.toolbar&&this.toolbar.updateInterface()}getRowDefinition(){return null}getLocalTextDbPrefix(){var e;return this._localTextDbPrefix!=null?this._localTextDbPrefix:(this._localTextDbPrefix=(e=this.getLocalTextPrefix())!=null?e:"",this._localTextDbPrefix.length>0&&!fs(this._localTextDbPrefix,".")&&(this._localTextDbPrefix="Db."+this._localTextDbPrefix+"."),this._localTextDbPrefix)}getLocalTextPrefix(){var e=this.getRowDefinition();if(e)return e.localTextPrefix;var t=this.attrs($e);if(t.length>=1)return t[0].value}getIdProperty(){var i,r;if(this._idProperty!=null)return this._idProperty;var e=this.getRowDefinition();if(e)return this._idProperty=(i=e.idProperty)!=null?i:"";var t=this.attrs(Me);return t.length===1?this._idProperty=(r=t[0].value)!=null?r:"":this._idProperty="ID"}getIsDeletedProperty(){var e;return(e=this.getRowDefinition())==null?void 0:e.isDeletedProperty}getIsActiveProperty(){var i,r;if(this._isActiveProperty!=null)return this._isActiveProperty;var e=this.getRowDefinition();if(e)return this._isActiveProperty=(i=e.isActiveProperty)!=null?i:"";var t=this.attrs(Je);return t.length===1?this._isActiveProperty=(r=t[0].value)!=null?r:"":this._isActiveProperty=""}updateDisabledState(){this.slickContainer.toggleClass("ui-state-disabled",!!this._isDisabled)}resizeCanvas(){var e;(e=this.slickGrid)==null||e.resizeCanvas()}subDialogDataChange(){this.refresh()}addFilterSeparator(){this.ensureQuickFilterBar().addSeparator()}determineText(e){var t=this.getLocalTextDbPrefix();if(!U(t)){var i=Br(e(t));if(i!=null)return i}return null}addQuickFilter(e){return this.ensureQuickFilterBar().add(e)}addDateRangeFilter(e,t){return this.ensureQuickFilterBar().addDateRange(e,t)}dateRangeQuickFilter(e,t){return W.dateRange(e,t)}addDateTimeRangeFilter(e,t){return this.ensureQuickFilterBar().addDateTimeRange(e,t)}dateTimeRangeQuickFilter(e,t){return W.dateTimeRange(e,t)}addBooleanFilter(e,t,i,r){return this.ensureQuickFilterBar().addBoolean(e,t,i,r)}booleanQuickFilter(e,t,i,r){return W.boolean(e,t,i,r)}invokeSubmitHandlers(){this.quickFiltersBar!=null&&this.quickFiltersBar.onSubmit(this.view.params)}quickFilterChange(e){this.persistSettings(null),this.view&&(this.view.seekToPage=1),this.refresh()}getPersistanceStorage(){return Q.defaultPersistanceStorage}getPersistanceKey(){var e="GridSettings:",t=window.location.pathname;return U(t)||(e+=t.substr(1).split(String.fromCharCode(47)).slice(0,2).join("/")+":"),e+=Vd(zn(this)),e}gridPersistanceFlags(){return{}}canShowColumn(e){if(e==null)return!1;var t=e.sourceItem;return t==null?!0:t.filterOnly===!0?!1:t.readPermission==null?!0:gs.hasPermission(t.readPermission)}getPersistedSettings(){var e=this.getPersistanceStorage();if(e==null)return null;var t=Md(e.getItem(this.getPersistanceKey()));return t!=null&&Wd(t,"{")&&fs(t,"}")?JSON.parse(t):null}restoreSettings(e,t){if(this.slickGrid&&!(e==null&&(e=this.getPersistedSettings(),e==null))){var i=this.slickGrid.getColumns(),r=null,a=function(K){r={};for(var pe=0;pe<K.length;pe++){var kt=K[pe];r[kt.id]=kt}};this.view.beginUpdate(),this.restoringSettings++;try{if(t=t||this.gridPersistanceFlags(),e.columns!=null){if(t.columnVisibility!==!1){var o={};a(this.allColumns);for(var l=[],u=0;u<e.columns.length;u++){var c=e.columns[u];if(c.id!=null&&c.visible===!0){var p=r[c.id];this.canShowColumn(p)&&(p.visible=!0,l.push(p),delete r[c.id])}}for(var g=0;g<this.allColumns.length;g++){var f=this.allColumns[g];r[f.id]!=null&&(f.visible=!1,l.push(f))}this.allColumns=l,i=this.allColumns.filter(function(K){return K.visible===!0})}if(t.columnWidths!==!1){a(i);for(var y=0;y<e.columns.length;y++){var v=e.columns[y];if(v.id!=null&&v.width!=null&&v.width!==0){var C=r[v.id];C!=null&&(C.width=v.width)}}}if(t.sortColumns!==!1){a(i);var T=[],w=e.columns.filter(function(K){var pe;return K.id!=null&&((pe=K.sort)!=null?pe:0)!==0});w.sort(function(K,pe){return Math.abs(K.sort)-Math.abs(pe.sort)});for(var k=0;k<w.length;k++){var _=w[k],x=r[_.id];x!=null&&T.push({columnId:_.id,sortAsc:_.sort>0})}this.view.sortBy=T.map(function(K){return K.columnId+(K.sortAsc===!1?" DESC":"")}),this.slickGrid.setSortColumns(T)}this.slickGrid.setColumns(i),this.slickGrid.invalidate()}if(e.filterItems!=null&&t.filterItems!==!1&&this.filterBar!=null&&this.filterBar.get_store()!=null){var I=this.filterBar.get_store().get_items();I.length=0,I.push.apply(I,e.filterItems),this.filterBar.get_store().raiseChanged()}if(e.includeDeleted!=null&&t.includeDeleted!==!1){var E=this.element.find(".s-IncludeDeletedToggle");!!e.includeDeleted!==E.hasClass("pressed")&&E.children("a").click()}if(e.quickFilters!=null&&t.quickFilters!==!1&&this.quickFiltersDiv!=null&&this.quickFiltersDiv.length>0&&this.quickFiltersDiv.find(".quick-filter-item").each((K,pe)=>{var kt=$(pe).data("qffield");if(!U(kt)){var Ur=$("#"+this.uniqueName+"_QuickFilter_"+kt).tryGetWidget(b);if(Ur!=null){var Os=e.quickFilters[kt],ws=$(pe).data("qfloadstate");ws!=null?ws(Ur,Os):S.setValue(Ur,Os)}}}),t.quickSearch===!0&&(e.quickSearchField!==void 0||e.quickSearchText!==void 0)){var j=this.toolbar.element.find(".s-QuickSearchInput").first();if(j.length>0){var ks=j.tryGetWidget(ie);ks&&ks.restoreState(e.quickSearchText,e.quickSearchField)}}}finally{this.restoringSettings--,this.view.endUpdate()}}}persistSettings(e){var t=this.getPersistanceStorage();if(t){var i=this.getCurrentSettings(e);t.setItem(this.getPersistanceKey(),JSON.stringify(i))}}getCurrentSettings(e){e=e||this.gridPersistanceFlags();var t={};if(e.columnVisibility!==!1||e.columnWidths!==!1||e.sortColumns!==!1){t.columns=[];var i=this.slickGrid.getSortColumns(),r=this.slickGrid.getColumns();for(var a of r){var o={id:a.id};if(e.columnVisibility!==!1&&(o.visible=!0),e.columnWidths!==!1&&(o.width=a.width),e.sortColumns!==!1){var l=Qd(i,p=>p.columnId==a.id);o.sort=l>=0?i[l].sortAsc!==!1?l+1:-l-1:0}t.columns.push(o)}}if(e.includeDeleted!==!1&&(t.includeDeleted=this.element.find(".s-IncludeDeletedToggle").hasClass("pressed")),e.filterItems!==!1&&this.filterBar!=null&&this.filterBar.get_store()!=null&&(t.filterItems=this.filterBar.get_store().get_items().slice()),e.quickSearch===!0){var u=this.toolbar.element.find(".s-QuickSearchInput").first();if(u.length>0){var c=u.tryGetWidget(ie);c!=null&&(t.quickSearchField=c.get_field(),t.quickSearchText=c.element.val())}}return e.quickFilters!==!1&&this.quickFiltersDiv!=null&&this.quickFiltersDiv.length>0&&(t.quickFilters={},this.quickFiltersDiv.find(".quick-filter-item").each((p,g)=>{var _;var f=$(g).data("qffield");if(!U(f)){var y=$("#"+this.uniqueName+"_QuickFilter_"+f).tryGetWidget(b);if(y!=null){var v=$(g).data("qfsavestate"),C=v!=null?v(y):S.getValue(y);if(t.quickFilters[f]=C,e.quickFilterText===!0&&$(g).hasClass("quick-filter-active")){var T=$(g).data("qfdisplaytext"),w=$(g).find(".quick-filter-label").text(),k;T!=null?k=T(y,w):k=w+" = "+S.getDisplayText(y),U(k)||(U(t.quickFilterText)?t.quickFilterText=k:(t.quickFilterText+=" "+((_=Br("Controls.FilterPanel.And"))!=null?_:"and")+" ",t.quickFilterText+=k))}}}})),t}getElement(){return this.element}getGrid(){return this.slickGrid}getView(){return this.view}getFilterStore(){return this.filterBar==null?null:this.filterBar.get_store()}};Q=h([m.registerClass("Serenity.DataGrid",[R]),m.element("<div/>")],Q);import{Authorization as Hd,centerDialog as Ud,Culture as jd,htmlEncode as mi,Router as vs,localText as Ge,trimToNull as Kd}from"@serenity-is/corelib/q";var st=class extends N{constructor(){super();new ie(this.byId("Search"),{onSearch:(e,t,i)=>{t=Kd(t),t!=null&&(t=Select2.util.stripDiacritics(t.toLowerCase())),this.element.find("li").each((r,a)=>{$(a).toggle(!t||Select2.util.stripDiacritics($(a).text().toLowerCase()).indexOf(t)>=0)}),i&&i(!0)}}),this.ulVisible=this.byId("VisibleCols"),this.ulHidden=this.byId("HiddenCols"),this.dialogTitle=Ge("Controls.ColumnPickerDialog.Title")}static createToolButton(e){function t(){var i=new st;if(i.allColumns=e.allColumns,e.initialSettings){var r=e.initialSettings;r.columns&&r.columns.length&&(i.defaultColumns=r.columns.map(a=>a.id))}i.visibleColumns=e.getGrid().getColumns().map(a=>a.id),i.done=()=>{e.allColumns=i.allColumns;var a=i.allColumns.filter(o=>o.visible===!0);e.getGrid().setColumns(a),e.persistSettings(),e.getView().populate()},vs&&vs.dialog&&vs.dialog(e.element,i.element,()=>"columns"),i.dialogOpen()}return e.element.on("handleroute."+e.uniqueName,(i,r)=>{r&&!r.handled&&r.route=="columns"&&t()}),{hint:Ge("Controls.ColumnPickerDialog.Title"),action:"column-picker",cssClass:"column-picker-button",icon:"fa-th-list text-blue",onClick:t}}getDialogButtons(){return[{text:Ge("Controls.ColumnPickerDialog.RestoreDefaults"),click:()=>{let e={};this.ulVisible.children().add(this.ulHidden.children()).each((i,r)=>{let a=$(r);e[a.data("key")]=a});let t=null;for(let i of this.defaultColumns){let r=e[i];if(!r)continue;t==null?r.prependTo(this.ulVisible):r.insertAfter(t),t=r;let a=r.data("key");delete e[a]}for(let i in e)e[i].appendTo(this.ulHidden);this.updateListStates()}},{text:Ge("Dialogs.OkButton"),click:()=>{let e=[];for(var t of this.allColumns)t.visible=!1;this.visibleColumns=this.ulVisible.children().toArray().map(i=>{let r=$(i).data("key");var a=this.colById[r];return a.visible=!0,e.push(a),r});for(var t of this.allColumns)t.visible||e.push(t);this.allColumns=e,this.done&&this.done(),this.dialogClose()}},{text:Ge("Dialogs.CancelButton"),click:()=>{this.dialogClose()}}]}getDialogOptions(){var e=super.getDialogOptions();return e.width=600,e}getTitle(e){return e.id=="__select__"?"[x]":e.name||e.toolTip||e.id}allowHide(e){return e.sourceItem==null||e.sourceItem.allowHide==null||e.sourceItem.allowHide}createLI(e){var t=this.allowHide(e);return $(`
<li data-key="${e.id}" class="${t?"":"cant-hide"}">
<span class="drag-handle">\u2630</span>
${mi(this.getTitle(e))}
${t?`<i class="js-hide fa fa-eye-slash" title="${mi(Ge("Controls.ColumnPickerDialog.HideHint"))}"></i>`:""}
<i class="js-show fa fa-eye" title="${mi(Ge("Controls.ColumnPickerDialog.ShowHint"))}"></i>
</li>`)}updateListStates(){this.ulVisible.children().removeClass("bg-info").addClass("bg-success"),this.ulHidden.children().removeClass("bg-success").addClass("bg-info")}setupColumns(){this.allColumns=this.allColumns||[],this.visibleColumns=this.visibleColumns||[];let e={};for(let a of this.visibleColumns)e[a]=!0;this.colById={};for(let a of this.allColumns)this.colById[a.id]=a;this.defaultColumns==null&&(this.defaultColumns=this.visibleColumns.slice(0));let t=[];for(let a of this.allColumns)!e[a.id]&&(!a.sourceItem||a.sourceItem.filterOnly!==!0&&(a.sourceItem.readPermission==null||Hd.hasPermission(a.sourceItem.readPermission)))&&t.push(a);let i=t.sort((a,o)=>jd.stringCompare(this.getTitle(a),this.getTitle(o)));for(let a of this.visibleColumns){var r=this.colById[a];r&&this.createLI(r).appendTo(this.ulVisible)}for(let a of i)this.createLI(a).appendTo(this.ulHidden);this.updateListStates(),typeof Sortable!="undefined"&&Sortable.create&&(Sortable.create(this.ulVisible[0],{group:this.uniqueName+"_group",filter:".js-hide",onFilter:a=>{$(a.item).appendTo(this.ulHidden),this.updateListStates()},onMove:a=>!($(a.dragged).hasClass("cant-hide")&&a.from==this.ulVisible[0]&&a.to!==a.from),onEnd:a=>this.updateListStates()}),Sortable.create(this.ulHidden[0],{group:this.uniqueName+"_group",sort:!1,filter:".js-show",onFilter:a=>{$(a.item).appendTo(this.ulVisible),this.updateListStates()},onEnd:()=>this.updateListStates()}))}onDialogOpen(){super.onDialogOpen(),this.element.find("input").removeAttr("disabled"),this.element.closest(".ui-dialog").children(".ui-dialog-buttonpane").find("button").eq(0).addClass("restore-defaults").next().focus(),this.setupColumns(),Ud(this.element)}getTemplate(){return`
<div class="search"><input id="~_Search" type="text" disabled /></div>
<div class="columns-container">
<div class="column-list visible-list bg-success">
<h5><i class="fa fa-eye"></i> ${mi(Ge("Controls.ColumnPickerDialog.VisibleColumns"))}</h5>
<ul id="~_VisibleCols"></ul>
</div>
<div class="column-list hidden-list bg-info">
<h5><i class="fa fa-eye-slash"></i> ${mi(Ge("Controls.ColumnPickerDialog.HiddenColumns"))}</h5>
<ul id="~_HiddenCols"></ul>
</div>
</div>`}};st=h([m.registerClass("Serenity.ColumnPickerDialog"),m.resizable(),m.responsive()],st);import{htmlEncode as Yd,toGrouping as Hn,tryFirst as Xd}from"@serenity-is/corelib/q";var Lr=class{constructor(n){this.options=n;var e=this.dataGrid=n.grid,t=e.getIdProperty(),i=this.getId=l=>l[t];e.element.find(".grid-container").on("click",l=>{if($(l.target).hasClass("s-TreeToggle")){var u=e.slickGrid.getCellFromEvent(l);u.cell>=0&&u.row>=0&&re.toggleClick(l,u.row,u.row,e.view,i)}});var r=e.onViewFilter;e.onViewFilter=function(l){return r.apply(this,[l])?re.filterById(l,e.view,n.getParentId):!1};var a=e.onViewProcessData;if(e.onViewProcessData=function(l){return l=a.apply(this,[l]),l.Entities=Lr.applyTreeOrdering(l.Entities,i,n.getParentId),re.setIndents(l.Entities,i,n.getParentId,n.initialCollapse&&n.initialCollapse()||!1),l},n.toggleField){var o=Xd(e.allColumns||e.slickGrid.getColumns()||[],l=>l.field==n.toggleField);o&&(o.format=_e.treeToggle(()=>e.view,i,o.format||(l=>Yd(l.value))))}}toggleAll(){re.setCollapsed(this.dataGrid.view.getItems(),!this.dataGrid.view.getItems().every(n=>n._collapsed==!0)),this.dataGrid.view.setItems(this.dataGrid.view.getItems(),!0)}collapseAll(){re.setCollapsed(this.dataGrid.view.getItems(),!0),this.dataGrid.view.setItems(this.dataGrid.view.getItems(),!0)}expandAll(){re.setCollapsed(this.dataGrid.view.getItems(),!1),this.dataGrid.view.setItems(this.dataGrid.view.getItems(),!0)}static applyTreeOrdering(n,e,t){var i=[],r=Hn(n,e),a=Hn(n,t),o={};function l(p){if(!o[p]){o[p]=!0;for(var g of a[p]||[])i.push(g),l(e(g))}}for(var u of n){var c=t(u);(c==null||!(r[c]||[]).length)&&(i.push(u),l(e(u)))}return i}};import{Culture as Zd,getLookup as eu,htmlEncode as tu,isEmptyOrNull as Zt,ScriptData as iu,trimToNull as ru,tryGetText as su}from"@serenity-is/corelib/q";var gi=class extends Q{constructor(e,t){super(e,t);e.addClass("s-CheckTreeEditor"),this.updateItems()}getIdProperty(){return"id"}getTreeItems(){return[]}updateItems(){for(var e=this.getTreeItems(),t={},i=0;i<e.length;i++){var r=e[i];if(r.children=[],Zt(r.id)||(t[r.id]=r),!Zt(r.parentId)){var a=t[r.parentId];a!=null&&a.children.push(r)}}this.view.addData({Entities:e,Skip:0,Take:0,TotalCount:e.length}),this.updateSelectAll(),this.updateFlags()}getEditValue(e,t){this.getDelimited()?t[e.name]=this.get_value().join(","):t[e.name]=this.get_value()}setEditValue(e,t){var i=e[t.name];this.set_value(i)}getButtons(){var e=this.getSelectAllText();if(Zt(e))return null;var t=this,i=[];return i.push(hi.define(function(){return t},function(r){return r.id},function(r){return r.isSelected},(r,a)=>{r.isSelected!==a&&(r.isSelected=a,this.itemSelectedChanged(r))},null,()=>{this.updateFlags()})),i}itemSelectedChanged(e){}getSelectAllText(){var e;return(e=su("Controls.CheckTreeEditor.SelectAll"))!=null?e:"Select All"}isThreeStateHierarchy(){return!1}createSlickGrid(){this.element.addClass("slick-no-cell-border").addClass("slick-no-odd-even");var e=super.createSlickGrid();return this.element.addClass("slick-hide-header"),e.resizeCanvas(),e}onViewFilter(e){if(!super.onViewFilter(e))return!1;var t=this.view.getItems(),i=this;return re.filterCustom(e,function(r){if(r.parentId==null)return null;if(i.byId==null){i.byId={};for(var a=0;a<t.length;a++){var o=t[a];o.id!=null&&(i.byId[o.id]=o)}}return i.byId[r.parentId]})}getInitialCollapse(){return!1}onViewProcessData(e){return e=super.onViewProcessData(e),this.byId=null,re.setIndents(e.Entities,function(t){return t.id},function(t){return t.parentId},this.getInitialCollapse()),e}onClick(e,t,i){if(super.onClick(e,t,i),e.isDefaultPrevented()||re.toggleClick(e,t,i,this.view,function(u){return u.id}),!e.isDefaultPrevented()){var r=$(e.target);if(r.hasClass("check-box")){if(e.preventDefault(),this._readOnly)return;var a=r.hasClass("checked")||r.hasClass("partial"),o=this.itemAt(t),l=o.isSelected!==!a;this.view.beginUpdate();try{o.isSelected!==!a&&(o.isSelected=!a,this.view.updateItem(o.id,o),this.itemSelectedChanged(o)),l=this.setAllSubTreeSelected(o,o.isSelected)||l,this.updateSelectAll(),this.updateFlags()}finally{this.view.endUpdate()}l&&this.element.triggerHandler("change")}}}updateSelectAll(){hi.update(this,function(e){return e.isSelected})}updateFlags(){var e=this.view,t=e.getItems(),i=this.isThreeStateHierarchy();if(i){e.beginUpdate();try{for(var r=0;r<t.length;r++){var a=t[r];if(a.children==null||a.children.length===0){var o=this.getDescendantsSelected(a);o!==a.isAllDescendantsSelected&&(a.isAllDescendantsSelected=o,e.updateItem(a.id,a));continue}var l=this.allDescendantsSelected(a),u=l||this.anyDescendantsSelected(a);if(l!==a.isAllDescendantsSelected||u!==a.isSelected){var c=a.isSelected!==u;a.isAllDescendantsSelected=l,a.isSelected=u,e.updateItem(a.id,a),c&&this.itemSelectedChanged(a)}}}finally{e.endUpdate()}}}getDescendantsSelected(e){return!0}setAllSubTreeSelected(e,t){for(var i=!1,r=0;r<e.children.length;r++){var a=e.children[r];a.isSelected!==t&&(i=!0,a.isSelected=t,this.view.updateItem(a.id,a),this.itemSelectedChanged(a)),a.children.length>0&&(i=this.setAllSubTreeSelected(a,t)||i)}return i}allItemsSelected(){for(var e=0;e<this.rowCount();e++){var t=this.itemAt(e);if(!t.isSelected)return!1}return this.rowCount()>0}allDescendantsSelected(e){if(e.children.length>0)for(var t=0;t<e.children.length;t++){var i=e.children[t];if(!i.isSelected||!this.allDescendantsSelected(i))return!1}return!0}getDelimited(){return!!this.options.delimited}anyDescendantsSelected(e){if(e.children.length>0)for(var t=0;t<e.children.length;t++){var i=e.children[t];if(i.isSelected||this.anyDescendantsSelected(i))return!0}return!1}getColumns(){var e=this,t=[];return t.push({field:"text",name:"Kay\u0131t",width:80,format:_e.treeToggle(function(){return e.view},function(i){return i.id},i=>{var r="check-box",a=i.item;if(a.hideCheckBox)return this.getItemText(i);var o=this.isThreeStateHierarchy();return a.isSelected&&(o&&!a.isAllDescendantsSelected?r+=" partial":r+=" checked"),this._readOnly&&(r+=" readonly"),'<span class="'+r+'"></span>'+this.getItemText(i)})}),t}getItemText(e){return tu(e.value)}getSlickOptions(){var e=super.getSlickOptions();return e.forceFitColumns=!0,e}sortItems(){if(this.moveSelectedUp()){for(var e={},t=this.view.getItems(),i=0,r=0;r<t.length;r++){var a=t[r];e[a.id]=i++}t.sort(function(o,l){if(o.isSelected&&!l.isSelected)return-1;if(l.isSelected&&!o.isSelected)return 1;var u=Zd.stringCompare(o.text,l.text);return u!==0?u:e[o.id]<e[l.id]?-1:e[o.id]>e[l.id]?1:0}),this.view.setItems(t,!0)}}moveSelectedUp(){return!1}get_readOnly(){return this._readOnly}set_readOnly(e){!!this._readOnly!=!!e&&(this._readOnly=!!e,this.view.refresh())}get_value(){for(var e=[],t=this.view.getItems(),i=0;i<t.length;i++)t[i].isSelected&&e.push(t[i].id);return e}get value(){return this.get_value()}set_value(e){var t={};if(e!=null){typeof e=="string"&&(e=e.split(",").map(u=>ru(u)).filter(u=>u!=null));for(var i=0;i<e.length;i++)t[e[i]]=!0}this.view.beginUpdate();try{for(var r=this.view.getItems(),a=0;a<r.length;a++){var o=r[a],l=t[o.id];l!==o.isSelected&&(o.isSelected=l,this.view.updateItem(o.id,o))}this.updateSelectAll(),this.updateFlags(),this.sortItems()}finally{this.view.endUpdate()}}set value(e){this.set_value(e)}};gi=h([m.registerEditor("Serenity.CheckTreeEditor",[X,Z,R]),m.element("<div/>")],gi);var Ar=class extends gi{constructor(e,t){super(e,t);this.enableUpdateItems=!0,this.setCascadeFrom(this.options.cascadeFrom),this.updateItems(),iu.bindToChange("Lookup."+this.getLookupKey(),this.uniqueName,()=>this.updateItems())}updateItems(){this.enableUpdateItems&&super.updateItems()}getLookupKey(){return this.options.lookupKey}getButtons(){var e;return(e=super.getButtons())!=null?e:this.options.hideSearch?null:[]}createToolbarExtensions(){super.createToolbarExtensions(),Tt.addQuickSearchInputCustom(this.toolbar.element,(e,t)=>{this.searchText=Select2.util.stripDiacritics(t||"").toUpperCase(),this.view.setItems(this.view.getItems(),!0)})}getSelectAllText(){return this.options.showSelectAll?super.getSelectAllText():null}cascadeItems(e){var t=this.get_cascadeValue();if(t==null||t==="")return Zt(this.get_cascadeField())?e:[];var i=t.toString(),r=this.get_cascadeField();return e.filter(a=>{var l;var o=(l=a[r])!=null?l:se.getPropertyValue(a,r);return o!=null&&o.toString()===i})}filterItems(e){var t=this.get_filterValue();if(t==null||t==="")return e;var i=t.toString(),r=this.get_filterField();return e.filter(a=>{var l;var o=(l=a[r])!=null?l:se.getPropertyValue(a,r);return o!=null&&o.toString()===i})}getLookupItems(e){return this.filterItems(this.cascadeItems(e.items))}getTreeItems(){var e=eu(this.options.lookupKey),t=this.getLookupItems(e);return t.map(i=>{var r,a;return{id:((r=i[e.idField])!=null?r:"").toString(),text:((a=i[e.textField])!=null?a:"").toString(),source:i}})}onViewFilter(e){return super.onViewFilter(e)&&(Zt(this.searchText)||Select2.util.stripDiacritics(e.text||"").toUpperCase().indexOf(this.searchText)>=0)}moveSelectedUp(){return this.options.checkedOnTop}get_cascadeFrom(){return this.options.cascadeFrom}get cascadeFrom(){return this.get_cascadeFrom()}getCascadeFromValue(e){return S.getValue(e)}setCascadeFrom(e){if(Zt(e)){this.cascadeLink!=null&&(this.cascadeLink.set_parentID(null),this.cascadeLink=null),this.options.cascadeFrom=null;return}this.cascadeLink=new Ke(b,this,t=>{this.set_cascadeValue(this.getCascadeFromValue(t))}),this.cascadeLink.set_parentID(e),this.options.cascadeFrom=e}set_cascadeFrom(e){e!==this.options.cascadeFrom&&(this.setCascadeFrom(e),this.updateItems())}set cascadeFrom(e){this.set_cascadeFrom(e)}get_cascadeField(){var e;return(e=this.options.cascadeField)!=null?e:this.options.cascadeFrom}get cascadeField(){return this.get_cascadeField()}set_cascadeField(e){this.options.cascadeField=e}set cascadeField(e){this.set_cascadeField(e)}get_cascadeValue(){return this.options.cascadeValue}get cascadeValue(){return this.get_cascadeValue()}set_cascadeValue(e){this.options.cascadeValue!==e&&(this.options.cascadeValue=e,this.value=[],this.updateItems())}set cascadeValue(e){this.set_cascadeValue(e)}get_filterField(){return this.options.filterField}get filterField(){return this.get_filterField()}set_filterField(e){this.options.filterField=e}set filterField(e){this.set_filterField(e)}get_filterValue(){return this.options.filterValue}get filterValue(){return this.get_filterValue()}set_filterValue(e){this.options.filterValue!==e&&(this.options.filterValue=e,this.value=null,this.updateItems())}set filterValue(e){this.set_filterValue(e)}};Ar=h([m.registerEditor("Serenity.CheckLookupEditor")],Ar);import{Authorization as nu,endsWith as Un,format as bs,getInstanceType as Cs,getTypeFullName as xs,LT as jn,replaceAll as au,resolveUrl as ou,Router as Gr,safeCast as Kn,localText as Is,tryGetText as Yn}from"@serenity-is/corelib/q";var Wr=class extends Q{constructor(e,t){super(e,t);this.element.addClass("route-handler").on("handleroute."+this.uniqueName,(i,r)=>this.handleRoute(r))}handleRoute(e){var r,a;if(!e.handled){if(e.route==="new"){e.handled=!0,this.addButtonClick();return}var t=(r=ee)==null?void 0:r.active,i=e.route.split("/");if(i.length===2&&i[0]==="edit")e.handled=!0,this.editItem(decodeURIComponent(i[1]));else if(i.length===2&&i[1]==="new")e.handled=!0,this.editItemOfType(i[0],null);else if(i.length===3&&i[1]==="edit")e.handled=!0,this.editItemOfType(i[0],decodeURIComponent(i[2]));else return;((a=ee)==null?void 0:a.active)>t&&e.handled&&e.index>=0&&e.index<e.parts.length-1&&ee(document).one("ajaxStop",()=>{setTimeout(()=>Gr.resolve("#"+e.parts.join("/+/")),1)})}}usePager(){return!0}createToolbarExtensions(){this.createIncludeDeletedButton(),this.createQuickSearchInput()}getInitialTitle(){return this.getDisplayName()}getLocalTextPrefix(){var e=super.getLocalTextPrefix();return e!=null||this.getRowDefinition()?e:this.getEntityType()}getEntityType(){if(this._entityType!=null)return this._entityType;var e=this.attrs(qe);if(e.length===1)return this._entityType=e[0].value;var t=xs(Cs(this)),i=t.indexOf(".");return i>=0&&(t=t.substring(i+1)),Un(t,"Grid")?t=t.substr(0,t.length-4):Un(t,"SubGrid")&&(t=t.substr(0,t.length-7)),this._entityType=t,this._entityType}getDisplayName(){if(this._displayName!=null)return this._displayName;var e=this.attrs(De);return e.length>=1?(this._displayName=e[0].displayName,this._displayName=jn.getDefault(this._displayName,this._displayName)):(this._displayName=Yn(this.getLocalTextDbPrefix()+"EntityPlural"),this._displayName==null&&(this._displayName=this.getEntityType())),this._displayName}getItemName(){if(this._itemName!=null)return this._itemName;var e=this.attrs(Fe);return e.length>=1?(this._itemName=e[0].value,this._itemName=jn.getDefault(this._itemName,this._itemName)):(this._itemName=Yn(this.getLocalTextDbPrefix()+"EntitySingular"),this._itemName==null&&(this._itemName=this.getEntityType())),this._itemName}getAddButtonCaption(){return bs(Is("Controls.EntityGrid.NewButton"),this.getItemName())}getButtons(){var e=[];return e.push({title:this.getAddButtonCaption(),action:"add",cssClass:"add-button",icon:"fa-plus-circle text-green",hotkey:"alt+n",onClick:()=>{this.addButtonClick()},disabled:()=>!this.hasInsertPermission()||this.readOnly}),e.push(this.newRefreshButton(!0)),e.push(st.createToolButton(this)),e}newRefreshButton(e){return{title:e?null:Is("Controls.EntityGrid.RefreshButton"),hint:e?Is("Controls.EntityGrid.RefreshButton"):null,icon:"fa-refresh text-blue",action:"refresh",cssClass:"refresh-button",onClick:()=>{this.refresh()}}}addButtonClick(){this.editItem(new Object)}editItem(e){this.createEntityDialog(this.getItemType(),t=>{var i=Kn(t,Ve);if(i!=null){i.load(e,()=>{i.dialogOpen(this.openDialogsAsPanel)});return}throw new Error(bs("{0} doesn't implement IEditDialog!",xs(Cs(t))))})}editItemOfType(e,t){if(e===this.getItemType()){this.editItem(t);return}this.createEntityDialog(e,i=>{var r=Kn(i,Ve);if(r!=null){r.load(t,()=>r.dialogOpen(this.openDialogsAsPanel));return}throw new Error(bs("{0} doesn't implement IEditDialog!",xs(Cs(i))))})}getService(){if(this._service!=null)return this._service;var e=this.attrs(Ee);return e.length>=1?this._service=e[0].value:this._service=au(this.getEntityType(),".","/"),this._service}getViewOptions(){var e=super.getViewOptions();return e.url=ou("~/Services/"+this.getService()+"/List"),e}getItemType(){return this.getEntityType()}routeDialog(e,t){Gr&&Gr.dialog&&Gr.dialog(this.element,t.element,()=>{var i="";return e!==this.getItemType()&&(i=e+"/"),t!=null&&t.entityId!=null?i+="edit/"+t.entityId.toString():i+="new",i})}getInsertPermission(){var e;return(e=this.getRowDefinition())==null?void 0:e.insertPermission}hasInsertPermission(){var e=this.getInsertPermission();return e==null||nu.hasPermission(this.getInsertPermission())}transferDialogReadOnly(e){this.readOnly&&S.setReadOnly(e,!0)}initDialog(e){Ie.bindToDataChange(e,this,(t,i)=>{this.subDialogDataChange()},!0),this.transferDialogReadOnly(e),this.routeDialog(this.getItemType(),e)}initEntityDialog(e,t){if(e===this.getItemType()){this.initDialog(t);return}Ie.bindToDataChange(t,this,(i,r)=>{this.subDialogDataChange()},!0),this.transferDialogReadOnly(t),this.routeDialog(e,t)}createEntityDialog(e,t){var i=this.getDialogTypeFor(e),r=b.create({type:i,options:this.getDialogOptionsFor(e),init:a=>{this.initEntityDialog(e,a),t&&t(a)}});return r}getDialogOptions(){return{}}getDialogOptionsFor(e){return e===this.getItemType()?this.getDialogOptions():{}}getDialogTypeFor(e){return e===this.getItemType()?this.getDialogType():mt.get(e)}getDialogType(){if(this._dialogType!=null)return this._dialogType;var e=this.attrs(nt);return e.length>=1?this._dialogType=e[0].value:this._dialogType=mt.get(this.getEntityType()),this._dialogType}};Wr=h([m.registerClass("Serenity.EntityGrid")],Wr);import{any as lu,Authorization as Ts,confirmDialog as Xn,endsWith as qr,Exception as du,extend as St,format as Zn,getAttributes as uu,getFormData as pu,getFormDataAsync as cu,getInstanceType as Ss,getTypeFullName as hu,isEmptyOrNull as ei,localText as M,LT as mu,notifySuccess as gu,replaceAll as fu,safeCast as yu,ScriptData as vu,serviceCall as fi,startsWith as bu,tryGetText as Cu,validatorAbortHandler as ea}from"@serenity-is/corelib/q";var We=class extends N{constructor(e){super(e);this.useAsync()?this.initAsync():this.initSync()}internalInit(){this.initPropertyGrid(),this.initLocalizationGrid()}initSync(){this.propertyItemsData=this.getPropertyItemsData(),this.internalInit(),this.afterInit()}initAsync(){return Pe(this,null,function*(){this.propertyItemsData=yield this.getPropertyItemsDataAsync(),this.internalInit(),this.afterInit()})}afterInit(){}useAsync(){return!1}destroy(){this.propertyGrid&&(this.propertyGrid.destroy(),this.propertyGrid=null),this.localizationGrid&&(this.localizationGrid.destroy(),this.localizationGrid=null),this.undeleteButton=null,this.applyChangesButton=null,this.deleteButton=null,this.saveAndCloseButton=null,this.editButton=null,this.cloneButton=null,this.toolbar=null,super.destroy()}get_entity(){return this.entity}set_entity(e){this.entity=e||new Object}get_entityId(){return this.entityId}set_entityId(e){this.entityId=e}getEntityNameFieldValue(){var e;return((e=this.get_entity()[this.getNameProperty()])!=null?e:"").toString()}getEntityTitle(){var i;if(this.isEditMode()){var e=this.isViewMode()||this.readOnly||!this.hasSavePermission()?M("Controls.EntityDialog.ViewRecordTitle"):M("Controls.EntityDialog.EditRecordTitle"),t=(i=this.getEntityNameFieldValue())!=null?i:"";return Zn(e,this.getEntitySingular(),ei(t)?"":" ("+t+")")}else return Zn(M("Controls.EntityDialog.NewRecordTitle"),this.getEntitySingular())}updateTitle(){this.dialogTitle=this.getEntityTitle()}isCloneMode(){return!1}isEditMode(){return this.get_entityId()!=null&&!this.isCloneMode()}isDeleted(){if(this.get_entityId()==null)return!1;var e=this.getIsDeletedProperty();if(e)return!!this.get_entity()[e];var t=this.get_entity()[this.getIsActiveProperty()];return t==null?!1:t<0}isNew(){return this.get_entityId()==null}isNewOrDeleted(){return this.isNew()||this.isDeleted()}getDeleteOptions(e){return{}}deleteHandler(e,t){fi(e)}doDelete(e){var t=this,i={EntityId:this.get_entityId()},r={service:this.getService()+"/Delete",request:i,onSuccess:l=>{t.onDeleteSuccess(l),e!=null&&e(l),t.element.triggerHandler("ondatachange",[{entityId:i.EntityId,entity:this.entity,type:"delete"}])}},a=this.getDeleteOptions(e),o=St(r,a);this.deleteHandler(o,e)}onDeleteSuccess(e){}attrs(e){return uu(Ss(this),e,!0)}getRowDefinition(){return null}getEntityType(){if(this._entityType!=null)return this._entityType;var e=this.attrs(qe);if(e.length===1)return this._entityType=e[0].value;var t=hu(Ss(this)),i=t.indexOf(".");return i>=0&&(t=t.substring(i+1)),qr(t,"Dialog")||qr(t,"Control")?t=t.substr(0,t.length-6):qr(t,"Panel")&&(t=t.substr(0,t.length-5)),this._entityType=t}getFormKey(){if(this._formKey!=null)return this._formKey;var e=this.attrs(ve);return e.length>=1?this._formKey=e[0].value:this._formKey=this.getEntityType()}getLocalTextDbPrefix(){var e;return this._localTextDbPrefix!=null?this._localTextDbPrefix:(this._localTextDbPrefix=(e=this.getLocalTextPrefix())!=null?e:"",this._localTextDbPrefix.length>0&&!qr(this._localTextDbPrefix,".")&&(this._localTextDbPrefix="Db."+this._localTextDbPrefix+"."),this._localTextDbPrefix)}getLocalTextPrefix(){var e=this.getRowDefinition();if(e)return e.localTextPrefix;var t=this.attrs($e);return t.length>=1?t[0].value:this.getEntityType()}getEntitySingular(){if(this._entitySingular!=null)return this._entitySingular;var e=this.attrs(Fe);if(e.length>=1)this._entitySingular=e[0].value,this._entitySingular=mu.getDefault(this._entitySingular,this._entitySingular);else{var t=Cu(this.getLocalTextDbPrefix()+"EntitySingular");t==null&&(t=this.getEntityType()),this._entitySingular=t}return this._entitySingular}getNameProperty(){var i,r;if(this._nameProperty!=null)return this._nameProperty;var e=this.getRowDefinition();if(e)return this._nameProperty=(i=e.nameProperty)!=null?i:"";var t=this.attrs(wt);return t.length>=1?this._nameProperty=(r=t[0].value)!=null?r:"":this._nameProperty="Name"}getIdProperty(){var i,r;if(this._idProperty!=null)return this._idProperty;var e=this.getRowDefinition();if(e)return this._idProperty=(i=e.idProperty)!=null?i:"";var t=this.attrs(Me);return t.length===1?this._idProperty=(r=t[0].value)!=null?r:"":this._idProperty="ID"}getIsActiveProperty(){var i,r;if(this._isActiveProperty!=null)return this._isActiveProperty;var e=this.getRowDefinition();if(e)return this._isActiveProperty=(i=e.isActiveProperty)!=null?i:"";var t=this.attrs(Je);return t.length===1?this._isActiveProperty=(r=t[0].value)!=null?r:"":this._isActiveProperty=""}getIsDeletedProperty(){var e;return(e=this.getRowDefinition())==null?void 0:e.isDeletedProperty}getService(){if(this._service!=null)return this._service;var e=this.attrs(Ee);return e.length>=1?this._service=e[0].value:this._service=fu(this.getEntityType(),".","/"),this._service}load(e,t,i){var r=()=>{if(e==null){this.loadResponse({}),t&&t();return}var o=typeof e;if(o==="string"||o==="number"){var l=e;this.loadById(l,function(c){t&&window.setTimeout(t,0)},null);return}var u=e||new Object;this.loadResponse({Entity:u}),t&&t()};if(i==null){r();return}try{r()}catch(o){var a=du.wrap(o);i(a)}}loadNewAndOpenDialog(e){this.loadResponse({}),this.dialogOpen(e)}loadEntityAndOpenDialog(e,t){this.loadResponse({Entity:e}),this.dialogOpen(t)}loadResponse(e){e=e||{},this.onLoadingData(e);var t=e.Entity||new Object;this.beforeLoadEntity(t),this.loadEntity(t),this.set_entity(t),this.afterLoadEntity()}loadEntity(e){var t=this.getIdProperty();t!=null&&this.set_entityId(e[t]),this.set_entity(e),this.propertyGrid!=null&&(this.propertyGrid.set_mode(this.isEditMode()?2:1),this.propertyGrid.load(e))}beforeLoadEntity(e){this.localizationPendingValue=null,this.localizationLastValue=null}afterLoadEntity(){this.updateInterface(),this.updateTitle()}loadByIdAndOpenDialog(e,t){this.loadById(e,i=>window.setTimeout(()=>this.dialogOpen(t),0),()=>{this.element.is(":visible")||this.element.remove()})}onLoadingData(e){}getLoadByIdOptions(e,t){return{}}getLoadByIdRequest(e){var t={};return t.EntityId=e,t}reloadById(){this.loadById(this.get_entityId())}loadById(e,t,i){var r={service:this.getService()+"/Retrieve",blockUI:!0,request:this.getLoadByIdRequest(e),onSuccess:l=>{this.loadResponse(l),t&&t(l)},onCleanup:()=>{this.validator!=null&&ea(this.validator)}},a=this.getLoadByIdOptions(e,t),o=St(r,a);this.loadByIdHandler(o,t,i)}loadByIdHandler(e,t,i){var r=fi(e);i&&r.fail(i)}initLocalizationGrid(){var e=this.byId("PropertyGrid");if(!(e.length<=0)){var t=this.getPropertyGridOptions();this.initLocalizationGridCommon(t)}}initLocalizationGridCommon(e){var t=this.byId("PropertyGrid");if(lu(e.items,c=>c.localizable===!0)){var i=$("<div/>").attr("id",this.idPrefix+"LocalizationGrid").hide().insertAfter(t);e.idPrefix=this.idPrefix+"Localization_";var r=[];for(var a of e.items){var o=null;if(a.localizable===!0){var l=St({},a);l.oneWay=!0,l.readOnly=!0,l.required=!1,l.defaultValue=null,r.push(l),o==null&&(o=this.getLangs());for(var u of o)l=St({},a),l.name=u[0]+"$"+l.name,l.title=u[1],l.cssClass=[l.cssClass,"translation"].join(" "),l.insertable=!0,l.updatable=!0,l.oneWay=!1,l.required=!1,l.localizable=!1,l.defaultValue=null,r.push(l)}}e.items=r,this.localizationGrid=new q(i,e).init(null),i.addClass("s-LocalizationGrid")}}isLocalizationMode(){return this.localizationButton!=null&&this.localizationButton.hasClass("pressed")}isLocalizationModeAndChanged(){if(!this.isLocalizationMode())return!1;var e=this.getLocalizationGridValue();return JSON.stringify(this.localizationLastValue)!=JSON.stringify(e)}localizationButtonClick(){if(!(this.isLocalizationMode()&&!this.validateForm())){if(this.isLocalizationModeAndChanged()){var e=this.getLocalizationGridValue();this.localizationLastValue=e,this.localizationPendingValue=e}this.localizationButton.toggleClass("pressed"),this.updateInterface(),this.isLocalizationMode()&&this.loadLocalization()}}getLanguages(){return We.defaultLanguageList!=null?We.defaultLanguageList()||[]:[]}getLangs(){var e=this.getLanguages(),t=yu(e,Array);return(t==null||t.length===0||t[0]==null||!Array.isArray(t[0]))&&(t=Array.prototype.slice.call(e.map(function(i){return[i.item1,i.item2]}))),t}loadLocalization(){if(this.localizationLastValue==null&&this.isNew()){this.localizationGrid.load({}),this.setLocalizationGridCurrentValues(),this.localizationLastValue=this.getLocalizationGridValue();return}if(this.localizationLastValue!=null){this.localizationGrid.load(this.localizationLastValue),this.setLocalizationGridCurrentValues();return}var e={service:this.getService()+"/Retrieve",blockUI:!0,request:{EntityId:this.get_entityId(),ColumnSelection:"keyOnly",IncludeColumns:["Localizations"]},onSuccess:t=>{var i=St(new Object,this.get_entity());if(t.Localizations)for(var r of Object.keys(t.Localizations)){var a=t.Localizations[r];for(var o of Object.keys(a))i[r+"$"+o]=a[o]}this.localizationGrid.load(i),this.setLocalizationGridCurrentValues(),this.localizationPendingValue=null,this.localizationLastValue=this.getLocalizationGridValue()}};fi(e)}setLocalizationGridCurrentValues(){var e={};this.localizationGrid.enumerateItems((t,i)=>{t.name.indexOf("$")<0&&i.element.is(":input")&&(e[t.name]=this.byId(t.name).val(),i.element.val(e[t.name]))}),this.localizationGrid.enumerateItems((t,i)=>{var r=t.name.indexOf("$");if(r>=0&&i.element.is(":input")){var a=e[t.name.substr(r+1)];a!=null&&a.length>0&&i.element.attr("title",a).attr("placeholder",a)}})}getLocalizationGridValue(){var e={};this.localizationGrid.save(e);for(var t of Object.keys(e))t.indexOf("$")<0&&delete e[t];return e}getPendingLocalizations(){if(this.localizationPendingValue==null)return null;var e={},t=this.getIdProperty(),i=this.getLangs();for(var r of i){var a=r[0],o={};t!=null&&(o[t]=this.get_entityId());var l=a+"$";for(var u of Object.keys(this.localizationPendingValue))bu(u,l)&&(o[u.substr(l.length)]=this.localizationPendingValue[u]);e[a]=o}return e}initPropertyGrid(){var e=this.byId("PropertyGrid");if(!(e.length<=0)){var t=this.getPropertyGridOptions();this.propertyGrid=new q(e,t).init(null),this.element.closest(".ui-dialog").hasClass("s-Flexify")&&this.propertyGrid.element.children(".categories").flexHeightOnly(1)}}getPropertyItems(){var e;return((e=this.propertyItemsData)==null?void 0:e.items)||[]}getPropertyItemsData(){var e=this.getFormKey();return this.getFormKey===We.prototype.getFormKey&&this.getPropertyItems!==We.prototype.getPropertyItems&&!vu.canLoad("Form."+e)?{items:this.getPropertyItems(),additionalItems:[]}:ei(e)?{items:[],additionalItems:[]}:pu(e)}getPropertyItemsDataAsync(){return Pe(this,null,function*(){var e=this.getFormKey();return ei(e)?{items:[],additionalItems:[]}:yield cu(e)})}getPropertyGridOptions(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,localTextPrefix:"Forms."+this.getFormKey()+".",useCategories:!0}}validateBeforeSave(){return!0}getSaveOptions(e){var t={};return t.service=this.getService()+"/"+(this.isEditMode()?"Update":"Create"),t.onSuccess=i=>{this.onSaveSuccess(i),e&&e(i);var r=this.isEditMode()?"update":"create",a=t.request==null?null:t.request.Entity,o=this.isEditMode()?this.get_entityId():i==null?null:i.EntityId,l={type:r,entity:a,entityId:o};this.element.triggerHandler("ondatachange",[l])},t.onCleanup=()=>{this.validator&&ea(this.validator)},t.request=this.getSaveRequest(),t}getSaveEntity(){var e=new Object;if(this.propertyGrid!=null&&this.propertyGrid.save(e),this.isEditMode()){var t=this.getIdProperty();t!=null&&e[t]==null&&(e[t]=this.get_entityId())}return e}getSaveRequest(){var e=this.getSaveEntity(),t={};if(t.Entity=e,this.isEditMode()){var i=this.getIdProperty();i!=null&&(t.EntityId=this.get_entityId())}return this.localizationPendingValue!=null&&(t.Localizations=this.getPendingLocalizations()),t}onSaveSuccess(e){}save_submitHandler(e){var t=this.getSaveOptions(e);this.saveHandler(t,e)}save(e){return Pt.submit(this.byId("Form"),()=>this.validateBeforeSave(),()=>this.save_submitHandler(e))}saveHandler(e,t){fi(e)}initToolbar(){super.initToolbar(),this.toolbar&&(this.saveAndCloseButton=this.toolbar.findButton("save-and-close-button"),this.applyChangesButton=this.toolbar.findButton("apply-changes-button"),this.deleteButton=this.toolbar.findButton("delete-button"),this.undeleteButton=this.toolbar.findButton("undo-delete-button"),this.editButton=this.toolbar.findButton("edit-button"),this.cloneButton=this.toolbar.findButton("clone-button"),this.localizationButton=this.toolbar.findButton("localization-button"))}showSaveSuccessMessage(e){gu(M("Controls.EntityDialog.SaveSuccessMessage"),"",null)}getToolbarButtons(){var e=[];return e.push({title:M("Controls.EntityDialog.SaveButton"),action:"save-and-close",cssClass:"save-and-close-button",icon:"fa-check-circle text-purple",hotkey:"alt+s",onClick:()=>{this.save(t=>{this.dialogClose()})},visible:()=>!this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasSavePermission()||this.readOnly}),e.push({title:"",hint:M("Controls.EntityDialog.ApplyChangesButton"),action:"apply-changes",cssClass:"apply-changes-button",icon:"fa-clipboard-check text-purple",hotkey:"alt+a",onClick:()=>{this.save(t=>{if(this.isEditMode()){var i=t.EntityId;i==null&&(i=this.get_entityId()),this.loadById(i)}else this.loadById(t.EntityId);this.showSaveSuccessMessage(t)})},visible:()=>!this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasSavePermission()||this.readOnly}),e.push({title:M("Controls.EntityDialog.DeleteButton"),cssClass:"delete-button",icon:"fa-trash-o text-red",hotkey:"alt+x",onClick:()=>{Xn(M("Controls.EntityDialog.DeleteConfirmation"),()=>{this.doDelete(()=>this.dialogClose())})},visible:()=>this.isEditMode()&&!this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasDeletePermission()||this.readOnly}),e.push({title:M("Controls.EntityDialog.UndeleteButton"),action:"undo-delete",cssClass:"undo-delete-button",onClick:()=>{this.isDeleted()&&Xn(M("Controls.EntityDialog.UndeleteConfirmation"),()=>{this.undelete(()=>this.loadById(this.get_entityId()))})},visible:()=>this.isEditMode()&&this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasDeletePermission()||this.readOnly}),this.useViewMode()&&e.push({title:M("Controls.EntityDialog.EditButton"),action:"delete",cssClass:"edit-button",icon:"fa-edit",onClick:()=>{this.isEditMode()&&(this.editClicked=!0,this.updateInterface(),this.updateTitle())},visible:()=>this.isViewMode(),disabled:()=>!this.hasSavePermission()||this.readOnly}),e.push({title:M("Controls.EntityDialog.LocalizationButton"),action:"localization",cssClass:"localization-button",onClick:()=>this.localizationButtonClick()}),e.push({title:M("Controls.EntityDialog.CloneButton"),action:"clone",cssClass:"clone-button",icon:"fa-clone",onClick:()=>{if(this.isEditMode()){var t=this.getCloningEntity();b.create({type:Ss(this),init:i=>Ie.bubbleDataChange(Ie.cascade(i,this.element),this,!0).loadEntityAndOpenDialog(t,null)})}},visible:()=>!1,disabled:()=>!this.hasInsertPermission()||this.readOnly}),e}getCloningEntity(){var e=new Object;e=St(e,this.get_entity());var t=this.getIdProperty();ei(t)||delete e[t];var i=this.getIsActiveProperty();ei(i)||delete e[i];var r=this.getIsDeletedProperty();return ei(r)||delete e[r],e}updateInterface(){S.setContainerReadOnly(this.byId("Form"),!1);var e=this.isLocalizationMode(),t=this.hasSavePermission(),i=this.isViewMode(),r=this.readOnly;if(this.toolbar.updateInterface(),this.tabs!=null&&Wi.setDisabled(this.tabs,"Log",this.isNewOrDeleted()),this.propertyGrid!=null&&this.propertyGrid.element.toggle(!e),this.localizationGrid!=null&&this.localizationGrid.element.toggle(e),this.localizationButton!=null&&(this.localizationButton.toggle(this.localizationGrid!=null),this.localizationButton.find(".button-inner").text(this.isLocalizationMode()?M("Controls.EntityDialog.LocalizationBack"):M("Controls.EntityDialog.LocalizationButton"))),e){this.toolbar!=null&&this.toolbar.findButton("tool-button").not(".localization-hidden").addClass(".localization-hidden").hide(),this.localizationButton&&this.localizationButton.show();return}this.toolbar.findButton("localization-hidden").removeClass("localization-hidden").show(),(!t||i||r)&&S.setContainerReadOnly(this.byId("Form"),!0)}getUndeleteOptions(e){return{}}undeleteHandler(e,t){fi(e)}undelete(e){var t={};t.service=this.getService()+"/Undelete";var i={};i.EntityId=this.get_entityId(),t.request=i,t.onSuccess=o=>{e&&e(o),this.element.triggerHandler("ondatachange",[{entityId:this.get_entityId(),entity:this.entity,type:"undelete"}])};var r=this.getUndeleteOptions(e),a=St(t,r);this.undeleteHandler(a,e)}get readOnly(){return this.get_readOnly()}set readOnly(e){this.set_readOnly(e)}get_readOnly(){return!!this._readonly}set_readOnly(e){!!this._readonly!=!!e&&(this._readonly=!!e,this.updateInterface(),this.updateTitle())}getInsertPermission(){var e;return(e=this.getRowDefinition())==null?void 0:e.insertPermission}getUpdatePermission(){var e;return(e=this.getRowDefinition())==null?void 0:e.updatePermission}getDeletePermission(){var e;return(e=this.getRowDefinition())==null?void 0:e.deletePermission}hasDeletePermission(){var e=this.getDeletePermission();return e==null||Ts.hasPermission(e)}hasInsertPermission(){var e=this.getInsertPermission();return e==null||Ts.hasPermission(e)}hasUpdatePermission(){var e=this.getUpdatePermission();return e==null||Ts.hasPermission(e)}hasSavePermission(){return this.isNew()?this.hasInsertPermission():this.hasUpdatePermission()}isViewMode(){return this.useViewMode()&&this.isEditMode()&&!this.editClicked}useViewMode(){return!1}getFallbackTemplate(){return`<div class="s-DialogContent">
    <div id="~_Toolbar" class="s-DialogToolbar">
    </div>
    <div class="s-Form">
        <form id="~_Form" action="">
            <div class="fieldset">
                <div id="~_PropertyGrid"></div>
                <div class="clear"></div>
            </div>
        </form> 
    </div>
</div>`}};We=h([m.registerClass("Serenity.EntityDialog",[Ve,R])],We);function xu(d){var n=b.create({type:this,element:e=>{var t=e[0];d.id!=null&&(t.id=d.id),d.name!=null&&t.setAttribute("name",d.name),d.placeholder!=null&&t.setAttribute("placeholder",d.placeholder),d.className!=null?t.className=d.className:d.class!=null&&(t.className=d.class),d.oneWay&&(t.dataset.oneWay="1"),d.maxLength!=null?t.setAttribute("maxLength",d.maxLength||0):d.maxlength!=null&&t.setAttribute("maxLength",d.maxlength||0)}});return d.required!=null&&S.setRequired(n,d.required),d.readOnly!==null?S.setReadOnly(n,d.readOnly):d.readonly!==null&&S.setReadOnly(n,d.readonly),d.setOptions!=d.setOptions&&ne.set(n,d.setOptions),d.value!==void 0?S.setValue(n,d.value):d.initialValue!=null&&S.setValue(n,d.initialValue),d.onChange!=null?n.element.on("change",d.onChange):d.onchange!=null&&n.element.on("change",d.onchange),d.onChangeSelect2!=null&&n.changeSelect2(d.onChangeSelect2),d.ref&&d.ref(n),n.element[0]}function bC(d){return xu.bind(d)}import{postToService as Iu,serviceCall as Tu,trimToNull as ta}from"@serenity-is/corelib/q";var ia;(e=>{let d=class extends N{constructor(r){super(r);r.reportKey&&this.loadReport(r.reportKey)}createPropertyGrid(){this.propertyGrid&&(this.byId("PropertyGrid").html("").attr("class",""),this.propertyGrid=null),this.propertyGrid=new q(this.byId("PropertyGrid"),{idPrefix:this.idPrefix,useCategories:!0,items:this.propertyItems}).init(null)}loadReport(r){Tu({service:"Report/Retrieve",request:{ReportKey:r},onSuccess:a=>{var l;this.reportKey=(l=a.ReportKey)!=null?l:r,this.propertyItems=a.Properties||[],this.dialogTitle=a.Title,this.createPropertyGrid();var o=a.InitialSettings;o==null&&(o=new Object),this.propertyGrid.load(o),this.toolbar.findButton("print-preview-button").toggle(!a.IsDataOnlyReport),this.toolbar.findButton("export-pdf-button").toggle(!a.IsDataOnlyReport),this.toolbar.findButton("export-docx-button").toggle(!a.IsDataOnlyReport),this.dialogOpen(null)}})}executeReport(r,a){if(this.validateForm()){var o=new Object;this.propertyGrid.save(o),Iu({service:"Report/Execute",request:{ReportKey:this.reportKey,DesignId:"Default",ExportType:a,Parameters:o},target:r})}}getToolbarButtons(){var r=[];return r.push({title:"\xD6nizleme",cssClass:"print-preview-button",onClick:()=>{this.executeReport("_blank",null)}}),r.push({title:"PDF",cssClass:"export-pdf-button",onClick:()=>{this.executeReport("","Pdf")}}),r.push({title:"Excel",cssClass:"export-xlsx-button",onClick:()=>{this.executeReport("","Xlsx")}}),r.push({title:"Word",cssClass:"export-docx-button",onClick:()=>{this.executeReport("","Docx")}}),r}};d=h([m.registerClass("Serenity.Reporting.ReportDialog")],d),e.ReportDialog=d;let n=class extends b{constructor(i){super(i),$(".report-link").click(a=>this.reportLinkClick(a)),$("div.line").click(a=>this.categoryClick(a));var r=this;new ie($("#QuickSearchInput"),{onSearch:function(a,o,l){r.updateMatchFlags(o),l(!0)}})}updateMatchFlags(i){var r=$("#ReportList").find("li").removeClass("non-match");if(i=ta(i),i==null){r.children("ul").hide(),r.show().removeClass("expanded");return}for(var a=i.replace(","," ").split(" "),o=0;o<a.length;o++)a[o]=ta(Select2.util.stripDiacritics(a[o]).toUpperCase());var l=r.filter(".report-item");l.each(function(g,f){var w;for(var y=$(f),v=Select2.util.stripDiacritics(((w=y.text())!=null?w:"").toUpperCase()),C=0;C<a.length;C++){var T=a[C];if(T!=null&&v.indexOf(T)===-1){y.addClass("non-match");break}}});var u=l.not(".non-match"),c=u.parents("li").add(u),p=r.not(c);p.hide().addClass("non-match"),c.show(),c.length<=100&&(r.children("ul").show(),r.addClass("expanded"))}categoryClick(i){var r=$(i.target).closest("li");r.hasClass("expanded")?(r.find("ul").hide("fast"),r.removeClass("expanded"),r.find("li").removeClass("expanded")):(r.addClass("expanded"),r.children("ul").show("fast"),r.children("ul").children("li").length===1&&!r.children("ul").children("li").hasClass("expanded")&&r.children("ul").children("li").children(".line").click())}reportLinkClick(i){i.preventDefault();var r=new d({reportKey:$(i.target).data("key")})}};n=h([m.registerClass("Serenity.Reporting.ReportPage")],n),e.ReportPage=n})(ia||(ia={}));var Mr=class{};Mr=h([m.registerClass("Serenity.ScriptContext")],Mr);var Jr=class{};Jr=h([m.registerInterface("Serenity.IAsyncInit")],Jr);var $r;(a=>{function d(o,l){return o.getWidget(l)}a.getWidget=d,a.getWidgetName=b.getWidgetName;function e(o){return typeof o.originalEvent!="undefined"}a.hasOriginalEvent=e;function t(o,l){o.change(l)}a.change=t;function i(o,l){o.changeSelect2(l)}a.changeSelect2=i;function r(o){return o.getGridField()}a.getGridField=r})($r||($r={}));var zr=class extends b{constructor(e,t){var u,c,p,g,f,y,v;super(e,t);var i=(p=new google.m)!=null?p:s.LatLng((u=this.options.latitude)!=null?u:0,(c=this.options.longitude)!=null?c:0),r=new Object;if(r.center=i,r.mapTypeId=(g=this.options.mapTypeId)!=null?g:"roadmap",r.zoom=(f=this.options.zoom)!=null?f:15,r.zoomControl=!0,this.map=new google.maps.Map(e[0],r),this.options.markerTitle!=null){var a=new Object,o=this.options.markerLatitude;o==null&&(o=(y=this.options.latitude)!=null?y:0);var l=this.options.markerLongitude;l==null&&(l=(v=this.options.longitude)!=null?v:0),a.position=new google.maps.LatLng(o,l),a.map=this.map,a.title=this.options.markerTitle,a.animation=2,new google.maps.Marker(a)}Ce.executeOnceWhenShown(e,()=>{google.maps.event.trigger(this.map,"resize",[]),this.map.setCenter(i)})}get_map(){return this.map}};zr=h([m.registerEditor("Serenity.GoogleMap",[]),m.element("<div/>")],zr);import{isEmptyOrNull as ra,isValue as Su,safeCast as ku,serviceCall as sa,localText as Ou,trimToNull as wu}from"@serenity-is/corelib/q";var Hr=class extends b{constructor(e,t){super(e,t);this.pageSize=50;var i=this.emptyItemText();i!=null&&e.attr("placeholder",i),e.select2(this.getSelect2Options()),e.attr("type","text"),e.on("change."+this.uniqueName,(r,a)=>{($r.hasOriginalEvent(r)||!a)&&Pt.getValidator(e)!=null&&e.valid()})}emptyItemText(){var e=this.element.attr("placeholder");return e==null&&(e=Ou("Controls.SelectEditor.EmptyItemText")),e}getService(){throw new Error("Not implemented!")}query(e,t){var i={blockUI:!1,service:this.getService()+"/List",request:e,onSuccess:function(r){t(r)}};this.executeQuery(i)}executeQuery(e){sa(e)}queryByKey(e,t){var i={blockUI:!1,service:this.getService()+"/Retrieve",request:{EntityId:e},onSuccess:function(r){t(r.Entity)}};this.executeQueryByKey(i)}executeQueryByKey(e){sa(e)}getItemKey(e){return null}getItemText(e){return null}getTypeDelay(){return 200}getSelect2Options(){var e=this.emptyItemText(),t=0;return{minimumResultsForSearch:10,placeHolder:ra(e)?null:e,allowClear:Su(e),query:i=>{var r={ContainsText:wu(i.term),Skip:(i.page-1)*this.pageSize,Take:this.pageSize+1};t!==0&&window.clearTimeout(t);var a=$(this.element).data("select2");a&&a.search&&a.search.removeClass("select2-active").parent().removeClass("select2-active"),t=window.setTimeout(()=>{a&&a.search.addClass("select2-active").parent().addClass("select2-active"),this.query(r,o=>{i.callback({results:o.Entities.slice(0,this.pageSize).map(l=>({id:this.getItemKey(l),text:this.getItemText(l),source:l})),more:o.Entities.length>=this.pageSize})})},this.getTypeDelay())},initSelection:(i,r)=>{var a=i.val();if(ra(a)){r(null);return}this.queryByKey(a,o=>{r(o==null?null:{id:this.getItemKey(o),text:this.getItemText(o),source:o})})}}}addInplaceCreate(e){var t=this;$("<a><b/></a>").addClass("inplace-button inplace-create").attr("title",e).insertAfter(this.element).click(function(i){t.inplaceCreateClick(i)}),this.get_select2Container().add(this.element).addClass("has-inplace-button")}inplaceCreateClick(e){}get_select2Container(){return this.element.prevAll(".select2-container")}get_value(){return ku(this.element.select2("val"),String)}get value(){return this.get_value()}set_value(e){if(e!==this.get_value()){var t=this.element;t.select2("val",e),t.data("select2-change-triggered",!0);try{t.triggerHandler("change",[!0])}finally{t.data("select2-change-triggered",!1)}}}set value(e){this.set_value(e)}};Hr=h([m.registerEditor("Serenity.Select2AjaxEditor",[D]),m.element('<input type="hidden" />')],Hr);export{de as BaseEditorFiltering,It as BaseFiltering,zi as BooleanEditor,Mt as BooleanFiltering,Kt as BooleanFormatter,Rs as CaptureOperationType,Ke as CascadedWidgetLink,yi as CategoryAttribute,Ar as CheckLookupEditor,gi as CheckTreeEditor,Pr as CheckboxFormatter,st as ColumnPickerDialog,lx as ColumnSelection,Ot as ColumnsKeyAttribute,px as Criteria,vi as CssClassAttribute,Q as DataGrid,V as DateEditor,qt as DateFiltering,ye as DateFormatter,A as DateTimeEditor,Jt as DateTimeFiltering,Dr as DateTimeFormatter,ir as DateYearEditor,Te as DecimalEditor,fr as DecimalFiltering,m as Decorators,bi as DefaultValueAttribute,je as DialogExtensions,nt as DialogTypeAttribute,mt as DialogTypeRegistry,De as DisplayNameAttribute,bt as EditorFiltering,Ci as EditorOptionAttribute,xi as EditorTypeAttribute,Ri as EditorTypeAttributeBase,gt as EditorTypeRegistry,S as EditorUtils,at as ElementAttribute,Yi as EmailAddressEditor,Et as EmailEditor,We as EntityDialog,Wr as EntityGrid,qe as EntityTypeAttribute,Nt as EnumEditor,yr as EnumFiltering,Oe as EnumFormatter,z as EnumKeyAttribute,Ue as EnumTypeRegistry,Le as FileDownloadFormatter,li as FileUploadEditor,Ht as FilterDialog,Ut as FilterDisplayBar,O as FilterOperators,zt as FilterPanel,le as FilterStore,et as FilterWidgetBase,ot as FilterableAttribute,$t as FilteringTypeRegistry,Ai as Flexify,lt as FlexifyAttribute,ve as FormKeyAttribute,Er as FormatterTypeRegistry,Ii as GeneratedCodeAttribute,zr as GoogleMap,Vr as GridRadioSelectionMixin,Rr as GridRowSelectionMixin,hi as GridSelectAllButtonHelper,Tt as GridUtils,Ti as HiddenAttribute,Si as HintAttribute,oe as HtmlContentEditor,sr as HtmlNoteContentEditor,nr as HtmlReportContentEditor,Jr as IAsyncInit,Re as IBooleanValue,be as IDialog,Y as IDoubleValue,Ve as IEditDialog,Ze as IFiltering,X as IGetEditValue,rt as IInitializeColumn,xt as IQuickFiltering,R as IReadOnly,Z as ISetEditValue,Yp as ISlickFormatter,D as IStringValue,Ne as IValidateRequired,Me as IdPropertyAttribute,ur as ImageUploadEditor,ki as InsertableAttribute,Dt as IntegerEditor,vr as IntegerFiltering,Je as IsActivePropertyAttribute,Fe as ItemNameAttribute,Ce as LazyLoadHelper,$e as LocalTextPrefixAttribute,Qt as LookupEditor,ni as LookupEditorBase,br as LookupFiltering,ar as MaskedEditor,Oi as MaxLengthAttribute,dt as MaximizableAttribute,Yt as MinuteFormatter,Gt as MultipleFileUploadEditor,pr as MultipleImageUploadEditor,wt as NamePropertyAttribute,Ae as NumberFormatter,wi as OneWayAttribute,ze as OptionAttribute,ut as OptionsTypeAttribute,pt as PanelAttribute,Ji as PasswordEditor,_i as PlaceholderAttribute,ft as PopupMenuButton,Bi as PopupToolButton,Ls as PrefixedContext,yt as PropertyDialog,q as PropertyGrid,ri as PropertyGridMode,Nr as PropertyItemSlickConverter,Mi as PropertyPanel,W as QuickFilterBar,ie as QuickSearchInput,er as RadioButtonEditor,Pi as ReadOnlyAttribute,or as Recaptcha,ne as ReflectionOptionsSetter,se as ReflectionUtils,ia as Reporting,Di as RequiredAttribute,ct as ResizableAttribute,ht as ResponsiveAttribute,dx as RetrieveColumnSelection,Mr as ScriptContext,Hr as Select2AjaxEditor,L as Select2Editor,Ye as SelectEditor,Ee as ServiceAttribute,Bt as ServiceLookupEditor,oi as ServiceLookupEditorBase,Cr as ServiceLookupFiltering,_e as SlickFormatting,Qr as SlickHelper,jt as SlickPager,re as SlickTreeHelper,ae as StringEditor,xr as StringFiltering,Ie as SubDialogHelper,ux as SummaryType,Wi as TabsExtensions,N as TemplatedDialog,_t as TemplatedPanel,B as TemplatedWidget,$i as TextAreaEditor,ji as TimeEditor,G as Toolbar,Lr as TreeGridMixin,Xi as URLEditor,Fi as UpdatableAttribute,ke as UploadHelper,Be as UrlFormatter,Ms as VX,Pt as ValidationHelper,$r as WX,b as Widget,hn as datePickerIconSvg,bC as jsxDomWidget,Da as reactPatch,Za as useIdPrefix};
//# sourceMappingURL=index.js.map
